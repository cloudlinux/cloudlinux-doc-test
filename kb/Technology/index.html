<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Technology | Knowledge base</title>
    <meta name="description" content="CloudLinux Documentation">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.1c9cd124.css" as="style"><link rel="preload" href="/assets/js/app.da36fadb.js" as="script"><link rel="preload" href="/assets/js/24.0992162f.js" as="script"><link rel="prefetch" href="/assets/js/10.1942d0f0.js"><link rel="prefetch" href="/assets/js/11.e59dcd5a.js"><link rel="prefetch" href="/assets/js/12.90ac86c3.js"><link rel="prefetch" href="/assets/js/13.14de4ed9.js"><link rel="prefetch" href="/assets/js/14.21abeab5.js"><link rel="prefetch" href="/assets/js/15.62e779e0.js"><link rel="prefetch" href="/assets/js/16.81b2b2ef.js"><link rel="prefetch" href="/assets/js/17.23b99257.js"><link rel="prefetch" href="/assets/js/18.a999b8b6.js"><link rel="prefetch" href="/assets/js/19.807aaab3.js"><link rel="prefetch" href="/assets/js/20.416e8ee9.js"><link rel="prefetch" href="/assets/js/21.c5366768.js"><link rel="prefetch" href="/assets/js/22.5fdff440.js"><link rel="prefetch" href="/assets/js/23.6d470fbc.js"><link rel="prefetch" href="/assets/js/25.d65e4653.js"><link rel="prefetch" href="/assets/js/26.4be4ef64.js"><link rel="prefetch" href="/assets/js/27.610114bb.js"><link rel="prefetch" href="/assets/js/28.9f51bd74.js"><link rel="prefetch" href="/assets/js/29.266f7b10.js"><link rel="prefetch" href="/assets/js/3.73c3ee7b.js"><link rel="prefetch" href="/assets/js/30.e00a63b3.js"><link rel="prefetch" href="/assets/js/31.0430cb93.js"><link rel="prefetch" href="/assets/js/32.0c319e0d.js"><link rel="prefetch" href="/assets/js/33.65e63c27.js"><link rel="prefetch" href="/assets/js/34.0c068616.js"><link rel="prefetch" href="/assets/js/35.a9cbe4c7.js"><link rel="prefetch" href="/assets/js/36.69d70537.js"><link rel="prefetch" href="/assets/js/37.08289e92.js"><link rel="prefetch" href="/assets/js/38.aab72032.js"><link rel="prefetch" href="/assets/js/39.d54086d4.js"><link rel="prefetch" href="/assets/js/4.c5f4be1b.js"><link rel="prefetch" href="/assets/js/40.988b7b70.js"><link rel="prefetch" href="/assets/js/41.6dd6c2ef.js"><link rel="prefetch" href="/assets/js/42.0e74a0c5.js"><link rel="prefetch" href="/assets/js/43.3391aaae.js"><link rel="prefetch" href="/assets/js/44.da2ddf64.js"><link rel="prefetch" href="/assets/js/45.67142dec.js"><link rel="prefetch" href="/assets/js/46.286cface.js"><link rel="prefetch" href="/assets/js/47.b4b24a87.js"><link rel="prefetch" href="/assets/js/48.733fe4cb.js"><link rel="prefetch" href="/assets/js/49.022233ca.js"><link rel="prefetch" href="/assets/js/5.5ac32b68.js"><link rel="prefetch" href="/assets/js/50.0b06a7da.js"><link rel="prefetch" href="/assets/js/51.e69716c2.js"><link rel="prefetch" href="/assets/js/6.788f7cb0.js"><link rel="prefetch" href="/assets/js/7.bb646a5c.js"><link rel="prefetch" href="/assets/js/8.d60f6fd1.js"><link rel="prefetch" href="/assets/js/9.d765786c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f089aea3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c9cd124.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-003a9abb><section class="navbar"><header class="navbar__header"><section class="navbar__block"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Knowledge base" class="logo"> <img src="/logo-short.svg" alt="Knowledge base" class="logo-short"></a> <div class="site-name">
        Knowledge base
      </div> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" placeholder="Search" class="search-query"></form></section> <section class="navbar__block"><button class="menu-btn menu-btn--products-list"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon icon--products-list"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg>
        Products
      </button> <button class="navbar-btn navbar-btn--submit-request">Submit request</button> <div class="links" style="max-width:nullpx;"><a href="https://cloudlinux.com/trial" target="_blank" class="navbar-btn navbar-btn--try-free">Try Free</a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kb/Technology/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div></nav></div></section></header> <!----></section> <div class="sidebar-mask"></div> <div class="sidebar"> <ul class="sidebar-links"><li><div class="sidebar-group first"><div class="sidebar-heading open"><span>Content</span> <!----></div> <ul class="sidebar-group-items"><li><a href="/kb/Billing/" class="sidebar-link">Billing and Licensing</a></li><li><a href="/kb/KernelCare/" class="sidebar-link">KernelCare</a></li><li><a href="/kb/Imunify/" class="sidebar-link">Imunify</a></li><li><a href="/kb/FAQ/" class="sidebar-link">FAQ</a></li><li><a href="/kb/Technology/" class="active sidebar-link">Technology</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kb/Technology/#from-which-ip-will-cloudlinux-staff-connect-to-my-server" class="sidebar-link">From which IP will CloudLinux staff connect to my server?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#lve-stats-how-it-works" class="sidebar-link">LVE Stats. How it works</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#how-big-your-swap-partition-to-be" class="sidebar-link">How big your swap partition to be</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#disabling-virtual-memory-limit" class="sidebar-link">Disabling Virtual Memory limit</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#what-is-the-doctor-key-script-and-what-it’s-needed-for" class="sidebar-link">What is the doctor key/script and what it’s needed for?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#can-cloudlinux-work-in-a-virtual-machine" class="sidebar-link">Can CloudLinux work in a virtual machine?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#error-on-lve-enter-7-in-apache-error-log" class="sidebar-link">Error on LVE enter -7 in Apache error log</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#load-average-is-high-on-vmware-vps" class="sidebar-link">Load Average is high on VMware VPS</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#mysql-governor-and-placing-queries-inside-users-lve" class="sidebar-link">MySQL Governor and placing queries inside users LVE</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#php-selector-and-directadmin" class="sidebar-link">PHP Selector and DirectAdmin</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#how-do-i-configure-apache-to-have-python-script-run-in-cagefs" class="sidebar-link">How do I configure Apache to have Python script run in CageFS?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#high-load-average-without-visible-cpu-consuming-processes-cpu-scaling-kondemand" class="sidebar-link">High load average without visible CPU consuming processes. CPU scaling, kondemand</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#how-are-average-values-in-lveinfo-over-period-calculated" class="sidebar-link">How are average values in lveinfo over period calculated?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#does-cloudlinux-os-support-nginx-php-fpm-fcgid-litespeed-apache-mpm-itk" class="sidebar-link">Does CloudLinux OS support nginx/PHP-FPM/FCGID/LiteSpeed/Apache+mpm_itk?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#cloudlinux-os-hybrid-kernels" class="sidebar-link">CloudLinux OS Hybrid Kernels</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#what-happens-when-a-site-reaches-its-resource-limit" class="sidebar-link">What happens when a site reaches its resource limit?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#plesk-and-php-selector" class="sidebar-link">Plesk and PHP Selector</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#how-to-fix-the-issue-with-non-utf-symbols-in-packages-names" class="sidebar-link">How to fix the issue with non-UTF symbols in packages names</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#different-php-versions-per-directories-using-mod-lsapi" class="sidebar-link">Different PHP versions per directories using mod_lsapi</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#integrating-lve-limits-with-packages-for-unsupported-control-panels" class="sidebar-link">Integrating LVE limits with packages for unsupported control panels</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#why-cagefs-installation-changes-jailshell-to-regular-bash-on-cpanel" class="sidebar-link">Why CageFS installation changes jailshell to regular bash on cPanel?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#ep-and-nproc-limits-a-look-from-inside" class="sidebar-link">EP and NPROC limits - a look from inside</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#mod-lsapi-number-of-processes-nproc-and-ep-explained" class="sidebar-link">Mod_lsapi, Number of Processes (NPROC) and EP explained</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#we-found-that-selinux-is-disabled-could-you-help-us-to-enable-it" class="sidebar-link">We found that SELinux is disabled. Could you help us to enable it?</a></li><li class="sidebar-sub-header"><a href="/kb/Technology/#mysql-nd-native-driver-vs-mysql-php-extensions" class="sidebar-link">MySQL_ND (native driver) vs MySQL PHP extensions</a></li></ul></li><li><a href="/kb/HowDoI/" class="sidebar-link">How Do I</a></li><li><a href="/kb/Troubleshooting/" class="sidebar-link">Troubleshooting</a></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Knowledge base:</span> <a href="/kb/" class="breadcrumb router-link-active" data-v-5e0e0acf>
    KB
  </a><a href="/kb/Technology/" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    Technology
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/kb/FAQ/" class="nav-arrow left"></a> <a href="/kb/HowDoI/" class="nav-arrow right"></a></div></div> <div class="content content__default"><h1 id="technology"><a href="#technology" class="header-anchor">#</a> Technology</h1> <h2 id="from-which-ip-will-cloudlinux-staff-connect-to-my-server"><a href="#from-which-ip-will-cloudlinux-staff-connect-to-my-server" class="header-anchor">#</a> From which IP will CloudLinux staff connect to my server?</h2> <p>CloudLinux support team may only connect to your server from the following IP addresses:</p> <div class="language- extra-class"><pre class="language-text"><code>69.175.106.198
69.175.3.6
</code></pre></div><p>Please do not forget to add our IP addresses to the &quot;allow list&quot; on the server firewall (CPHulk, Fail2Ban, CSF/iptables, etc.).</p> <p>For passwordless authentication and in order to prevent the need in sharing the root password over the Internet, you can enable the key-based authentication. For that, you'll need to place our public key in the following file on your server: <strong>/root/.ssh/authorized_keys</strong>.</p> <p>Below you can find the public key (between the cut lines):</p> <p><strong>---------- PUBLIC KEY BEGINNING ---------- PLEASE DO NOT COPY THIS LINE ----------</strong></p> <p>ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAgEA0kzTrtnpG3awsKlQRzo8tLzG0Rb93XO6plRtFsVmAtqyuk1nfwC36ISL+AT2+r4+xuZiK8taVgbPVDU/+dHD3ObMQPIvIZOvQWGZH0zZApeXfbKD3DaLfh5aQeI9kbeo3cGQufFIxTkSLVXHTmjISf3gggP7m17hI4jxiu5Gaw/lNwlrQtsBgyEsF4+Y5jSOn1fMkx+R//8ul6L97EBEIGA9Pzcy4tHtTCNxfAGOmUmx8ijnieqNb95wxU5hrhirmWbICeMkgECEsIOPkweWoBNmrVxAigSQuM0uJZeFl5x2I5KaocmXbpeswDCWjGCtEDjcY9WqBSGehuUxArZvGEcaeJ+AM+xIlr0yPTx+3y4JsN/hluzRX9vbuzBZxhctP0BALu8uXKjYvJr9STU0umNZrRHBBQKCIF16FPwcJ7d+H4KYFvxOiVTDKtIZJ5gCtp/nUtVeQFUPEwgirgypP4hv3gkE73A+2vl3lwZ1p2YBmzzbAOpeXDtDFNSpK6Kfa7ujK70ouM0EDptPe/aGJMuDet7RGlnn/zQdpXrCLpUZSVrsTFjN+NZ6uTah5r5QsOhTpL1IoD+FrW9ovgr6KwtM6rl/XKzrzmbnQGaGQY5h5Kan2a0Y24eIXm5MnncOgwZZUCpT7SV2b7cjASf5xMfU87Ihe3c/Vmi33pblD8E= clsupport@sshbox.cloudlinux.com</p> <p><strong>---------- PUBLIC KEY END ---------- PLEASE DO NOT COPY THIS LINE ----------</strong></p> <h2 id="lve-stats-how-it-works"><a href="#lve-stats-how-it-works" class="header-anchor">#</a> LVE Stats. How it works</h2> <p>First of all, there are three <em>lvestats-server.py</em> processes:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>root 24006 0.1 1.7 312132 32620 ? SN Nov28 1:51 /opt/alt/python27/bin/python2.7 /usr/share/lve-stats/lvestats-server.py start --pidfile /var/run/lvestats.pid
root 24007 0.4 1.7 459596 32364 ? SNl Nov28 6:10 /opt/alt/python27/bin/python2.7 /usr/share/lve-stats/lvestats-server.py start --pidfile /var/run/lvestats.pid
root 24030 0.2 2.4 329940 45252 ? SN Nov28 3:45 /opt/alt/python27/bin/python2.7 /usr/share/lve-stats/lvestats-server.py start --pidfile /var/run/lvestats.pid
</code></pre></div></div> <p>This is normal behavior, these processes are doing different things.</p> <p>The main process handles the stats parsing routine, etc, while two others are working with <a href="/cloudlinux_os_components/#plugins">plugins</a>.</p> <p>The main <em>lvestats-server.py</em> process parses the <code>/proc/lve/list</code> file every 5 seconds. The time interval could vary, it depends on the plugins installed, but usually, the average query time is around 5 seconds.</p> <p>Next, the gathered information is stored in the local sqlite database, but the locating can be easily changed via lve-stats <a href="/cloudlinux_os_components/#configuration">configuration</a> file. Lve-stats can store the data in MySQL (MariaDB) or PostgreSQL servers.</p> <p>Next, the end user or server administrator can select a desired time period and check faults amount (if there were any) for all users or for a particular user.</p> <p>The default average value (A column in the graph) is  1 minute:</p> <p><img src="/images/lves2.jpg" alt="lves2"></p> <p>Column &quot;L&quot; shows the current limit, and &quot;F&quot; shows the number of faults.</p> <p>The chart can be generated from the <a href="/command-line_tools/#lvechart">command line</a> as well.</p> <p>And finally, the end user can see the processes snapshot directly from his panel, for example:</p> <p><img src="/images/lves3.PNG" alt="lves3"></p> <p>The <a href="/command-line_tools/#lve-read-snapshot">snapshots</a> are available for admin from the command line as well.</p> <h2 id="how-big-your-swap-partition-to-be"><a href="#how-big-your-swap-partition-to-be" class="header-anchor">#</a> How big your swap partition to be</h2> <p>Typically - you should never have more than 2GB of swap. On shared hosting servers - you're better of with 0.5 or no swap at all.</p> <p>Let us explain the problem.</p> <ol><li><p>In ancient times, swap was used so that computer can do its job (even if slow) even in the case when a program(s) doesn't fit into memory. We are past that.</p></li> <li><p>In more modern time, it is mostly used so some of the programs that are not used right now could be pushed out of RAM, giving some extra RAM for caches/buffers to get extra performance out of the server.</p></li></ol> <p>Note that in that case, only programs that are rarely used (at most once for several minutes, more like once in a few hours) are good candidates for that.</p> <p>On a typical shared hosting server - there might be about 1/2GB of such programs.</p> <p>Now, having more swap sounds like a non-issue until your server doesn't have problems.</p> <p>Yet, it becomes a problem if something &quot;happens&quot; that causes a server to use up all the RAM.</p> <p>With no/small swap, OOM killer (a kernel thread that monitors memory consumption) will detect that server doesn't have enough memory - decide which process to kill, and will kill it.</p> <p>It will do it for as long as it needed, killing processes left and right.</p> <p>This will result in servers acting badly, giving out 500 errors, or even stop serving HTTP requests at all. Yet, you will still be able to get into the server via SSH, and figure out/fix whatever is happening.</p> <p>With the large swap, OOM killer (rightfully) thinks that there are plenty of memory left, so it doesn't act. Processes that were getting more ram, are the one that needs to be running (based on OS), so everything else will be pushed out to swap. That includes Apache/PHP processes, SSH, MySQL, etc...</p> <p>And whatever is in swap - is VERY slow. 1000s of times slower...</p> <p>So, now:</p> <p>HTTP doesn't work. Requests timeout - though OS tries to bring up Apache/PHP from swap, causing something else into swap, trashing disks.</p> <p>SSH doesn't work... probably timeouts as well. Maybe you can get it to work if you wait for 30 minutes, as it competes with all the HTTP requests/apache processes.</p> <p>Logging doesn't work - your IO overloaded with all the swap disk IO that are trashing your disk.</p> <p>As a result, you get an unresponsive server, and often - no idea what happened.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Our advice - shrink swap to at most 0.5G-1GB, or turn it off completely, as by the time you have 2GB in SWAP - your server is hosed.</p></div><h2 id="disabling-virtual-memory-limit"><a href="#disabling-virtual-memory-limit" class="header-anchor">#</a> Disabling Virtual Memory limit</h2> <p>It is recommended to disable VMEM limits (set them to 0) in your system for all users and packages.</p> <p>The VMEM limit is deprecated in CloudLinux 6 and 7 system and can cause unexpected issues.</p> <p>There are several ways to disable VMEM limits.</p> <p>The following command will replace all VMEM related entries in the limits configuration file “ve.cfg” to the correct value:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ sed -r -i.old 's|&lt;(v?)mem\s[^&gt;]*&gt;|&lt;\1mem limit=&quot;0&quot;/&gt;|g' /etc/container/ve.cfg &amp;&amp; lvectl apply all
</code></pre></div></div> <p>Alternatively, limits can be adjusted using <a href="/lve_manager/#lve-manager">LVE Manager</a> and via <a href="/command-line_tools/#lvectl">lvectl</a> command line tool.</p> <p>Please note that changing the default limit alone, like this (for example):
</p><div class="notranslate"><p></p> <div class="language- extra-class"><pre class="language-text"><code>$ lvectl set default --vmem=0
$ lvectl apply all
</code></pre></div></div> <p>is usually not enough, since it will just change the default limit set.</p> <p>All the accounts with package limits and personal limits will stay intact.</p> <p>So if you are about to change the limits via LVE Manager - please make sure to change limits for all accounts and packages.</p> <h2 id="what-is-the-doctor-key-script-and-what-it’s-needed-for"><a href="#what-is-the-doctor-key-script-and-what-it’s-needed-for" class="header-anchor">#</a> What is the doctor key/script and what it’s needed for?</h2> <p>To resolve issues more quickly, our support team would need to know the basic information about your server first. Our script collects such data as kernel version, list of LVE related packages installed and their versions. We also collect the content of some files, like <em>grub.cfg</em>, <em>/etc/container/ve.cfg</em>, etc.</p> <p>Our script also performs some basic checks; for example, it checks if you still have vmem limit enabled or if the mod_hostinglimits module is loaded.</p> <p>Here are the instructions on how to obtain the doctor key before submitting a support ticket for different departments:</p> <p>For <strong>CloudLinux OS</strong> department:
Run the following command on your server (as root user):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>wget -qq -O - https://www.cloudlinux.com/clinfo/cldoctor.sh|bash
</code></pre></div></div> <p>If &quot;wget&quot; utility is not installed/available you can use &quot;curl&quot;, like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>curl -s https://www.cloudlinux.com/clinfo/cldoctor.sh|bash
Then paste the generated key into the ticket.
</code></pre></div></div> <p>For <strong>Imunify360</strong> department:
Run the next command on your server (as root user):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>imunify360-agent doctor
</code></pre></div></div> <p>Then paste the generated key into the ticket.</p> <p>For <strong>ImunifyAV and ImunifyAV+</strong> related support tickets:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>imunify-antivirus doctor
</code></pre></div></div> <p>For <strong>KernelCare</strong> department:
Run the next command on your server (as root user):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>kcarectl --doctor
</code></pre></div></div> <p>Then paste the generated key into the ticket.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>We do not collect any sensitive or personal information from your server, like passwords of any kinds, domain names or e-mail addresses, etc.</p></div><p>All the collected information is used for diagnosis and troubleshooting purposes only.</p> <h2 id="can-cloudlinux-work-in-a-virtual-machine"><a href="#can-cloudlinux-work-in-a-virtual-machine" class="header-anchor">#</a> Can CloudLinux work in a virtual machine?</h2> <p>CloudLinux OS is fully compatible with all hypervisor based virtualization. This includes 32-bit and 64-bit Xen, KVM, Hyper-V, VMware, Parallels Baremetal.</p> <p>OpenVZ and Virtuozzo support has been deprecated.</p> <h2 id="error-on-lve-enter-7-in-apache-error-log"><a href="#error-on-lve-enter-7-in-apache-error-log" class="header-anchor">#</a> Error on LVE enter -7 in Apache error log</h2> <p>It means that user was limited to a number of concurrent connections, and received 503 error.</p> <p>Run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lveinfo --period=1d --by-fault=mep --display-username
</code></pre></div></div> <p>to see affected users within past 24 hours</p> <h2 id="load-average-is-high-on-vmware-vps"><a href="#load-average-is-high-on-vmware-vps" class="header-anchor">#</a> Load Average is high on VMware VPS</h2> <p>If you are getting high LA on your VMware VPS, please make sure that VMware tools are installed.</p> <p>To check VMware modules you can use:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lsmod |grep vm
</code></pre></div></div> <p>VMware tools installation guide can be found <a href="https://kb.vmware.com/s/article/1018414" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="mysql-governor-and-placing-queries-inside-users-lve"><a href="#mysql-governor-and-placing-queries-inside-users-lve" class="header-anchor">#</a> MySQL Governor and placing queries inside users LVE</h2> <p>Find the most recent information on this topic in our online <a href="/cloudlinux_os_components/#modes-of-operation">docs</a></p> <h2 id="php-selector-and-directadmin"><a href="#php-selector-and-directadmin" class="header-anchor">#</a> PHP Selector and DirectAdmin</h2> <p>CloudLinux PHP Selector works with DirectAdmin only if PHP is running in suPHP or FastCGI mode. Here is the complete set of commands to enable PHP Selector on DirectAdmin with suPHP:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/usr/local/directadmin/custombuild/build set php1_mode suphp
/usr/local/directadmin/custombuild/build set cloudlinux yes
/usr/local/directadmin/custombuild/build set cagefs yes
/usr/local/directadmin/custombuild/build update
/usr/local/directadmin/custombuild/build apache
/usr/local/directadmin/custombuild/build php y
/usr/local/directadmin/custombuild/build suphp
/usr/local/directadmin/custombuild/build rewrite_confs
cagefsctl --force-update
cagefsctl --remount-all
</code></pre></div></div> <p>Same way for FastCGI mode.</p> <h2 id="how-do-i-configure-apache-to-have-python-script-run-in-cagefs"><a href="#how-do-i-configure-apache-to-have-python-script-run-in-cagefs" class="header-anchor">#</a> How do I configure Apache to have Python script run in CageFS?</h2> <p>If you want to run Python scripts in CageFS and have them fully secure you will have to use suexec with CGI or suexec with FastCGI.</p> <h2 id="high-load-average-without-visible-cpu-consuming-processes-cpu-scaling-kondemand"><a href="#high-load-average-without-visible-cpu-consuming-processes-cpu-scaling-kondemand" class="header-anchor">#</a> High load average without visible CPU consuming processes. CPU scaling, kondemand</h2> <p>When you see a high load average, however, no real CPU consuming processes, but with kondemand process in top command, then most probably CPU scaling is the core of the issue.</p> <p>Example 'top' output:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>top - 22:22:07 up 15 min, 3 users, load average: 5.30, 4.03, 2.60
Tasks: 1022 total, 1 running, 1021 sleeping, 0 stopped, 0 zombie
Cpu(s): 0.0%us, 0.1%sy, 0.0%ni, 99.8%id, 0.0%wa, 0.0%hi, 0.1%si, 0.0%st
Mem: 32789164k total, 1858284k used, 30930880k free, 66368k buffers
Swap: 4194296k total, 0k used, 4194296k free, 798340k cached

PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
4979 root 20 0 153m 7364 1780 S 2.6 0.0 0:15.20 lvestats-server
4024 root 20 0 0 0 0 S 2.3 0.0 0:18.44 kondemand/23
4025 root 20 0 0 0 0 S 2.3 0.0 0:19.45 kondemand/24
4023 root 20 0 0 0 0 S 2.0 0.0 0:14.85 kondemand/22
4026 root 20 0 0 0 0 S 2.0 0.0 0:17.60 kondemand/25
4027 root 20 0 0 0 0 S 2.0 0.0 0:16.24 kondemand/26
4022 root 20 0 0 0 0 S 1.6 0.0 0:12.68 kondemand/21
4028 root 20 0 0 0 0 S 1.6 0.0 0:13.79 kondemand/27
</code></pre></div></div> <p>Check what scaling is set to:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
</code></pre></div></div> <p>If you see <strong>kondemand</strong> there, it means that scaling is enabled. It actually enables the operating system to scale the CPU frequency up or down in order to save power. CPU frequencies will be scaled automatically depending on the system load, in response to ACPI events, or manually by userspace programs. To be sure CPU has been scaled you may compare real CPU frequency to hardware:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>grep -E '^model name|^cpu MHz' /proc/cpuinfo
</code></pre></div></div> <p><em>model name : Intel(R) Xeon(R) CPU X7550 @ 2.00GHz cpu MHz : 1067.000</em></p> <p>Resolution is simple - switch off scaling, this should be done for all CPU cores, but here is one-liner for it:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>for CPUFREQ in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do [ -f $CPUFREQ ] || continue; echo -n performance &gt; $CPUFREQ; done
</code></pre></div></div> <p>This will help on an already running server, however, to resolve it completely you have to remove <strong>cpuspeed</strong> rpm package.</p> <h2 id="how-are-average-values-in-lveinfo-over-period-calculated"><a href="#how-are-average-values-in-lveinfo-over-period-calculated" class="header-anchor">#</a> How are average values in lveinfo over period calculated?</h2> <p>Average values in lveinfo are taken from current one-minute average. The calculations of all averages (aCPU, aPMEM aIO) are following:</p> <ul><li><p>every minute lvestats write current average CPU usage value per minute;</p></li> <li><p>every 5 minutes lvestats calculates 5 minutes average based on previous 1 minute average (sum all and divide by 5);</p></li> <li><p>every hour it calculates 1 hour average based on previously calculated 5 minutes (sum all then divide by 12);</p></li></ul> <p>This way we can keep important data and save enough space of lvestats database.</p> <p>To make the situation clear lets split lveinfo output to different sections:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ lveinfo --id XXX --period=1d
</code></pre></div></div> <p><strong>From To</strong> <em>aCPU mCPU lCPU aIO mIO lIO aEP mEP lEP aVMem mVMem lVMem aPMem mPMem lPMem aNproc mNproc lNproc EPf VMemF PMemF NprocF</em></p> <p>Hourly:</p> <p><strong>04-24 02:00 04-24 03:00</strong> <em>0 4 4 3 169 5120 1 10 10 37.7M 209.6M 4.0G 23.4M 110.7M 4.0G 0 1 30 1 0 0 0</em><br> <strong>04-24 03:00 04-24 04:00</strong> <em>0 4 4 1 178 5120 1 10 10 53.2M 246.1M 4.0G 31.6M 126.5M 4.0G 0 1 30 0 0 0 0</em><br> <strong>04-24 04:00 04-24 05:00</strong> <em>0 2 4 0 73 5120 1 5 10 48.8M 139.0M 4.0G 30.4M 82.2M 4.0G 0 1 30 0 0 0 0</em></p> <p>5 min:</p> <p><strong>04-24 05:00 04-24 05:05</strong> <em>0 1 4 0 8 5120 1 3 10 50.7M 78.2M 4.0G 31.0M 46.6M 4.0G 0 0 30 0 0 0 0</em><br> <strong>04-24 05:05 04-24 05:10</strong> <em>0 0 4 0 0 5120 1 3 10 44.9M 74.7M 4.0G 28.1M 43.3M 4.0G 0 0 30 0 0 0 0</em><br> <strong>04-24 05:10 04-24 05:15</strong> <em>0 0 4 0 12 5120 1 2 10 36.4M 61.9M 4.0G 23.6M 42.1M 4.0G 0 0 30 0 0 0 0</em></p> <p>1 min:</p> <p><strong>04-24 05:14 04-24 05:15</strong> <em>0 0 4 0 3 5120 1 3 10 40.4M 74.2M 4.0G 23.7M 41.0M 4.0G 0 0 30 0 0 0 0</em><br> <strong>04-24 05:15 04-24 05:16</strong> <em>0 0 4 0 0 5120 1 1 10 24.5M 30.6M 4.0G 16.1M 21.9M 4.0G 0 0 30 0 0 0 0</em><br> <strong>04-24 05:16 04-24 05:17</strong> <em>0 0 4 0 0 5120 1 2 10 28.3M 47.8M 4.0G 17.8M 27.0M 4.0G 0 0 30 0 0 0 0</em></p> <h2 id="does-cloudlinux-os-support-nginx-php-fpm-fcgid-litespeed-apache-mpm-itk"><a href="#does-cloudlinux-os-support-nginx-php-fpm-fcgid-litespeed-apache-mpm-itk" class="header-anchor">#</a> Does CloudLinux OS support nginx/PHP-FPM/FCGID/LiteSpeed/Apache+mpm_itk?</h2> <p>Generally yes, it does support most of the features. However, in some cases, you need to apply some additional patches.</p> <p>For more information and compatibility matrix, please see the following <a href="/limits/#compatibility-matrix">article</a></p> <h2 id="cloudlinux-os-hybrid-kernels"><a href="#cloudlinux-os-hybrid-kernels" class="header-anchor">#</a> CloudLinux OS Hybrid Kernels</h2> <p>Find the most recent information on this topic in our online <a href="/cloudlinux_os_kernel/#hybrid-kernels">docs</a></p> <h2 id="what-happens-when-a-site-reaches-its-resource-limit"><a href="#what-happens-when-a-site-reaches-its-resource-limit" class="header-anchor">#</a> What happens when a site reaches its resource limit?</h2> <p>Once a website reaches the limit of resources which has been set, the site will begin to slow down. Once the number of entry processes (Apache/HTTP requests is reached), a user will get a 503 error message. The website that is consuming too many resources will stop working but the other tenants on the server will continue to run normally.</p> <h2 id="plesk-and-php-selector"><a href="#plesk-and-php-selector" class="header-anchor">#</a> Plesk and PHP Selector</h2> <p>Plesk has its own PHP selection functionality since version 11.</p> <p>It is fully compatible with our PHP Selector and CageFS. What happens is that Plesk selector switches 'native' PHP version, while CloudLinux OS PHP Selector switches sites to alternate PHP versions.</p> <p>If you install different PHP versions from the link above to activate it for the customer you are required to run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --force-update
</code></pre></div></div> <p>Resellers have no control over PHP-Selector, and shouldn't have any. Only admin &amp; end customers have control over PHP-Selector.</p> <h2 id="how-to-fix-the-issue-with-non-utf-symbols-in-packages-names"><a href="#how-to-fix-the-issue-with-non-utf-symbols-in-packages-names" class="header-anchor">#</a> How to fix the issue with non-UTF symbols in packages names</h2> <p>Short issue description: if you see errors in console when runnning:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>lvectl paneluserslimits --json 
</code></pre></div></div> <p>and some other commands, or in WHM - LVE Manager like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>Traceback (most recent call last):
  File &quot;/usr/sbin/lvectl&quot;, line 707, in &lt;module&gt;
    main()
  File &quot;/usr/sbin/lvectl&quot;, line 598, in main
    lve_commands.paneluserslimits()
  File &quot;/opt/alt/python27/lib/python2.7/site-packages/lvectllib.py&quot;, line 830, in paneluserslimits
    result += formatter(user)
  File &quot;/opt/alt/python27/lib/python2.7/site-packages/lvectllib.py&quot;, line 774, in wrapper
    lve_apply(user, plan_id=package, reseller=reseller, result=True)
  File &quot;/opt/alt/python27/lib/python2.7/site-packages/lvectllib.py&quot;, line 603, in lve_apply
    reseller = guess_reseller_by_package (plan_id)[0]
  File &quot;/opt/alt/python27/lib/python2.7/site-packages/lvectllib.py&quot;, line 1828, in guess_reseller_by_package
    package = package.decode('utf-8')
  File &quot;/opt/alt/python27/lib64/python2.7/encodings/utf_8.py&quot;, line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeDecodeError: 'utf8' codec can't decode byte 0xf1 in position 13: unexpected end of data
</code></pre></div></div> <p>This means that your browser encoding was not set to UTF-8 during the package creation, and it was saved with gibberish symbols. Next, when the package is assigned to one or more users, you will see the error listed above. For example:</p> <ol><li><p>Your browser has ISO-8859-6 encoding set, and you create a package with some non-ASCII symbols (cyrillic in this case):</p></li> <li><p>Next, you create a new user and assign the package to that user:</p></li></ol> <p>If you look at such user in the console, it usually looks as follows:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cat /var/cpanel/users/username

BACKUP=1

BWLIMIT=unlimited

CONTACTEMAIL=

…..

OWNER=root

PLAN=п�&amp;amp;#65533;�&amp;amp;#65533;�&amp;amp;#65533;т�&amp;amp;#65533;щ�&amp;amp;#65533;
</code></pre></div></div> <p>The last line “PLAN=...” means which package is assigned to the user, and as you can see in the example above, the line contains gibberish symbols.</p> <p>cPanel only supports UTF-8 encodings and they have no plans to change that, so the PLAN= line with gibberish symbols must be manually changed to the corresponding plan, i.e. it should look like this: PLAN=пакетище</p> <p>Further recommendations:</p> <p>Fix the browser encoding to use one compatible with UTF-8. Since UTF-8 became the standard for all data on the Internet in 2009 the primary browsers (Internet Explorer/Edge, Firefox, Chrome, Safari) provide language encodings compatible with UTF-8.</p> <h2 id="different-php-versions-per-directories-using-mod-lsapi"><a href="#different-php-versions-per-directories-using-mod-lsapi" class="header-anchor">#</a> Different PHP versions per directories using mod_lsapi</h2> <p>Here is an easy instruction of how to setup different PHP versions per directories when using <a href="/cloudlinux_os_components/#apache-mod-lsapi-pro/">mod_lsapi</a>.</p> <p>Assuming that you already have CageFS, PHP Selector and mod_lsapi installed, perform the following steps:</p> <ol><li><p>Setup mod_lsapi (either globally or per domain).</p></li> <li><p>If EasyApache 4 is used - you should already have a <em>/etc/container/php.handler</em> file with content inside:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>application/x-httpd-ea-php44-lsphp /opt/cpanel/ea-php44/root/usr/bin/lsphp
application/x-httpd-ea-php51-lsphp /opt/cpanel/ea-php51/root/usr/bin/lsphp
application/x-httpd-ea-php52-lsphp /opt/cpanel/ea-php52/root/usr/bin/lsphp
application/x-httpd-ea-php53-lsphp /opt/cpanel/ea-php53/root/usr/bin/lsphp
application/x-httpd-ea-php54-lsphp /opt/cpanel/ea-php54/root/usr/bin/lsphp
application/x-httpd-ea-php55-lsphp /opt/cpanel/ea-php55/root/usr/bin/lsphp
application/x-httpd-ea-php56-lsphp /opt/cpanel/ea-php56/root/usr/bin/lsphp
application/x-httpd-ea-php70-lsphp /opt/cpanel/ea-php70/root/usr/bin/lsphp
application/x-httpd-ea-php71-lsphp /opt/cpanel/ea-php71/root/usr/bin/lsphp 
</code></pre></div></div> <p>For other panels or no panel - create a <em>/etc/container/php.handler</em> file with handlers for different PHP versions:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>application/x-lsphp52 /opt/alt/php52/usr/bin/lsphp
application/x-lsphp53 /opt/alt/php53/usr/bin/lsphp
application/x-lsphp54 /opt/alt/php54/usr/bin/lsphp
application/x-lsphp55 /opt/alt/php55/usr/bin/lsphp
application/x-lsphp56 /opt/alt/php56/usr/bin/lsphp
application/x-lsphp71 /opt/alt/php71/usr/bin/lsphp 
</code></pre></div></div> <p>Restart Apache.</p> <ol start="3"><li>Create <em>.htaccess</em> file in the directory where you need to have a PHP version different from default with the right handler.</li></ol> <p>For cPanel with EasyApache4:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;FilesMatch &quot;\.(php4|php5|php3|php2|php|phtml)$&quot;&gt;
SetHandler application/x-httpd-ea-php71-lsphp
&lt;/FilesMatch&gt;
</code></pre></div></div> <p>For other panels or no panel:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;FilesMatch &quot;\.(php4|php5|php3|php2|php|phtml)$&quot;&gt;
SetHandler application/x-lsphp71
&lt;/FilesMatch&gt;
</code></pre></div></div> <p>As a result, subdirectories will use the same PHP version as the parent unless you overwrite it with another <em>.htaccess</em> entry in that subdirectory.</p> <p>To match PHP extensions selection with extensions selected by the end user for that PHP version in PHP Selector you have to follow <a href="https://docs.cloudlinux.com/cloudlinux_os_components/#php-extensions" target="_blank" rel="noopener noreferrer">this docs article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>This way, the main website can use native PHP handler (suphp/fcgi) while subdirectory is using lsapi with necessary PHP version.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>There is one little trick that can be confusing. It applies only if you have PHP Selector enabled and you have non-native version selected there for a user. In that case, if the version that you assign through .htaccess is the same as ea-php version selected as system default version in WHM -&gt; MultiPHP Manager -&gt; System Default version, that version will not be applies, the version that you'll actually get will be the same as selected in PHP Selector.</p></div><h2 id="integrating-lve-limits-with-packages-for-unsupported-control-panels"><a href="#integrating-lve-limits-with-packages-for-unsupported-control-panels" class="header-anchor">#</a> Integrating LVE limits with packages for unsupported control panels</h2> <p>The following <a href="https://docs.cloudlinux.com/lve_manager/#control-panel-integration-guide" target="_blank" rel="noopener noreferrer">documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> should be used to integrate LVE limits with packages for all unsupported panels or even for servers without panels.</p> <p>Here is an example script and the basic steps.</p> <p>Before we start:</p> <ul><li><p>the script is simplified as much as possible for better understanding;</p></li> <li><p>the script works only with one-word package names, without any spaces;</p></li> <li><p><em>user_package</em> file logic is not good enough to handle a large amount of users/packages (but this is just an example).</p></li></ul> <ol><li>Create the necessary directory and files:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mkdir /etc/clpackages
touch /etc/clpackages/user_package
touch /etc/clpackages/custompkg.sh
chmod 755 /etc/clpackages/custompkg.sh
</code></pre></div></div> <ol start="2"><li>The <em>user_package</em> file is just a relation between users and packages, add the following content:</li></ol> <p><em>501 Package1 502 BusinessPackage 503 Package1 504 Package1 505 BusinessPackage</em></p> <ol start="3"><li>The <em>custompkg.sh</em> is the main script which will handle all the management. Add the following code to it:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#!/bin/bash

PDIR=&quot;/etc/clpackages&quot;
cd $PDIR

case &quot;$1&quot; in
        --list-all)

                cat user_package

        ;;
        --userid=*)
                uid=${1#*=}
                cat user_package | grep $uid | awk '{ print $2 }'
        ;;
        --package=*)
                pack=${1#*=}
                cat user_package | grep $pack | awk '{ print $1 }'
        ;;
        --list-packages)
                cat user_package | awk '{ print $2 }' | sort | uniq
        ;;
        *)
                echo &quot;Usage:
--help               show this message
--list-all           prints &lt;userid package&gt; pairs (accepts no parameters);
--userid=id          prints package for a user specified
--package=package    prints users for a package specified
--list-packages      prints packages list&quot;
        ;;
esac
</code></pre></div></div> <ol start="4"><li>Configure LVE to use the custom script: open /etc/sysconfig/cloudlinux and add there:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>CUSTOM_GETPACKAGE_SCRIPT=/etc/clpackages/custompkg.sh
</code></pre></div></div> <ol start="5"><li>Set some limits for the packages:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>lvectl package-set Package1 --speed=100% --pmem=1G
lvectl package-set BusinessPackage --speed=200% --pmem=2G
</code></pre></div></div> <p>Check if they have been properly set:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>lvectl package-list
</code></pre></div></div> <p><em>ID   SPEED    NCPU    PMEM    VMEM      EP   NPROC      IO VE_DEFAULT     200       0      0M      0M      20      20       0 BusinessPackage     200       0   2048M      0M      20      20       0 Package1     100       0   1024M      0M      20      20       0</em></p> <ol start="6"><li>Check users assignment (is already done by our script):</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># getcontrolpaneluserspackages --list-all
</code></pre></div></div> <p><em>501 Package1 502 BusinessPackage 503 Package1 504 Package1 505 BusinessPackage</em></p> <ol start="7"><li>Apply limits for all accounts:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>lvectl apply all
lvectl list | grep 501
</code></pre></div></div> <p><em>501     100       1    1.0G      0K      20      20       0</em></p> <h2 id="why-cagefs-installation-changes-jailshell-to-regular-bash-on-cpanel"><a href="#why-cagefs-installation-changes-jailshell-to-regular-bash-on-cpanel" class="header-anchor">#</a> Why CageFS installation changes jailshell to regular bash on cPanel?</h2> <p>During CageFS package installation or update, all users with jailshell enabled will have it changed to regular /bin/bash in <em>/etc/passwd</em> .</p> <p>This is done to avoid possible conflict with virtfs when non-cagefs user enters virtfs, jailshell copies all mountpoints from cagefs-skeleton to <em>/home/virtfs/$USER</em>. Those mount points are duplicated for each user (approx 54 mount point per user).</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/dev/sda1 /home/virtfs/korvin/usr/share/cagefs-skeleton/opt/alt ext4 ro,nosuid,relatime,barrier=1,data=ordered,jqfmt=vfsv0,usrjquota=quota.user 0 0
/dev/sda1 /home/virtfs/korvin/usr/share/cagefs-skeleton/usr/lib ext4 ro,nosuid,relatime,barrier=1,data=ordered,jqfmt=vfsv0,usrjquota=quota.user 0 0
/dev/sda1 /home/virtfs/korvin/usr/share/cagefs-skeleton/usr/lib64 ext4 ro,nosuid,relatime,barrier=1,data=ordered,jqfmt=vfsv0,usrjquota=quota.user 0 0
/dev/sda1 /home/virtfs/korvin/usr/share/cagefs-skeleton/usr/include ext4 ro,nosuid,relatime,barrier=1,data=ordered,jqfmt=vfsv0,usrjquota=quota.user 0 0
/dev/sda1 /home/virtfs/korvin/usr/local/cpanel/3rdparty/mailman/logs ext4 rw,relatime,barrier=1,data=ordered,jqfmt=vfsv0,usrjquota=quota.user 0 0
/proc/bus/usb /home/virtfs/korvin/usr/share/cagefs-skeleton/proc/bus/usb usbfs ro,nosuid,relatime 0 0
</code></pre></div></div> <p>This could result in a really large number of mount points which could lead to slow system performance. It is secure to provide bash access to users as long as you have CageFS enabled.</p> <h2 id="ep-and-nproc-limits-a-look-from-inside"><a href="#ep-and-nproc-limits-a-look-from-inside" class="header-anchor">#</a> EP and NPROC limits - a look from inside</h2> <p>The main purpose of this article is to describe EP and NPROC limits in more details for better understanding of their operation.</p> <p>So, <strong>EP limits</strong> purpose is to define the <strong>maximum amount of active connections</strong> to the web server inside LVE (1 user account = 1 LVE). When we set EP limits for an account, then we strictly limit the number of concurrent Apache connections to be served by a specific website. Each time a website request enters LVE, the EP counter is being incremented.</p> <p>Note that the EP counter value wouldn't be incremented in case of a PHP process inside LVE is calling some external process (like cron, Sendmail, Exim, MySQL etc.), all of them would be considered as a single LVE entry - single connection, because EP counter doesn't include the child processes created inside LVE.</p> <p><strong>NPROC limits</strong> purpose is to define the <strong>maximum number of processes inside LVE</strong>. Such as ssh/cron/php/pop3/imap etc. They don't increment the value of the EP counter due to being executed with the LVE_NO_MAXENTER flag.</p> <p>It's important to note, that the NPROC limits should always be higher than the EP. Sometimes you could see that there is only 1 EP connection, but the PNO value is much higher (using the &quot;lvetop&quot; utility). There are two possible reasons for such behavior:</p> <ol><li>The invoked PHP script has made a call to some external application from inside the user LVE (like cron, Sendmail, Exim, MySQL etc.)</li> <li>In case you use any of the following handlers: PHP-LiteSpeed, FastCGI or PHP-FPM, there is a chance that additional child processes (like lsphp/fastcgi/php-fpm) could be spawned and stay inside LVE for some time.</li></ol> <p>It's also important to note that such behavior is only actual for the mentioned handlers. As suPHP for example, terminates the process upon the PHP request completion, and in this case, NPROC value most probably will be equal to EP value.</p> <h2 id="mod-lsapi-number-of-processes-nproc-and-ep-explained"><a href="#mod-lsapi-number-of-processes-nproc-and-ep-explained" class="header-anchor">#</a> Mod_lsapi, Number of Processes (NPROC) and EP explained</h2> <p>Apache <a href="/cloudlinux_os_components/#apache-mod-lsapi-pro">mod_lsapi</a> is a great replacement for suPHP/FCGI engines. This article uncovers more about how lsphp works on a server by means of processes.   The scheme is that each time a process 'enters' into LVE, we increment the EP counter. Each time a process exits LVE, we decrement the counter. We don't count processes that are created inside LVE itself. When we talk about <strong>lsapi</strong>, the following image can explain more:
<img src="/images/mod_lsapidiagrammnew.jpg" alt="lsapi"></p> <p>For the real request we have several processes:</p> <ul><li>Apache process that accepts a connection, it is actually one that increases <strong>EP</strong>, it performs <strong>lve_enter</strong>.</li> <li><strong>lsphp</strong> parent process (one per VirtualHost), which starts <strong>lsphp</strong> backends.</li> <li><strong>lsphp</strong> backend process that actually processes requested PHP file.</li></ul> <p>Please review the results with a simple sleep.php script with sleep(30); inside presented below. The processes for single opening are:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lveps -p
ID EP PNO COM TNO TID CPU MEM DT DO
bogdan1 1 3 --- 3 --- 0 15 39340 1865
--- --- lsphp:/home/bogdan1/publ --- 271509 0 4 N/A N/A
--- --- lsphp --- 271508 0 4 N/A N/A
--- --- /usr/sbin/httpd -k start --- 271024 0 4 N/A N/A
</code></pre></div></div> <p>We have one <strong>EP</strong> and three <strong>NPROC</strong> here.  Where Apache creates <strong>lsapi</strong> master process and it creates <strong>lsphp</strong> workers like on a screenshot above. When opening the same URL twice simultaneously you can see the following:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lveps -p
ID EP PNO COM TNO TID CPU MEM DT DO
bogdan1 2 5 --- 5 --- 0 20 39340 1865
--- --- lsphp:/home/bogdan1/publ --- 271518 0 4 N/A N/A
--- --- lsphp:/home/bogdan1/publ --- 271509 0 4 N/A N/A
--- --- lsphp --- 271508 0 4 N/A N/A
--- --- /usr/sbin/httpd -k start --- 271043 0 4 N/A N/A
--- --- /usr/sbin/httpd -k start --- 271024 0 4 N/A N/A
</code></pre></div></div> <p>This time we have two <strong>EPs</strong> and five <strong>NPROCs</strong>, which is normal as parent lsphp is one per VirtualHost. If, for example, our PHP script creates another process (sending mail, etc.) the <strong>EP</strong> will remain the same as PHP script is already executed inside LVE. However, the number of processes for this LVE will increase. That is why <strong>NPROC</strong> should be greater than <strong>EP</strong>. There is no way to limit the number of parent PHP processes, it is only one per VirtualHost (not per account!). To keep users within limits you have to combine <code>lsapi_backend_children</code> with LVE NPROC/EP limits. Each lsphp worker process ends after the request is processed. Turning <code>&quot;connection_pool_mode On&quot;</code>  in lsapi config makes <strong>lsphp</strong> workers never finish - they stay alive for <code>lsapi_backend_max_idle</code> time, or until <code>lsapi_backend_max_reqs</code> is reached (or Apache restarted). All requests for every virtual host are spread across Apache worker almost equally. Connection pool grants faster processing mode, however, it will cause a higher number of processes per LVE (NPROC) and a bit higher memory usage.</p> <h2 id="we-found-that-selinux-is-disabled-could-you-help-us-to-enable-it"><a href="#we-found-that-selinux-is-disabled-could-you-help-us-to-enable-it" class="header-anchor">#</a> We found that SELinux is disabled. Could you help us to enable it?</h2> <p>SELinux is not supported by CloudLinux OS and there are no plans to.</p> <h2 id="mysql-nd-native-driver-vs-mysql-php-extensions"><a href="#mysql-nd-native-driver-vs-mysql-php-extensions" class="header-anchor">#</a> MySQL_ND (native driver) vs MySQL PHP extensions</h2> <p>MySQL_ND and MySQL PHP extensions are the different sets of drivers. They are provided by the different teams of developers (MySQL and PHP, respectively). The most important is the fact that they are mutually exclusive - you can not select them both simultaneously or mix them in any way. Otherwise, the php code will throw errors about the connection to the MySQL database.</p> <p>Since PHP 5.4, mysqlnd is used as the default MySQL driver for all PHP MySQL extensions. But for PHP 5.3 and older PHP versions libmysqlclient is used as a connector from PHP to MySQL.
For PHP Selector we need to support both methods, that is why we added nd_* prefix for PHP MySQL extensions compatible with mysqlnd.</p> <p>So, as a result:</p> <ul><li>libmysqlclient works with  mysql, mysqli, pdo_mysql extensions (PHP 4.4 - PHP 5.3);</li> <li>mysqlnd works with nd_mysql, nd_mysqli, nd_pdo_mysql extensions (PHP 5.4 - PHP 7.1).</li></ul> <p><strong>So you have to choose only one of the following sets:</strong></p> <div class="language- extra-class"><pre class="language-text"><code>mysqlnd
nd_mysql
nd_mysqli 
nd_pdo_mysql​
</code></pre></div><p><strong>or</strong></p> <div class="language- extra-class"><pre class="language-text"><code>mysql
mysqli
pdo_mysql​
</code></pre></div><p>Also <span class="notranlate"><em>/etc/cl.selector/php.extensions.conflicts</em></span> file provides the information about the mutually incompatible php extensions.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/cloudlinux-doc/edit/dev/docs/kb/Technology/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="back-to-top" data-v-5366e0dd><a href="/kb/Technology/#app" class="nav-arrow top back-to-top__link" data-v-5366e0dd></a></div> </div> <div class="footer" data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.com" data-v-58ab2eba><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-58ab2eba></a></div> <div class="footer-company-title" data-v-58ab2eba>2021. CloudLinux Inc</div> <div data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/sections/115001344329-How-do-I" target="_blank" data-v-58ab2eba>How to</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/getting-started-with-cloudlinux-os" target="_blank" data-v-58ab2eba>Getting started</a></div><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" data-v-58ab2eba>Contact support</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/blog" target="_blank" data-v-58ab2eba>Blog</a></div></div> <div class="social" data-v-58ab2eba><span class="footer-social-text" data-v-58ab2eba>Stay in touch</span> <a href="https://www.facebook.com/cloudlinux/" target="_blank" data-v-58ab2eba><img src="/fb.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://twitter.com/cloudlinuxos/" target="_blank" data-v-58ab2eba><img src="/tw.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-58ab2eba><img src="/in.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://www.youtube.com/channel/UCZ3YMHWnMP7TaxlXVay5-aw" target="_blank" data-v-58ab2eba><img src="/ytube.png" class="footer-social-logo" data-v-58ab2eba></a></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.da36fadb.js" defer></script><script src="/assets/js/24.0992162f.js" defer></script>
  </body>
</html>
