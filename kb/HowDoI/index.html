<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How Do I | Knowledge base</title>
    <meta name="description" content="CloudLinux Documentation">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.1c9cd124.css" as="style"><link rel="preload" href="/assets/js/app.da36fadb.js" as="script"><link rel="preload" href="/assets/js/20.416e8ee9.js" as="script"><link rel="prefetch" href="/assets/js/10.1942d0f0.js"><link rel="prefetch" href="/assets/js/11.e59dcd5a.js"><link rel="prefetch" href="/assets/js/12.90ac86c3.js"><link rel="prefetch" href="/assets/js/13.14de4ed9.js"><link rel="prefetch" href="/assets/js/14.21abeab5.js"><link rel="prefetch" href="/assets/js/15.62e779e0.js"><link rel="prefetch" href="/assets/js/16.81b2b2ef.js"><link rel="prefetch" href="/assets/js/17.23b99257.js"><link rel="prefetch" href="/assets/js/18.a999b8b6.js"><link rel="prefetch" href="/assets/js/19.807aaab3.js"><link rel="prefetch" href="/assets/js/21.c5366768.js"><link rel="prefetch" href="/assets/js/22.5fdff440.js"><link rel="prefetch" href="/assets/js/23.6d470fbc.js"><link rel="prefetch" href="/assets/js/24.0992162f.js"><link rel="prefetch" href="/assets/js/25.d65e4653.js"><link rel="prefetch" href="/assets/js/26.4be4ef64.js"><link rel="prefetch" href="/assets/js/27.610114bb.js"><link rel="prefetch" href="/assets/js/28.9f51bd74.js"><link rel="prefetch" href="/assets/js/29.266f7b10.js"><link rel="prefetch" href="/assets/js/3.73c3ee7b.js"><link rel="prefetch" href="/assets/js/30.e00a63b3.js"><link rel="prefetch" href="/assets/js/31.0430cb93.js"><link rel="prefetch" href="/assets/js/32.0c319e0d.js"><link rel="prefetch" href="/assets/js/33.65e63c27.js"><link rel="prefetch" href="/assets/js/34.0c068616.js"><link rel="prefetch" href="/assets/js/35.a9cbe4c7.js"><link rel="prefetch" href="/assets/js/36.69d70537.js"><link rel="prefetch" href="/assets/js/37.08289e92.js"><link rel="prefetch" href="/assets/js/38.aab72032.js"><link rel="prefetch" href="/assets/js/39.d54086d4.js"><link rel="prefetch" href="/assets/js/4.c5f4be1b.js"><link rel="prefetch" href="/assets/js/40.988b7b70.js"><link rel="prefetch" href="/assets/js/41.6dd6c2ef.js"><link rel="prefetch" href="/assets/js/42.0e74a0c5.js"><link rel="prefetch" href="/assets/js/43.3391aaae.js"><link rel="prefetch" href="/assets/js/44.da2ddf64.js"><link rel="prefetch" href="/assets/js/45.67142dec.js"><link rel="prefetch" href="/assets/js/46.286cface.js"><link rel="prefetch" href="/assets/js/47.b4b24a87.js"><link rel="prefetch" href="/assets/js/48.733fe4cb.js"><link rel="prefetch" href="/assets/js/49.022233ca.js"><link rel="prefetch" href="/assets/js/5.5ac32b68.js"><link rel="prefetch" href="/assets/js/50.0b06a7da.js"><link rel="prefetch" href="/assets/js/51.e69716c2.js"><link rel="prefetch" href="/assets/js/6.788f7cb0.js"><link rel="prefetch" href="/assets/js/7.bb646a5c.js"><link rel="prefetch" href="/assets/js/8.d60f6fd1.js"><link rel="prefetch" href="/assets/js/9.d765786c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f089aea3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1c9cd124.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-003a9abb><section class="navbar"><header class="navbar__header"><section class="navbar__block"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Knowledge base" class="logo"> <img src="/logo-short.svg" alt="Knowledge base" class="logo-short"></a> <div class="site-name">
        Knowledge base
      </div> <form id="search-form" class="algolia-search-wrapper search-box"><input id="algolia-search-input" placeholder="Search" class="search-query"></form></section> <section class="navbar__block"><button class="menu-btn menu-btn--products-list"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon icon--products-list"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg>
        Products
      </button> <button class="navbar-btn navbar-btn--submit-request">Submit request</button> <div class="links" style="max-width:nullpx;"><a href="https://cloudlinux.com/trial" target="_blank" class="navbar-btn navbar-btn--try-free">Try Free</a> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><span class="title">Language:</span> <a class="dropdown-title"><span class="text">En</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/kb/HowDoI/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">Русский</a></li></ul></div></div></nav></div></section></header> <!----></section> <div class="sidebar-mask"></div> <div class="sidebar"> <ul class="sidebar-links"><li><div class="sidebar-group first"><div class="sidebar-heading open"><span>Content</span> <!----></div> <ul class="sidebar-group-items"><li><a href="/kb/Billing/" class="sidebar-link">Billing and Licensing</a></li><li><a href="/kb/KernelCare/" class="sidebar-link">KernelCare</a></li><li><a href="/kb/Imunify/" class="sidebar-link">Imunify</a></li><li><a href="/kb/FAQ/" class="sidebar-link">FAQ</a></li><li><a href="/kb/Technology/" class="sidebar-link">Technology</a></li><li><a href="/kb/HowDoI/" class="active sidebar-link">How Do I</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kb/HowDoI/#what-are-the-recommended-resource-limit-values" class="sidebar-link">What are the recommended resource limit values?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-can-i-remove-alt-php-binaries-from-multi-php-manager-in-ea4" class="sidebar-link">How can I remove Alt-PHP binaries from Multi-PHP Manager in EA4?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#adding-cloudlinux-os-image-to-digitalocean" class="sidebar-link">Adding CloudLinux OS image to DigitalOcean</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-can-i-switch-cloudlinux-usage-statistics-off" class="sidebar-link">How can I switch CloudLinux usage statistics off?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#pear-installation" class="sidebar-link">PEAR installation</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#newrelic-configuration-and-troubleshooting-steps" class="sidebar-link">NewRelic configuration and troubleshooting steps</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-add-xvfb-wkhtmltopdf-to-the-cagefs" class="sidebar-link">How to add xvfb, wkhtmltopdf to the CageFS?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#php-composer-installation-howto" class="sidebar-link">PHP composer installation howto</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#fix-http-error-404-not-found-errors-in-yum" class="sidebar-link">Fix HTTP Error 404 - Not Found errors in yum</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-migrate-all-cloudlinux-os-settings-to-another-server" class="sidebar-link">How to migrate all CloudLinux OS settings to another server?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-restore-php-selector-options-after-restore-or-migration" class="sidebar-link">How to restore PHP Selector options after restore or migration?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-check-email-pipe-issue" class="sidebar-link">How to check email pipe issue?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#configure-cloudlinux-os-features-php-and-mod-lsapi-on-a-server-with-no-control-panel" class="sidebar-link">Configure CloudLinux OS features, PHP and mod_lsapi on a server with no control panel</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#fix-rpmdb-thread-died-in-berkeley-db-library" class="sidebar-link">Fix rpmdb: Thread died in Berkeley DB library</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-move-the-mysql-data-folder" class="sidebar-link">How to move the mysql data folder</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-obtain-activation-keys-register-and-migrate-servers" class="sidebar-link">How to obtain activation keys, register and migrate servers?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-fix-duplicated-packages-issue" class="sidebar-link">How do I fix duplicated packages issue?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-obtain-vmcore-on-xen-kvm-virtual-machines-with-virsh" class="sidebar-link">How To Obtain Vmcore on Xen/KVM Virtual Machines with Virsh?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-add-java-to-cagefs" class="sidebar-link">How to add java to CageFS?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#php-selector-useful-commands" class="sidebar-link">PHP Selector useful commands</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-install-cwp-centos-web-panel-and-configure-it-for-php-selector" class="sidebar-link">How to install CWP (CentOS Web Panel) and configure it for PHP Selector?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-manually-update-mod-hostinglimits-on-cpanel" class="sidebar-link">How to manually update mod_hostinglimits on cPanel?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-move-opt-alt" class="sidebar-link">How to move /opt/alt</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-enable-lve-and-php-selector-in-litespeed" class="sidebar-link">How do I enable LVE and PHP Selector in LiteSpeed?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-use-3rd-party-rpm-repositories-without-facing-conflicts" class="sidebar-link">How do I use 3rd party RPM repositories without facing conflicts?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-can-i-run-service-inside-lve" class="sidebar-link">How can I run service inside LVE?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-configure-cloudlinux-kernel-on-xen-pv" class="sidebar-link">How do I configure CloudLinux kernel on Xen PV?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-install-hyper-v-integrated-components" class="sidebar-link">How do I install Hyper-V integrated components?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-move-usr-share-cagefs-skeleton-to-other-place-because-of-low-disk-space" class="sidebar-link">How do I move /usr/share/cagefs-skeleton to other place because of low disk space?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-move-user-s-home-folder-to-another-location-if-i-have-cagefs-installed" class="sidebar-link">How do I move user's home folder to another location if I have CageFS installed?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-install-xen-tools-guest-utilities-on-citrix-xenserver-6-1-or-xen-cloud-platform-6-1" class="sidebar-link">How to install Xen tools (guest utilities) on Citrix Xenserver 6.1 or Xen Cloud Platform 6.1?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-calculate-reasonable-inode-limit" class="sidebar-link">How do I calculate reasonable inode limit?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-create-local-cloudlinux-repository-mirror" class="sidebar-link">How do I create local CloudLinux repository mirror?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-install-cloudlinux-from-scratch-or-convert-existing-server" class="sidebar-link">How do I install CloudLinux from scratch or convert existing server?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-install-vmware-tools-improving-server-performance-when-on-vmware" class="sidebar-link">How do I install VMware-Tools/Improving server performance when on VMware?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-convert-linode-centos-vps-to-cloudlinux" class="sidebar-link">How do I convert Linode CentOS VPS to CloudLinux?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-view-lveinfo-for-more-than-10-users" class="sidebar-link">How do I view lveinfo for more than 10 users?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-enable-pygrub-in-hypervm" class="sidebar-link">How do I enable pygrub in HyperVM?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-set-resize-my-aws-instance-storage-size" class="sidebar-link">How do I set/resize my AWS instance storage size?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-install-and-configure-kdump-to-obtain-vmcore" class="sidebar-link">How to install and configure kdump to obtain vmcore?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-obtain-vmcore-when-the-server-is-unresponsive" class="sidebar-link">How To Obtain Vmcore When the Server is Unresponsive?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-upgrade-cloudlinux-os-6-to-cloudlinux-os-7" class="sidebar-link">How to upgrade CloudLinux OS 6 to CloudLinux OS 7?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-do-i-choose-which-kernel-to-boot-on-cloudlinux-os-7" class="sidebar-link">How do I choose which kernel to boot on CloudLinux OS 7?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#sharing-more-directories-with-single-user-account-over-cagefs" class="sidebar-link">Sharing more directories with single user account over CageFS</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-cpu-usage-is-calculated" class="sidebar-link">How CPU usage is calculated?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#high-iowait-and-or-load-average-when-apc-enabled-in-php-selector" class="sidebar-link">High iowait and/or load average when APC enabled in PHP Selector</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#why-alt-php-ini-files-become-overwritten-after-alt-php-updates" class="sidebar-link">Why alt-php.ini files become overwritten after Alt-PHP updates?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-patch-php-fpm-binary-file" class="sidebar-link">How to patch PHP-FPM binary file?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#different-php-versions-per-directories-using-suphp" class="sidebar-link">Different PHP versions per directories using suPHP</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#integrating-ldap-users-with-cagefs" class="sidebar-link">Integrating LDAP users with CageFS</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-activate-inode-usage-displaying-in-cpanel" class="sidebar-link">How to activate inode usage displaying in cPanel?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-fix-cpanel-mailing-list-archiving-functionality-when-link-traversal-protection-is-enabled" class="sidebar-link">How to fix cPanel mailing list archiving functionality when link traversal protection is enabled?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-mount-a-directory-inside-cagefs-for-particular-users-only" class="sidebar-link">How to mount a directory inside CageFS for particular users only?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-add-own-comments-to-php-versions-in-php-selector" class="sidebar-link">How to add own comments to PHP versions in PHP Selector?</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#running-cloudlinux-os-7-with-ovh-server" class="sidebar-link">Running CloudLinux OS 7 with OVH server</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#managing-mysql-packages-on-cpanel-server-for-mysql-governor-installed" class="sidebar-link">Managing MySQL packages on cPanel server for MySQL Governor installed</a></li><li class="sidebar-sub-header"><a href="/kb/HowDoI/#how-to-run-redmine-with-ruby-selector" class="sidebar-link">How to run Redmine with Ruby Selector?</a></li></ul></li><li><a href="/kb/Troubleshooting/" class="sidebar-link">Troubleshooting</a></li></ul></div></li></ul> </div> <div class="page"> <div class="breadcrumb-wrapper page-breadcrumb" data-v-5e0e0acf><span class="breadcrumb-title" data-v-5e0e0acf>Knowledge base:</span> <a href="/kb/" class="breadcrumb router-link-active" data-v-5e0e0acf>
    KB
  </a><a href="/kb/HowDoI/" class="breadcrumb router-link-exact-active router-link-active" data-v-5e0e0acf>
    How Do I
  </a></div> <div class="page-nav-wrapper"><div class="page-nav"><a href="/kb/Technology/" class="nav-arrow left"></a> <a href="/kb/Troubleshooting/" class="nav-arrow right"></a></div></div> <div class="content content__default"><h1 id="how-do-i"><a href="#how-do-i" class="header-anchor">#</a> How Do I</h1> <h2 id="what-are-the-recommended-resource-limit-values"><a href="#what-are-the-recommended-resource-limit-values" class="header-anchor">#</a> What are the recommended resource limit values?</h2> <p>The recommended values don't depend on the power of your server. They only depend on how &quot;fast&quot; you want your hosting accounts to be.</p> <p><em>Typical Hosting Account</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>SPEED=100%
PMEM=512MB
VMEM=0
IO=1024KB/s
IOPS=1024
NPROC=100
EP=20
</code></pre></div></div> <p><em>High End Hosting Account</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>SPEED=200%  
PMEM=1GB  
VMEM=0  
IO=4096KB/s  
IOPS=1024  
NPROC=100  
EP=40
</code></pre></div></div> <p>More information about LVE limits can be found at:
<a href="https://docs.cloudlinux.com/limits/" target="_blank" rel="noopener noreferrer">https://docs.cloudlinux.com/limits/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="how-can-i-remove-alt-php-binaries-from-multi-php-manager-in-ea4"><a href="#how-can-i-remove-alt-php-binaries-from-multi-php-manager-in-ea4" class="header-anchor">#</a> How can I remove Alt-PHP binaries from Multi-PHP Manager in EA4?</h2> <p>You can remove Alt-PHP binaries from cPanel MultiPHP Manager.</p> <p>To do so set 'yes' or 'no' for the Alt-PHP versions in config file <em>/opt/alt/alt-php-config/alt-php.cfg</em> and run <strong>/opt/alt/alt-php-config/multiphp_reconfigure.py</strong>.</p> <p>This script manages SCL prefixes for the Alt-PHP - removes or creates prefixes in <em>/etc/scl/prefixes</em>.</p> <div class="notranslate"><p>/opt/alt/alt-php-config/alt-php.cfg:</p> <div class="language- extra-class"><pre class="language-text"><code>[MultiPHP Manager]
alt-php44 = no
alt-php51 = no
alt-php52 = no
alt-php53 = no
alt-php54 = no
alt-php55 = yes
alt-php56 = yes
alt-php70 = yes
alt-php71 = yes
alt-php72 = yes
</code></pre></div></div> <h2 id="adding-cloudlinux-os-image-to-digitalocean"><a href="#adding-cloudlinux-os-image-to-digitalocean" class="header-anchor">#</a> Adding CloudLinux OS image to DigitalOcean</h2> <p>Custom images are Linux distributions that have been modified to fit the specific needs of DigitalOcean users. In this guide, we will discuss some basics of importing a custom CloudLinux OS image.</p> <p>Importing custom images to DigitalOcean is free, as you are only charged for the storage of your image. To save money, you can easily import your image, start a Droplet from your image, and delete the image, so you don’t incur any storage costs.</p> <p>In this article we will describe how to add a qcow2 (QEMU/KVM) CloudLinux OS image as a custom image. You can find more information on image options at <a href="https://www.digitalocean.com/docs/images/custom-images/overview/" target="_blank" rel="noopener noreferrer">https://www.digitalocean.com/docs/images/custom-images/overview/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li><p>To choose the right image, navigate to <a href="https://download.cloudlinux.com/cloudlinux/images/#kvm-tab" target="_blank" rel="noopener noreferrer">https://download.cloudlinux.com/cloudlinux/images/#kvm-tab<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
Several different images are available for download (with and without a control panel).
<img src="/images/unnamed-2.png" alt="KVM images"></p></li> <li><p>Copy the link for the image you are going to use and log into <a href="https://blog.digitalocean.com/custom-images/cloud.digitalocean.com" target="_blank" rel="noopener noreferrer">cloud.digitalocean.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Click on ‘Images’ on the left of the screen and then choose “Custom Images”. Click the “Import via URL” button and paste the CloudLinux OS image link.
<img src="/images/unnamed-3.png" alt="Custom images"><br>
There are several options here, but the most important is ‘Choose a datacenter region’, i.e. which datacenter region your Droplets should be created in for this image.<br> <img src="/images/unnamed-4.png" alt="Upload"><br> <img src="/images/unnamed-5.png" alt="Tags"><br>
Click the “Upload Image” button and wait until the image is successfully uploaded.</p></li> <li><p>Add your public key to access your droplets using key-based authentication: navigate to the ‘Security’ sidebar menu and click the ‘Add SSH Key’ button. You can find more information about creating/adding SSH keys in <a href="https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/" target="_blank" rel="noopener noreferrer">this article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.<br> <img src="/images/unnamed-6.png" alt="New SSH Key"></p></li> <li><p>You will then be able to start a CloudLinux OS Droplet using the image. Note, your Droplet will be created in the same datacenter that your custom image resides in.<br> <img src="/images/unnamed-7.png" alt="Start a droplet"></p></li> <li><p>Now, use your preferred SSH client software to connect to your Droplet. You can find more information on SSH client setup <a href="https://www.digitalocean.com/docs/droplets/how-to/connect-with-ssh/" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.<br> <img src="/images/unnamed-8.png" alt="SSH Client"></p></li></ol> <h2 id="how-can-i-switch-cloudlinux-usage-statistics-off"><a href="#how-can-i-switch-cloudlinux-usage-statistics-off" class="header-anchor">#</a> How can I switch CloudLinux usage statistics off?</h2> <p>Starting with lve-utils 3.0-21.12 Beta, it is possible to permanently disable statistics gathering by adding <code>cl_statistics_enabled=0</code> parameter to <em>/etc/sysconfig/cloudlinux</em>.</p> <h2 id="pear-installation"><a href="#pear-installation" class="header-anchor">#</a> PEAR installation</h2> <p>If you wish to install Pear for cPanel PHP (native PHP version) for some user, then you can use the standard way provided by WHM/cPanel, but if the alt-PHP (PHP Selector) is used, then you (as root or as an user) need to install necessary Pear modules by using pear for current user php like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># /opt/alt/phpXX/usr/bin/pear install moduleName
</code></pre></div></div> <p>where <strong>XX</strong> is PHP version (for example 71 for PHP 7.1).
In this case <code>include_path</code> will contain the value <em>&quot;/opt/alt/php71/usr/share/pear&quot;</em></p> <p>Alternatively, you can set it manually in <em>/opt/alt/php71/etc/php.ini</em> directly (for PHP 7.1 as an example):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>include_path = &quot;.:/usr/share/pear:/opt/alt/php71/usr/share/php:/opt/alt/php71/usr/share/pear&quot;
</code></pre></div></div> <h2 id="newrelic-configuration-and-troubleshooting-steps"><a href="#newrelic-configuration-and-troubleshooting-steps" class="header-anchor">#</a> NewRelic configuration and troubleshooting steps</h2> <p>In case you want to configure NewRelic extension but get the errors like these</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[Wed Mar 15 14:56:43.240939 2017] [cgi:error] [pid 566485] [client 5.44.233.42:44548] AH01215: PHP Warning: PHP Startup: Unable to load dynamic library '/opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so' - /opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so: cannot open shared object file: No such file or directory in Unknown on line 0: /usr/local/cpanel/cgi-sys/ea-php56
[Wed Mar 15 14:56:43.510520 2017] [cgi:error] [pid 566609] [client 52.21.231.226:59007] AH01215: PHP Warning: PHP Startup: Unable to load dynamic library '/opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so' - /opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so: cannot open shared object file: No such file or directory in Unknown on line 0: /usr/local/cpanel/cgi-sys/ea-php56
[Wed Mar 15 14:56:44.771648 2017] [cgi:error] [pid 566368] [client 45.33.61.252:64742] AH01215: PHP Warning: PHP Startup: Unable to load dynamic library '/opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so' - /opt/alt/php70/usr/lib64/php/modules/newrelic-20160303.so: cannot open shared object file: No such file or directory in Unknown on line 0: /usr/local/cpanel/cgi-sys/ea-php56
</code></pre></div></div> <p>Please, make sure that Zend Extension Build and NewRelic PHP Extension Build are similar ( should be similar)
Zend Extension Build    API320151012,NTS
PHP Extension Build    API20151012,NTS</p> <p>configuration steps:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># ln -s /usr/lib/newrelic-php5/agent/x64/newrelic-20151012.so /opt/alt/php56/usr/lib64/php/modules/newrelic-20151012.so
# echo &quot;extension=newrelic-20151012.so&quot; &gt; /opt/alt/php56/etc/php.d.all/newrelic.ini
# cagefsctl --setup-cl-selector
# selectorctl -e newrelic -u myuser -v 5.6
</code></pre></div></div> <p><em>/usr/lib/newrelic-php5/agent/x64/</em> -  this is directory with different newrelic agents php<br>
We need to choose the version that we need regarding zend version<br>
The /usr/lib/newrelic-php5/ is uncompressed tar from <a href="https://download.newrelic.com/php_agent/release/newrelic-php5-7.0.0.186-linux.tar.gz" target="_blank" rel="noopener noreferrer">https://download.newrelic.com/php_agent/release/newrelic-php5-7.0.0.186-linux.tar.gz<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="how-to-add-xvfb-wkhtmltopdf-to-the-cagefs"><a href="#how-to-add-xvfb-wkhtmltopdf-to-the-cagefs" class="header-anchor">#</a> How to add xvfb, wkhtmltopdf to the CageFS?</h2> <p>The steps are:</p> <ol><li>Create <em>/etc/cagefs/conf.d/xvfb.cfg</em> and add:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[xvfb]
comment=xvfb
paths=/usr/bin/xvfb-run, /usr/bin/xauth, /usr/bin/Xvfb, /usr/bin/xkbcomp, /usr/bin/wkhtmltopdf, /usr/share/X11/xkb
</code></pre></div></div> <ol start="2"><li>Run:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --addrpm xkeyboard-config
</code></pre></div></div> <h2 id="php-composer-installation-howto"><a href="#php-composer-installation-howto" class="header-anchor">#</a> PHP composer installation howto</h2> <ol><li>Download installer:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/opt/alt/php55/usr/bin/php -d extension=json.so -d extension=phar.so -r &quot;readfile('https://getcomposer.org/installer');&quot; &gt; composer-setup.php
</code></pre></div></div> <ol start="2"><li>Install composer itself:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>php composer-setup.php --install-dir=/usr/local/bin/ --filename=composer
</code></pre></div></div> <ol start="3"><li>Generate cagefs config file to make it available for users:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>echo -e &quot;[composer]\ncomment=PHP Composer\npaths=/usr/local/bin/composer&quot; &gt; /etc/cagefs/conf.d/php-composer.cfg
</code></pre></div></div> <ol start="4"><li>Update cagefs:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/usr/sbin/cagefsctl --force-update
</code></pre></div></div> <ol start="5"><li><p>For the desired user enable JSON and PHAR with PHP-Selector as required for Composer.</p></li> <li><p>To make composer work with suhosin, the following change is needed for <em>/opt/alt/phpXX/etc/php.d.all/suhosin.ini</em><br>
(php70 example follows):</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ echo &quot;suhosin.executor.include.whitelist = phar&quot; &gt;&gt; /opt/alt/php70/etc/php.d.all/suhosin.ini
$ cagefsctl --rebuild-alt-php-ini
</code></pre></div></div> <h2 id="fix-http-error-404-not-found-errors-in-yum"><a href="#fix-http-error-404-not-found-errors-in-yum" class="header-anchor">#</a> Fix HTTP Error 404 - Not Found errors in yum</h2> <p>If you cannot install or update software via yum and you see 404 errors like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>http://repo.cloudlinux.com/kernelcare/7.4/x86_64/repodata/repomd.xml: [Errno 14] HTTP Error 404 - Not Found
http://repo.cloudlinux.com/other/cl7.3/mysqlmeta/cl-mariadb-10.1/x86_64/repodata/repomd.xml: [Errno 14] HTTP Error 404 - Not Found
</code></pre></div></div> <p>Please comment out the following line in <em>/etc/yum.conf</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>distroverpkg=cloudlinux-release
</code></pre></div></div> <p>You can run this command to comment out that line automatically:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>sed -r -i 's/^\s*(distroverpkg\s*=\s*cloudlinux-release)/#\1/g' /etc/yum.conf
</code></pre></div></div> <h2 id="how-to-migrate-all-cloudlinux-os-settings-to-another-server"><a href="#how-to-migrate-all-cloudlinux-os-settings-to-another-server" class="header-anchor">#</a> How to migrate all CloudLinux OS settings to another server?</h2> <p>To move LVE and packages limits, just move the <em>/etc/container/ve.cfg</em> file to a new server, and then run</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lvectl apply all
</code></pre></div></div> <p>If any modifications were made to CageFS - move the <em>/etc/cagefs/cagefs.mp</em> file, and/or <em>/etc/cagefs/conf.d</em> directory to a new server and run</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --force-update &amp;&amp; cagefsctl--remount-all
</code></pre></div></div> <p>For PHP-Selector - move the <em>/etc/cl.selector</em> directory and run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --setup-cl-selector
</code></pre></div></div> <p>To restore user's settings from PHP Selector, please refer to the <a href="/kb/HowDoI/#how-to-restore-php-selector-options-after-restore-or-migration">following</a> KnowledgeBase entry.</p> <p>Basically, the custom PHP settings migration plan is:</p> <ol><li>restore user home dirs</li> <li>remove all cagefs\selector directories with</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># rm -rf /var/cagefs/*/*/etc/cl.selector
# rm -rf /var/cagefs/*/*/etc/cl.php.d
</code></pre></div></div> <ol start="3"><li>regenerate them with</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --force-update-etc
</code></pre></div></div> <h2 id="how-to-restore-php-selector-options-after-restore-or-migration"><a href="#how-to-restore-php-selector-options-after-restore-or-migration" class="header-anchor">#</a> How to restore PHP Selector options after restore or migration?</h2> <p>For restoring PHP Selector options and alternate PHP version from the backup (<strong>cltest3</strong> is an example user user) do the following:</p> <ol><li>Restore <em>~cltest3/.cl.selector/</em> directory.</li> <li>Remove PHP Selector current files from CageFS directory. First, take CageFS prefix:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/sbin/cagefsctl --getprefix cltest3
</code></pre></div></div> <div class="language- extra-class"><pre class="language-text"><code>04
</code></pre></div><p>Then remove <em>cl.selector</em> and <em>cl.php.d</em> in user's <em>etc</em> directory:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ rm -rf /var/cagefs/04/cltest3/etc/cl.selector
$ rm -rf /var/cagefs/04/cltest3/etc/cl.php.d
</code></pre></div></div> <p>Run the command to recreate configs:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ /usr/sbin/cagefsctl --force-update-etc cltest3
</code></pre></div></div> <h2 id="how-to-check-email-pipe-issue"><a href="#how-to-check-email-pipe-issue" class="header-anchor">#</a> How to check email pipe issue?</h2> <p>The email piping is a technique of sending an email message as an input to a program rather than appending the message to the mailbox file, allowing for real-time email delivery and handling. Every mail server has its own rules and procedures for mail delivery, making it hard to provide common instructions for configuring an MTA.
In this article, we will discuss common email pipe issues on cPanel and Exim as MTA.</p> <p><strong>Creating a script</strong></p> <p>While creating a script, in the very first line we have to specify what should be used to interpret it (the shebang line). Suitable values may be:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#!/usr/bin/php -q
#!/usr/local/bin/php -q
</code></pre></div></div> <p>If you are using CageFS+PHP Selector, <em>/usr/bin/php</em> and <em>/usr/local/bin/php</em> are used for CGI/CLI binary versions appropriately.</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cat /etc/cl.selector/native.conf 
php=/usr/bin/php
php-cli=/usr/local/bin/php
php.ini=/usr/local/lib/php.ini
php-fpm=/usr/local/sbin/php-fpm
</code></pre></div></div> <p>Note the '-q' parameter. This suppresses header output as sometimes php just has to output something. If anything is output by php, the sender will receive a bounceback message containing, among other things, whatever php chose to output. We don't really want this.</p> <p><strong>Setting up the correct permissions</strong></p> <p>For mail to be piped to scripts, both the script and the directory it is in should have permissions of 0755.</p> <p><strong>Settings up email piping</strong></p> <p>Use the &quot;Pipe to a Program&quot; option to pipe email information to your script:<br> <em>cpanel user &gt; Forwarders &gt; Add Forwarder button &gt; Advanced Options &gt; choose &quot;Pipe to a Program&quot;</em><br>
When you use the &quot;Pipe to a Program&quot; option, enter a path that is relative to your home directory. For example, to use the <em>/home/user/script.php</em> script,
enter <em>script.php</em> in the &quot;Pipe to a Program&quot; text box, where user represents your username.</p> <p>After that, this user will have the following entry in <em>/etc/valiases/domain.com</em> file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cat /etc/valiases/domain.com 
test@domain.com: |/home/user/script.php
</code></pre></div></div> <p>where <em>domain.com</em> represents your domain name.</p> <p><strong>Troubleshooting</strong></p> <p>If you've written your script correctly, set the permissions on it and it's directory fine and created your email filter correctly everything will work.</p> <p>If in doubt, quickly check that all of the following are correct:</p> <ol><li>You have the correct shebang line</li> <li>Your script reads data from STDIN</li> <li>Your script has permissions of 0755</li> <li>The directory in which your script lives has permissions of 0755</li> <li>Your Forwarder is set up properly. Double check that the path to your script is correct.</li> <li>You have no extraneous carriage returns</li></ol> <p>Below is a simple php script, which can be used to test email piping:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>#!/usr/local/bin/php -q
&lt;?php
/* Read the message from STDIN */
$fd = fopen(&quot;php://stdin&quot;, &quot;r&quot;);
$email = &quot;&quot;; // This will be the variable holding the data.
while (!feof($fd)) {
$email .= fread($fd, 1024);
}
fclose($fd);
/* Saves the data into a file */
$fdw = fopen(&quot;/tmp/pipemail.txt&quot;, &quot;w+&quot;);
fwrite($fdw, $email);
fclose($fdw);
/* Script End */
?&gt;
</code></pre></div></div> <p>In order to setup this script, do the following:</p> <ol><li><p>Create php script with the content provided above inside user's home directory. For example:
<em>/home/user/test.php</em></p></li> <li><p>Make it executable:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># chmod 755 /home/user/test.php
</code></pre></div></div> <ol start="3"><li><p>Edit <em>/etc/valiases/domain.com</em> file:<br> <code>test@domain.com: |/home/user/test.php</code></p></li> <li><p>Tail exim_mainlog:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># tail -f /var/log/exim_mainlog
</code></pre></div></div> <ol start="5"><li><p>Sent an email to test@domain.com and check Exim log.</p></li> <li><p>Check <em>/home/user/.cagefs/tmp/pipemail.txt</em> file. If pipemail.txt has email content, then email piping works properly.
If pipemail.txt is empty or you still have issues, please submit a <a href="https://cloudlinux.zendesk.com/hc/requests/new" target="_blank" rel="noopener noreferrer">ticket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li></ol> <h2 id="configure-cloudlinux-os-features-php-and-mod-lsapi-on-a-server-with-no-control-panel"><a href="#configure-cloudlinux-os-features-php-and-mod-lsapi-on-a-server-with-no-control-panel" class="header-anchor">#</a> Configure CloudLinux OS features, PHP and mod_lsapi on a server with no control panel</h2> <p>This is a practical manual of setting up Apache + mod_lsapi + CageFS + PHP Selector on a server with no panel installed.</p> <p>It is assumed that our system has been converted and loaded with CloudLinux kernel. Since PHP Selector installation requires <a href="/cloudlinux_os_components/#cagefs/">CageFS</a> and <a href="/lve_manager/">LVE Manager</a> installed in the system, let's start with CageFS installation:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install cagefs
</code></pre></div></div> <p>Next we'll need to install LVE Manager:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install lvemanager
</code></pre></div></div> <p>Then install Apache and native PHP:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install httpd
# yum install php-cli
</code></pre></div></div> <p>Then install mod_lsapi:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install liblsapi liblsapi-devel
# yum install mod_lsapi
</code></pre></div></div> <p>Finally, install PHP Selector:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum groupinstall alt-php
</code></pre></div></div> <p>Now let's configure components. Initialize CageFS and enable for all users:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --init
# cagefsctl --enable-all
</code></pre></div></div> <p>Initialize mod_lsapi (few errors will appear, this is normal, please ignore them):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># /usr/bin/switch_mod_lsapi --setup
</code></pre></div></div> <p>Enable mod_lsapi PHP handler:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># sed -i 's/#AddType/AddType/' /etc/httpd/conf.d/lsapi.conf
</code></pre></div></div> <p>Update CageFS skeleton:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --force-update
</code></pre></div></div> <p>We also need to open access to 80 port:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># firewall-cmd --zone=public --permanent --add-port=80/tcp
# firewall-cmd --reload
</code></pre></div></div> <p>Now we are ready to set up a website. Let's create user first:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># adduser cltest1
</code></pre></div></div> <p>Change home directory permissions to allow httpd access it:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># chmod 711 /home/cltest1
</code></pre></div></div> <p>Create required directories:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># su cltest1 -c &quot;mkdir ~/public_html{,/logs,/cgi-bin}&quot;
</code></pre></div></div> <p>Finally, let's add website to Apache configuration. Create a file <em>/etc/httpd/conf.d/vhosts.conf</em> with the following contents:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;VirtualHost *:80&gt;
  ServerName default
  DocumentRoot /var/www/html
&lt;/VirtualHost&gt;
&lt;VirtualHost *:80&gt;
  ServerAdmin cltest1@example.com
  DocumentRoot &quot;/home/cltest1/public_html&quot;
  ServerName example.com
  ServerAlias www.example.com
  ErrorLog &quot;/home/cltest1/public_html/logs/error.log&quot;
  CustomLog &quot;/home/cltest1/public_html/logs/access.log&quot; common
  ScriptAlias /cgi-bin/ &quot;/home/cltest1/public_html/cgi-bin/&quot;
  SuexecUserGroup cltest1 cltest1
  &lt;Directory &quot;/home/cltest1&quot;&gt;
    AllowOverride All
  &lt;/Directory&gt;
  &lt;Directory &quot;/home/cltest1/public_html/cgi-bin&quot;&gt;
    AllowOverride None
    Options None
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre></div></div> <p>Please note, first VirtualHost must be defined only once, it will be used for requests that didn't match any other VirtualHost.</p> <p>Everything is ready now. Restart Apache httpd:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># systemctl restart httpd.service
</code></pre></div></div> <p>You can now use <a href="/command-line_tools/#selectorctl">selectorctl</a> utility to select PHP versions for your users.</p> <h2 id="fix-rpmdb-thread-died-in-berkeley-db-library"><a href="#fix-rpmdb-thread-died-in-berkeley-db-library" class="header-anchor">#</a> Fix rpmdb: Thread died in Berkeley DB library</h2> <p>If you see rpmdb errors during package management (during yum/rpm operations), like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>rpmdb: Thread/process 277623/140429100390144 failed: Thread died in Berkeley DB library
error: db3 error(-30974) from dbenv-&gt;failchk: DB_RUNRECOVERY: Fatal error, run database recovery
error: cannot open Packages index using db3 -  (-30974)
error: cannot open Packages database in /var/lib/rpm
CRITICAL:yum.verbose.cli.yumcompletets:Yum Error: Error: rpmdb open failed
</code></pre></div></div> <p>It means that the RPM database is corrupted.</p> <p><strong>A similar error can be triggered in LVE Manager Installation Wizard:</strong></p> <p><img src="/images/image001.png" alt="DB broken"></p> <p><strong>Solution:</strong></p> <p>Please follow these steps to backup and rebuild rpmdb database:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># mkdir /var/lib/rpm/backup
# cp -a /var/lib/rpm/__db* /var/lib/rpm/backup/
# rm -f /var/lib/rpm/__db.[0-9][0-9]*
# rpm --quiet -qa
# rpm --rebuilddb
# yum clean all
</code></pre></div></div> <h2 id="how-to-move-the-mysql-data-folder"><a href="#how-to-move-the-mysql-data-folder" class="header-anchor">#</a> How to move the mysql data folder</h2> <ol><li>Make a full mysqldump file</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># mysqldump --opt -uroot -proot_password &gt; /tmp/mysqldump
</code></pre></div></div> <ol start="2"><li>Disable Mysql monitoring</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>whmapi1 configureservice service=mysql enabled=1 monitored=0
</code></pre></div></div> <ol start="3"><li>Stop MySQL</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># systemctl stop mysql
</code></pre></div></div> <ol start="4"><li>Ensure that the following settings are present</li></ol> <p>check file <em>/etc/systemd/system/mariadb.service.d/homedir.conf</em></p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[Service]
ProtectHome=false
ProtectSystem=off
</code></pre></div></div> <ol start="5"><li>Make the directory for MySQL in /home, move it and symlink it:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># mkdir /home/var_mysql
# mv /var/lib/mysql /home/var_mysql
# chown -R mysql:mysql /home/var_mysql/mysql
# ln -s /home/var_mysql/mysql /var/lib/mysql
</code></pre></div></div> <ol start="6"><li>Remount CageFS system-wide:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cagefsctl --remount-all
</code></pre></div></div> <ol start="7"><li>Start MySQL:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># systemctl start mysql
</code></pre></div></div> <ol start="8"><li>Enable Mysq monitoring</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>whmapi1 configureservice service=mysql enabled=1 monitored=1
</code></pre></div></div> <h2 id="how-to-obtain-activation-keys-register-and-migrate-servers"><a href="#how-to-obtain-activation-keys-register-and-migrate-servers" class="header-anchor">#</a> How to obtain activation keys, register and migrate servers?</h2> <p>There are two ways to get started with CloudLinux OS. You can either convert your existing system or install CloudLinux on a new server. In either case, you will need the activation key.</p> <p>If you purchased CloudLinux OS through one of our partners, they will provide you with an IP-based license directly.</p> <p><strong>Getting the activation key</strong></p> <p>You can start by using a 30-day free trial key, which can be obtained through the CloudLinux Network (our self-service web portal), also called CLN.
New CloudLinux OS activation key can be created through CLN as described <a href="https://docs.cln.cloudlinux.com/index.html?cloudlinux_os_activation_keys.htm" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Note, you cannot use a new trial key on a system that is already using a trial key.
Otherwise, you will receive the following error message:</p> <p><code>The IP &lt;ip-address&gt; was already used for trialing on &lt;registation date&gt;</code></p> <p>This error message is valid for CloudLinux OS and KernelCare.</p> <p><strong>Migrating licenses and servers</strong></p> <p>When you migrate from the trial activation key to a paid one, you have to re-register your installation from the command line interface (server console - run it as root):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># rhnreg_ks --activationkey=&lt;newkey&gt; --force
</code></pre></div></div> <p>For IP-based licenses you may have received from CloudLinux partners, the syntax is different:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># clnreg_ks --force
</code></pre></div></div> <p>If you need to reinstall your server, migrate to new hardware or perform any kind of license migration, login to CLN, remove old server(s) in the &quot;Servers&quot; section. After that, you will be able to register a new server with the same activation key. More information about server management can be found <a href="https://docs.cln.cloudlinux.com/index.html?servers.htm" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>If you want to migrate key-based licenses provided by Plesk (starts with 7003*), please open a new support <a href="https://cloudlinux.zendesk.com/hc/requests/new" target="_blank" rel="noopener noreferrer">ticket<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Don't worry - the server removal will not affect your customer's websites' operation. Only software update (yum update) and the LVE Manager plugin will become inactive. All the other CloudLinux OS features will continue to work properly.</p> <p>After removing the servers you no longer need, click on Licenses and pick an activation key with free license slots. Use that key to register your new CloudLinux server from CLI in two simple steps:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install rhn-setup --enablerepo=cloudlinux-base
# rhnreg_ks --activationkey=&lt;newkey&gt; --force
</code></pre></div></div> <p>for IP-based licenses:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># clnreg_ks --force
</code></pre></div></div> <p>In case of server migration, you don’t need another activation key to proceed. First, remove the old server from CLN, activate the new server with the same activation key and proceed with the migration.</p> <p>Otherwise, you will receive the following error message:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>Error Message: 
Maximum usage count of X reached 
Error Class Code: 61 
Error Class Info: Too many systems registered using this registration token 
Explanation: 
An error has occurred while processing your request. If this problem 
persists please enter a bug report at helpdesk.cloudlinux.com. 
If you choose to submit the bug report, please be sure to include 
details of what you were trying to do when this error occurred and 
details on how to reproduce this problem.

See /var/log/up2date for more information
</code></pre></div></div> <p>In case something went wrong or you need our assistance, please contact our <a href="https://cloudlinux.zendesk.com/hc/requests/new" target="_blank" rel="noopener noreferrer">support<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="how-do-i-fix-duplicated-packages-issue"><a href="#how-do-i-fix-duplicated-packages-issue" class="header-anchor">#</a> How do I fix duplicated packages issue?</h2> <p>Sometimes after incorrect updates duplicated packages appear in the system, for example:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;...&gt;
alt-python27-2.7.13-3.el6.x86_64 is a duplicate with alt-python27-2.7.11-7.el6.x86_64
alt-python27-2.7.13-4.el6.x86_64 is a duplicate with alt-python27-2.7.13-3.el6.x86_64
alt-python27-libs-2.7.13-3.el6.x86_64 is a duplicate with alt-python27-libs-2.7.11-7.el6.x86_64
alt-python27-libs-2.7.13-4.el6.x86_64 is a duplicate with alt-python27-libs-2.7.13-3.el6.x86_64
&lt;...&gt;
</code></pre></div></div> <p>First of all, we need the full list of dupes:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>package-cleanup --dupes | tail -n +3
</code></pre></div></div> <p>We'll also need to save this list into a file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>package-cleanup --dupes | tail -n +3 &gt; duplist.txt
</code></pre></div></div> <p><strong>The main idea is to do the following (for each package)</strong>:</p> <ol><li>Remove the lowest version from the rpmdb: <code>rpm -e --justdb --nodeps $PKGNAME</code></li> <li>Reinstall the highest version: <code>yum -y reinstall $PKGNAME</code></li></ol> <p>It is a good idea to check what is going to be done before real operations:</p> <p>(This will only display a list of all the commands without execution)</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat duplist.txt | sort --version-sort | awk 'NR % 2 {print &quot;rpm -e --justdb --nodeps &quot; $1 } !(NR % 2) {match($0, &quot;-[0-9]&quot;);print &quot;yum -y reinstall &quot; substr($0,0,RSTART-1)}'
</code></pre></div></div> <p>Then we perform the necessary operations:</p> <p>(&quot;pipe sh&quot; has been added at the end in order to execute the sequence):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat duplist.txt | sort --version-sort | awk 'NR % 2 {print &quot;rpm -e --justdb --nodeps &quot; $1 } !(NR % 2) {match($0, &quot;-[0-9]&quot;);print &quot;yum -y reinstall &quot; substr($0,0,RSTART-1)}' | sh
</code></pre></div></div> <p>Alternatively, all this could be performed without an intermediary file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>package-cleanup --dupes | tail -n +3 | sort --version-sort | awk 'NR % 2 {print &quot;rpm -e --justdb --nodeps &quot; $1 } !(NR % 2) {match($0, &quot;-[0-9]&quot;);print &quot;yum -y reinstall &quot; substr($0,0,RSTART-1)}' | sh
</code></pre></div></div> <h2 id="how-to-obtain-vmcore-on-xen-kvm-virtual-machines-with-virsh"><a href="#how-to-obtain-vmcore-on-xen-kvm-virtual-machines-with-virsh" class="header-anchor">#</a> How To Obtain Vmcore on Xen/KVM Virtual Machines with Virsh?</h2> <ol><li>Make sure you have libvirt tools installed on your KVM host (dom0 for Xen):</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install libvirt -y
</code></pre></div></div> <ol start="2"><li>Make sure virsh utility is installed:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>virsh --version
2.0.0
</code></pre></div></div> <ol start="3"><li><p>Login to the Guest OS.</p></li> <li><p>Let the VM wait before rebooting on kernel panic:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>sysctl kernel.panic=10000 (number of seconds to wait)
</code></pre></div></div> <ol start="5"><li><p>Wait until the Guest OS is crashed.</p></li> <li><p>Gather VM dump with virsh:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>virsh dump domain_name --memory-only --format=kdump-zlib
</code></pre></div></div> <p>FYI: If your virsh utility doesn’t support --format option, just skip it:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>virsh dump domain_name --memory-only
</code></pre></div></div> <ol start="7"><li>Upload the dump onto the dump server.</li></ol> <h2 id="how-to-add-java-to-cagefs"><a href="#how-to-add-java-to-cagefs" class="header-anchor">#</a> How to add java to CageFS?</h2> <p>If you would like to make java available from inside CageFS, perform the following steps:</p> <ol><li>Create <em>/etc/cagefs/conf.d/java.cfg</em> and add proper binary files to it:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/cagefs/conf.d/java.cfg
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[java-custom]
comment=Java-custom
paths=/usr/bin/java, /etc/alternatives/java
</code></pre></div></div> <ol start="2"><li>Update skeleton and remount all:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ cagefsctl --force-update
$ cagefsctl --remount-all
</code></pre></div></div> <h2 id="php-selector-useful-commands"><a href="#php-selector-useful-commands" class="header-anchor">#</a> PHP Selector useful commands</h2> <ul><li>Getting current PHP version for a user:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --user-current --user=UU
</code></pre></div></div> <ul><li>Changing PHP version for a user:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --set-user-current=5.3 --user=UU
</code></pre></div></div> <ul><li>Enabling some extensions for a user:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --enable-user-extensions=pdo,phar --version=5.3 --user=UU
</code></pre></div></div> <p>Extensions disabling is done the same way.</p> <ul><li>List user extensions:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --list-user-extensions --version=5.3 --user=UU
</code></pre></div></div> <ul><li>Replace option in users php.ini:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --replace-options=log_errors:on,display_errors:on --version=5.3 --user=UU
</code></pre></div></div> <ul><li>Enable some PHP module for all existing accounts (cPanel servers only):</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cd /var/cpanel/users; ls -1 | grep -v '^.' | awk '{ print &quot;selectorctl some_cool_keys --user=&quot;$1 }' | sh
</code></pre></div></div> <p>Servers with other control panels or non-panel:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># for u in cat /etc/passwd|awk -F: '($3&gt;=500)'| cut -f &quot;1&quot; -d :; do selectorctl some_cool_keys --user=$u; done
</code></pre></div></div> <p>where 'some_cool_keys' - any selectorctl options from <a href="/command-line_tools/#selectorctl">here</a></p> <ul><li>Reset user extensions to default settings:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --list-users --version=5.6 | sed -e 's/,/\n/g' | sed 's/^/selectorctl --reset-user-extensions --version=5.6 --user=/'
</code></pre></div></div> <p>If you run it:</p> <ol><li><p>The script will generate a list of users who use PHP 5.6</p></li> <li><p>The script will generate a separate command to reset the modules for each user</p></li> <li><p>If you add | sh at the end of the command, the modules will be reset for all users that have PHP 5.6 Example:</p></li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --list-users --version=5.6 | sed -e 's/,/\n/g' | sed 's/^/selectorctl --reset-user-extensions --version=5.6 --user=/' | sh
</code></pre></div></div> <ul><li>Change PHP version for all users:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># selectorctl --change-to-version=5.3 --version=native #this command changes PHP version to 5.3 for all users with native version
</code></pre></div></div> <p>or, you can change PHP version for all users using the commands below:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cd /var/cpanel/users
# ls -1 | awk '{ print &quot;selectorctl --set-user-current=5.3 --user=&quot;$1 }' | sh
</code></pre></div></div> <h2 id="how-to-install-cwp-centos-web-panel-and-configure-it-for-php-selector"><a href="#how-to-install-cwp-centos-web-panel-and-configure-it-for-php-selector" class="header-anchor">#</a> How to install CWP (CentOS Web Panel) and configure it for PHP Selector?</h2> <p>CentOS Web Panel and its features are described on the official <a href="http://centos-webpanel.com/features" target="_blank" rel="noopener noreferrer">website<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>The installation is straightforward:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cd /usr/local/src
wget http://dl1.centos-webpanel.com/files/cwp-latest.sh
sh cwp-latest.sh
</code></pre></div></div> <p>During the install, it builds Apache and PHP from source. To make PHP Selector work we need to build patched suPHP:</p> <ul><li>download/unpack suPHP (0.7.1 an as example):</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cd /usr/local/src/
wget http://www.suphp.org/download/suphp-0.7.1.tar.gz
cd suphp-0.7.1
</code></pre></div></div> <ul><li>download/unpack our patches:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>wget http://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz
tar xfz cl-apache-patches.tar.gz
</code></pre></div></div> <ul><li>apply our patch:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>patch -p1 &lt; suphp-0.7.1-cagefs.patch
</code></pre></div></div> <ul><li>if apache 2.4 is used - modify configure file to adopt suPHP sources for it, open a file:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>vi configure
</code></pre></div></div> <ul><li>find section</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>    major_version=`echo $APACHE_VERSION|cut -f1,2 -d.`
    if test &quot;$major_version&quot; = &quot;2.0&quot; -o &quot;$major_version&quot; = &quot;2.2&quot;; then
      APACHE_VERSION_2=true
      APACHE_VERSION_1_3=false
    else
      APACHE_VERSION_2=false
      APACHE_VERSION_1_3=true
</code></pre></div></div> <p>and modify second line as follows:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>    if test &quot;$major_version&quot; = &quot;2.0&quot; -o &quot;$major_version&quot; = &quot;2.2&quot; -o &quot;$major_version&quot; = &quot;2.4&quot;; then
</code></pre></div></div> <ul><li>build suphp:</li></ul> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>./configure --with-apr=/usr/local/apr/ --with-apxs=/usr/local/apache/bin/apxs -with-setid-mode=paranoid --with-apache-user=nobody --with-gnu-ld --disable-checkpath --sysconfdir=/usr/local/etc --sbindir=/usr/local/sbin
make
make install
</code></pre></div></div> <p>When done, check if suPHP binary has necessary code, the output should be following:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>strings /usr/local/sbin/suphp | grep jail
</code></pre></div></div> <p><em><code>lve_jail_uid CageFS jail error</code></em></p> <p>And change (create) <em>/etc/cl.selector/native.conf</em> to look this way:</p> <p><em><code>php=/usr/local/bin/php-cgi php-cli=/usr/local/bin/php php.ini=/usr/local/php/php.ini php-fpm=/usr/local/sbin/php-fpm</code></em></p> <h2 id="how-to-manually-update-mod-hostinglimits-on-cpanel"><a href="#how-to-manually-update-mod-hostinglimits-on-cpanel" class="header-anchor">#</a> How to manually update mod_hostinglimits on cPanel?</h2> <p>When we release an update for mod_hostinglimits, we send it to cPanel team to implement in EasyApache. Overall, the procedure requires some time due to quite complicated process. Here is the way to update mod_hostinglimits manually on cPanel servers. Check current version:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>strings /usr/local/apache/modules/mod_hostinglimits.so | grep version -i
</code></pre></div></div> <p><em><code>mod_hostinglimits: version 1.0-16. LVE mechanism enabled</code></em></p> <p>Update from source (version 1.0-19 as an example):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>wget http://repo.cloudlinux.com/cloudlinux/sources/da/mod_hostinglimits-1.0-19.tar.gz
tar xfz mod_hostinglimits-1.0-19.tar.gz
cd mod_hostinglimits-1.0-19
cmake .
make
make install
</code></pre></div></div> <p>Check version:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>strings /usr/local/apache/modules/mod_hostinglimits.so | grep version -i
</code></pre></div></div> <p><em><code>mod_hostinglimits: version 1.0-19. LVE mechanism enabled</code></em></p> <p>Finally, restart Apache to apply changes:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/etc/init.d/httpd restart
</code></pre></div></div> <h2 id="how-to-move-opt-alt"><a href="#how-to-move-opt-alt" class="header-anchor">#</a> How to move /opt/alt</h2> <p>In rare cases, customer wants to move <em>/opt/alt</em> to a different place. To do this:</p> <ol><li><p>Move <em>/opt/alt</em> somewhere (<code>mv /opt/alt /var/opt_alt</code>).</p></li> <li><p>Create <em>/opt/alt</em> directory (<code>mkdir /opt/alt</code>).</p></li> <li><p>Bind mount the new path to the old one: (<code>mount -o bind /var/opt_alt /opt/alt</code>).</p></li> <li><p>Remount CageFS (<code>cagefsctl --remount-all</code>).</p></li> <li><p>Add an entry to <em>/etc/fstab</em>, for example: <code>/var/opt_alt /opt/alt none bind 0 0</code>.</p></li></ol> <h2 id="how-do-i-enable-lve-and-php-selector-in-litespeed"><a href="#how-do-i-enable-lve-and-php-selector-in-litespeed" class="header-anchor">#</a> How do I enable LVE and PHP Selector in LiteSpeed?</h2> <p>In LiteSpeed admin interface do the following:</p> <p><em>Configuration -&gt; Server -&gt; Edit -&gt; &quot;Enable LVE&quot; = &quot;Yes&quot; -&gt; Save</em></p> <p>If you are using CageFS, then choose cagefs there.</p> <p>To enable PHP Selector with LiteSpeed you have to adjust more settings in Admin:</p> <ol><li>CloudLinux (<em>Admin Console --&gt; Configuration --&gt; Server --&gt; General</em>): CageFS;</li> <li>Enable SuExec: <em>Server-&gt; General -&gt; PHP SuEXEC -&gt; Yes</em>;</li> <li>LSPHP5 external app runs in SUEXEC non-daemon mode ONLY (<em>Run On Start Up --&gt; Yes or No</em>);</li> <li>In LSPHP5 external app (<em>Admin Console --&gt; Configuration --&gt; Server --&gt; External App --&gt; lsphp5</em>).</li></ol> <p>Change</p> <p><code>command =&gt; $SERVER_ROOT/fcgi-bin/lsphp5</code></p> <p>To</p> <p><code>command =&gt; /usr/local/bin/lsphp</code></p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>In order to use PHP Selector and custom php.ini, lsphp5 needs to be in SuEXEC non-daemon mode.</p></div><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Some PHP configurations require more memory for SuEXEC to work properly. If you are getting error 500 after switching suEXEC to non-daemon mode, try to increase Memory Soft Limit and Memory Hard Limit for external App (Admin Console --&gt; Configuration --&gt; Server --&gt; External App --&gt; lsphp5 ) to at least 650/800M.</p></div><h2 id="how-do-i-use-3rd-party-rpm-repositories-without-facing-conflicts"><a href="#how-do-i-use-3rd-party-rpm-repositories-without-facing-conflicts" class="header-anchor">#</a> How do I use 3rd party RPM repositories without facing conflicts?</h2> <p>To protect packages from CloudLinux repositories from being updated from 3rd party repositories like rpmforge, and to prevent such dependencies issues, do the following:</p> <p><strong>For CloudLinux OS 6.x</strong></p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install yum-plugin-protectbase
</code></pre></div></div> <p>Edit <em>/etc/yum/pluginconf.d/rhnplugin.conf</em>. Add:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[cloudlinux-x86_64-server-6]
protect = 1

[cloudlinux-base]
protect = 1
</code></pre></div></div> <p><strong>For CloudLinux OS 7.x</strong></p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install yum-plugin-protectbase
</code></pre></div></div> <p>Edit <em>/etc/yum/pluginconf.d/rhnplugin.conf</em>, add:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[cloudlinux-x86_64-server-7]
protect = 1

[cloudlinux-base]
protect = 1
</code></pre></div></div> <h2 id="how-can-i-run-service-inside-lve"><a href="#how-can-i-run-service-inside-lve" class="header-anchor">#</a> How can I run service inside LVE?</h2> <p>It is possible to wrap service in LVE using lve-wrappers. To do that, install lve-wrappers first:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># yum install lve-wrappers
</code></pre></div></div> <p>Then rename service that you want to wrap like:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># mv /etc/init.d/[service_name] /etc/init.d/[service_name].orig
</code></pre></div></div> <p>Create a new script to start service instead:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># cat &lt;&lt;END &gt; /etc/init.d/[service_name]
#!/bin/sh
lve_suwrapper [LVE_ID] /etc/init.d/[service_name].orig $@
END

# chmod +x /etc/init.d/[service_name]

# service [service_name] restart
</code></pre></div></div> <p>That should be it.
You can specify any number as LVE_ID, just make it large enough so it would not clash with the user ID from <em>/etc/passwd</em> file.</p> <h2 id="how-do-i-configure-cloudlinux-kernel-on-xen-pv"><a href="#how-do-i-configure-cloudlinux-kernel-on-xen-pv" class="header-anchor">#</a> How do I configure CloudLinux kernel on Xen PV?</h2> <ol><li>In <em>/etc/sysconfig/kernel</em> should be the following lines:</li></ol> <p><em><code>UPDATEDEFAULT=yes DEFAULTKERNEL=kernel-xen</code></em></p> <p>If the file does not exist, you should create it.</p> <ol start="2"><li>Install grub if it is not installed:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install grub
</code></pre></div></div> <ol start="3"><li>Check <em>/etc/modprobe.conf</em>, it usually contains the following:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat /etc/modprobe.conf
</code></pre></div></div> <p><em><code>alias eth0 xennet alias scsi_hostadapter xenblk</code></em></p> <p>If the file does not exist - create it, and then, in case you have not installed kernel yet - proceed to step <strong>4</strong>.</p> <p>In case you have already installed kernel, rebuild initrd image:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mkinitrd -f /boot/initrd-2.6.xxxx.img 2.6.xxxx
</code></pre></div></div> <p>where <code>xxxx</code> should be the same as you newly installed <code>kernel-xen</code> version and move to step <strong>5</strong>.</p> <ol start="4"><li>Run</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install kernel-xen
</code></pre></div></div> <ol start="5"><li>Run</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>ln -s /boot/grub/grub.conf /boot/grub/menu.lst
ln -s /boot/grub/grub.conf /etc/grub.conf
</code></pre></div></div> <p>If <em>/boot/grub/grub.conf</em> does not exist, create it using the template in step 5, and repeat step 3.</p> <ol start="6"><li>Run</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>rpm -qa|grep kernel
</code></pre></div></div> <p>You should remove all kernels except Xen kernel. For example, if the output looks like this:</p> <p><em><code>kernel-2.6.18-338.5.1.el5.lve0.8.25 kernel-xen-2.6.18-374.3.1.el5.lve0.8.44 kernel-headers-2.6.18-374.3.1.el5.lve0.8.44</code></em>
then you should run</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>rpm -e --nodeps kernel-2.6.18-338.5.1.el5.lve0.8.25
</code></pre></div></div> <ol start="7"><li>Make sure your <em>/etc/grub.conf</em> looks like this:</li></ol> <p><em><code>default=0 timeout=10 title CloudLinux Server (2.6.18-374.3.1.el5.lve0.8.44xen) root (hd0,0) kernel /boot/vmlinuz-2.6.18-374.3.1.el5.lve0.8.44xen console=xvc0 root=/dev/sda1 ro initrd /boot/initrd-2.6.18-374.3.1.el5.lve0.8.44xen.img</code></em></p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>Mind the kernel version on vmlinuz and initrd, they should match the version of currently installed kernel.</p></div><ol start="8"><li>Switch to pygrub mode, and reboot the server. If you don't know how to switch in pygrub mode, contact your service provider, as they should be able to do it for you.</li></ol> <p><em><code>bootloader = '/usr/bin/pygrub'</code></em></p> <h2 id="how-do-i-install-hyper-v-integrated-components"><a href="#how-do-i-install-hyper-v-integrated-components" class="header-anchor">#</a> How do I install Hyper-V integrated components?</h2> <p>Hyper-V integrated components are included in the latest version of CloudLinux OS 6.</p> <p>No additional actions required to install them.</p> <h2 id="how-do-i-move-usr-share-cagefs-skeleton-to-other-place-because-of-low-disk-space"><a href="#how-do-i-move-usr-share-cagefs-skeleton-to-other-place-because-of-low-disk-space" class="header-anchor">#</a> How do I move /usr/share/cagefs-skeleton to other place because of low disk space?</h2> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>If you are placing skeleton in /home directory on cPanel servers, you must configure the following option in cPanel WHM:
WHM -&gt; Server Configuration -&gt; Basic cPanel/WHM Setup -&gt; Basic Config -&gt; Additional home directories
Change the value to blank (not to default &quot;Home&quot;).
Without changing this option, cPanel will create new accounts in incorrect places.</p></div><div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --disable-cagefs
cagefsctl --unmount-all
</code></pre></div></div> <p>Verify that the following command gives empty output:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat /proc/mounts | grep cagefs-skeleton
</code></pre></div></div> <p>Verify that the directory <code>cagefs-skeleton.bak</code> does not exist (if it does exist - change the name <code>cagefs-skeleton.bak</code> to something else):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>ls -d /usr/share/cagefs-skeleton.bak

mv /usr/share/cagefs-skeleton /usr/share/cagefs-skeleton.bak

mkdir -m 0755 /home/cagefs-skeleton
ln -s /home/cagefs-skeleton /usr/share/cagefs-skeleton
cagefsctl --init
cagefsctl --enable-cagefs
cagefsctl --remount-all
</code></pre></div></div> <p>Verify that the following command gives empty output:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cat /proc/mounts | grep cagefs-skeleton.bak
</code></pre></div></div> <p>Now you can safely remove <code>cagefs-skeleton.bak</code> directory:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>rm -rf /usr/share/cagefs-skeleton.bak
</code></pre></div></div> <h2 id="how-do-i-move-user-s-home-folder-to-another-location-if-i-have-cagefs-installed"><a href="#how-do-i-move-user-s-home-folder-to-another-location-if-i-have-cagefs-installed" class="header-anchor">#</a> How do I move user's home folder to another location if I have CageFS installed?</h2> <p>You can move home directories of the users in the following way:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --disable username1 username2
cagefsctl --unmount username1 username2
</code></pre></div></div> <p>Move home directories to a new location, edit <em>/etc/passwd</em> to reflect new path then enable CageFS:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --update-etc username1 username2
cagefsctl --enable username1 username2
</code></pre></div></div> <h2 id="how-to-install-xen-tools-guest-utilities-on-citrix-xenserver-6-1-or-xen-cloud-platform-6-1"><a href="#how-to-install-xen-tools-guest-utilities-on-citrix-xenserver-6-1-or-xen-cloud-platform-6-1" class="header-anchor">#</a> How to install Xen tools (guest utilities) on Citrix Xenserver 6.1 or Xen Cloud Platform 6.1?</h2> <p>To install guest utilities, mount as usually CD ROM with tools to <em>/mnt/cdrom/</em>. Then do the following:</p> <ol><li>Enter cdrom mounted location:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cd  /mnt/cdrom/Linux
</code></pre></div></div> <p>Install needed software, use '-m 6' for CloudLinux OS 6:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>./install.sh -d rhel -m 6
</code></pre></div></div> <h2 id="how-do-i-calculate-reasonable-inode-limit"><a href="#how-do-i-calculate-reasonable-inode-limit" class="header-anchor">#</a> How do I calculate reasonable inode limit?</h2> <p>Inode limit can be considered as a number of files and directories one customer can own. Default WordPress installation has approximately 1,100 files/directories, default Magento install is 10,000, you would need to consider at least 30,000 to be an inode limit for a minimal package for your customers. You can calculate limits basing on current usage of your customers by running the following command. It will list top 50 entries that use inodes the most:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>repquota -a | grep -v root | awk '{print $6&quot; &quot;$1 }' | sort -g | tail -50
</code></pre></div></div> <p>Do not forget - temporary files and session files are also counted towards the inode limit.</p> <h2 id="how-do-i-create-local-cloudlinux-repository-mirror"><a href="#how-do-i-create-local-cloudlinux-repository-mirror" class="header-anchor">#</a> How do I create local CloudLinux repository mirror?</h2> <p>CloudLinux mirror requires a bit more than a typical repository mirror setup. We set up CLN proxy software to accommodate for authentication done by <code>yum-rhn-plugin</code> plugin.</p> <p>::: danger Important
To qualify as a CLN mirror, you need to have more than 50 servers in your datacenters.
:::</p> <p>To host a mirror, please setup:</p> <ul><li>a VM with 4GB of RAM and 200GB of disk space running CentOS 7;</li> <li>&quot;firewalld&quot; service should be running with sshd enabled;</li> <li>domain name pointed to that mirror, like cl-mirror.yourdomain.com;</li></ul> <p>Then create a support ticket and send us:</p> <ul><li>your CLN login name;</li> <li>access to VM;</li> <li>domain name pointed to that VM.</li></ul> <p>We will setup a software that would act as a caching proxy allowing licensing to work. When done, your mirror will be added to the <a href="http://repo.cloudlinux.com/cloudlinux/mirrorlists/cln-mirrors" target="_blank" rel="noopener noreferrer">mirror list<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>ETA is about 2-3 business days.</p> <h2 id="how-do-i-install-cloudlinux-from-scratch-or-convert-existing-server"><a href="#how-do-i-install-cloudlinux-from-scratch-or-convert-existing-server" class="header-anchor">#</a> How do I install CloudLinux from scratch or convert existing server?</h2> <p>To install CloudLinux OS on a new server you have to download and use provided .iso files. The files themselves and all the necessary information you can find <a href="/cloudlinux_installation/#installing-new-servers">here</a>.</p> <p>To convert existing server you need to download and run our script, which you can find <a href="/cloudlinux_installation/#converting-existing-servers">here</a> with all the necessary instructions.</p> <p>Also, we provide a variety of different images for most common virtual machines, more information <a href="/cloudlinux_installation/#cloudlinux-os-images">here</a>.</p> <h2 id="how-do-i-install-vmware-tools-improving-server-performance-when-on-vmware"><a href="#how-do-i-install-vmware-tools-improving-server-performance-when-on-vmware" class="header-anchor">#</a> How do I install VMware-Tools/Improving server performance when on VMware?</h2> <p>If you notice some server slowing down (IO/memory) and this server is running on VMware, then we strongly recommend you to install <a href="https://kb.vmware.com/s/article/340" target="_blank" rel="noopener noreferrer">VMware-Tools<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> - a suite of utilities that enhance the performance of VM guest operating system and improves its management.</p> <p>Check if they are installed and kernel modules are loaded, where <code>vmci</code> is the main one:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lsmod | grep vm
</code></pre></div></div> <p><em><code>vmci 80373 1 vsock</code></em></p> <p>If you see no <code>vmci</code> in the output, then most probably they are not installed.</p> <p>We do recommend installing them from source code using this <a href="https://kb.vmware.com/s/article/1018414" target="_blank" rel="noopener noreferrer">article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Installation process:</p> <p>Click in <em>VM menu &gt; Guest &gt; Install/Upgrade VMware tools</em> (at least). After that, the cdrom will be attached as <em>/dev/cdrom</em>. Mount it:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mkdir /mnt/cdrom
mount /dev/cdrom /mnt/cdrom
</code></pre></div></div> <p>Then install kernel headers and VMware-Tools:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install kernel-headers
cd /mnt/cdrom/vmware-tools-distrib
./vmware-install.pl
</code></pre></div></div> <p>Follow the wizard (pressing enter in most cases), make them enabled on startup.</p> <p>Check if <code>vmci</code> exists in lsmod.</p> <p>If you see tools installed but no module loaded - run the configuration from the command line:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>vmware-config-tools.pl
</code></pre></div></div> <h2 id="how-do-i-convert-linode-centos-vps-to-cloudlinux"><a href="#how-do-i-convert-linode-centos-vps-to-cloudlinux" class="header-anchor">#</a> How do I convert Linode CentOS VPS to CloudLinux?</h2> <p>For CentOS 6, please do the following steps:</p> <ol><li>Install packages:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install kernel grub
</code></pre></div></div> <ol start="2"><li>Make sure that your <em>/boot/grub/grub.conf</em> looks like this (if it does not exist, you should create it):</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>default=0
timeout=10
title CentOS Server (2.6.32-279.5.2)
root (hd0)
kernel /boot/vmlinuz-2.6.32-279.5.2.el6.i686 root=/dev/xvda ro
initrd /boot/initramfs-2.6.32-279.5.2.el6.i686.img
</code></pre></div></div> <ol start="3"><li>Create symlinks:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>ln -s /boot/grub/grub.conf /boot/grub/menu.lst; ln -s /boot/grub/grub.conf /etc/grub.conf
</code></pre></div></div> <p>Once you are done, in the Linode Manager, edit your Linode configuration profile to use <code>pv-grub-x86_64</code> (or 32-bit one if you use 32-bit arch) as the Kernel.</p> <p>Make sure the root device is specified as <code>xvda</code>. Save your changes by clicking <em>Save Profile</em> at the bottom of the page, and reboot your Linode from the <em>Dashboard</em> tab.</p> <h2 id="how-do-i-view-lveinfo-for-more-than-10-users"><a href="#how-do-i-view-lveinfo-for-more-than-10-users" class="header-anchor">#</a> How do I view lveinfo for more than 10 users?</h2> <p>By default when you run <code>lveinfo</code>, it assumes <code>--limit=10</code>, and shows only top 10 results. So, if you want to see more, just add <code>--limit 1000</code> like:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lveinfo --period=1d --limit 1000
</code></pre></div></div> <p>Also, it is possible to create a graphical chart for the particular user. You can use this command:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># lvechart -u USERNAME --period=1d --width=12 -o chart-USERNAME.png
</code></pre></div></div> <h2 id="how-do-i-enable-pygrub-in-hypervm"><a href="#how-do-i-enable-pygrub-in-hypervm" class="header-anchor">#</a> How do I enable pygrub in HyperVM?</h2> <p>To enable <code>pygrub</code>, please go to <em>Advanced --&gt; Append To Xen Config</em> and enter the line:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>bootloader = &quot;/usr/bin/pygrub&quot;
</code></pre></div></div> <p>Then click <em>Update</em> and reboot the VM. Also, change one line in VM <em>/boot/grub/grub.conf</em> file: <code>root (hd0,0)</code> to <code>root (hd0)</code></p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>This is only for HyperVM ver2.0, pygrub is officially supported in ver2.2.x</p></div><h2 id="how-do-i-set-resize-my-aws-instance-storage-size"><a href="#how-do-i-set-resize-my-aws-instance-storage-size" class="header-anchor">#</a> How do I set/resize my AWS instance storage size?</h2> <p>Before starting your instance, you can choose storage size in the <em>Storage</em> section.</p> <p>If your instance is already running, please refer to Amazon's <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-expand-volume.html" target="_blank" rel="noopener noreferrer">official instruction<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="how-to-install-and-configure-kdump-to-obtain-vmcore"><a href="#how-to-install-and-configure-kdump-to-obtain-vmcore" class="header-anchor">#</a> How to install and configure kdump to obtain vmcore?</h2> <p>If you have a non-responding server and no useful errors are shown in <em>/var/log/messages</em>, the way to find the reason is to install and configure <code>kdump</code>, so it will create a core dump file when the server hangs. In some cases <code>kdump</code> could not help on XEN PV machines, however, in any case, you should try it as on regular servers it is really doing a good job. Here are the steps to install and configure kdump:</p> <ol><li>Install kexec-tools:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install kexec-tools
</code></pre></div></div> <p>Edit <em>/etc/kdump.conf</em>, and set the path variable to point to a directory with enough space to hold kernel dump file (default location is <em>/var/crash/</em>). File size will be about the size of the server RAM + 1GB.</p> <ol start="2"><li>Edit /etc/grub.conf.</li></ol> <p>For CloudLinux OS 6 add to the kernel line as another boot parameter or modify existing one:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>crashkernel=160M (or crashkernel=auto)
</code></pre></div></div> <p>For CloudLinux OS 7 edit <em>/etc/default/grub</em> and add <code>crashkernel=auto</code> to <code>GRUB_CMDLINE_LINUX</code> parameter (or modify existing one) so it should look like this:</p> <p><em><code>GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rhgb quiet&quot;</code></em></p> <p>Here is the link to the official RHEL recommendation regarding the crashkernel value: <a href="https://access.redhat.com/solutions/916043" target="_blank" rel="noopener noreferrer">https://access.redhat.com/solutions/916043<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Rebuild grub config file with the following command:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div></div> <ol start="3"><li>For CloudLinux OS 6 - add <code>kdump</code> to <code>chkconfig</code> and turn it <strong>On</strong> during boot:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>chkconfig --add kdump
chkconfig kdump on
</code></pre></div></div> <ol start="4"><li>Modify <em>/etc/sysctl.conf</em> file and add the following block to catch all possible panic states:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># Enable reboots on panic to allow kdump make dumps
kernel.sysrq=1
kernel.hung_task_panic = 1
kernel.panic = 1
kernel.panic_on_io_nmi = 1
kernel.panic_on_oops = 1
kernel.panic_on_stackoverflow = 1
kernel.panic_on_unrecovered_nmi = 1
kernel.softlockup_panic = 1
kernel.unknown_nmi_panic = 1
</code></pre></div></div> <ol start="5"><li>Reboot.
After the server boot check if kdump is running with:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>service kdump status
</code></pre></div></div> <p>Obtaining coredump if server hangs is described <a href="/kb/HowDoI/#how-to-obtain-kdump-if-server-hangs">here</a>.</p> <h2 id="how-to-obtain-vmcore-when-the-server-is-unresponsive"><a href="#how-to-obtain-vmcore-when-the-server-is-unresponsive" class="header-anchor">#</a> How To Obtain Vmcore When the Server is Unresponsive?</h2> <p>Assuming you already have kdump configured and functioning.</p> <p>If you need to generate a coredump from a server without physical access to it, you may want to allow the kernel to call the panic routine when it receives an unknown non-maskable interrupt (NMI). In order to allow it, you have to edit <em>/etc/sysctl.conf</em> and add the following line:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>kernel.unknown_nmi_panic = 1
</code></pre></div></div> <p>Apply changes with:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>sysctl -p
</code></pre></div></div> <p>To generate a core you may use some web-based 'KVM' services, most of them have the ability to send NMI to host. Another possible way in case of IPMI has been configured is to send unknown NMI with the <code>impitool</code> command:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>ipmitool -I lan -H &lt;hostname&gt; chassis power diag
</code></pre></div></div> <p>In the case of <em><code>&quot;BUG: soft lockup - CPU#7 stuck for 67s&quot;</code></em> messages in <em>/var/log/message</em>, you need to switch <code>kernel.softlockup_panic</code> to <code>1</code> to have the core file created automatically. To achieve that, edit <em>/etc/sysctl.conf</em> and insert the following line:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>kernel.softlockup_panic = 1
</code></pre></div></div> <p>Apply changes with:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>sysctl -p
</code></pre></div></div> <h2 id="how-to-upgrade-cloudlinux-os-6-to-cloudlinux-os-7"><a href="#how-to-upgrade-cloudlinux-os-6-to-cloudlinux-os-7" class="header-anchor">#</a> How to upgrade CloudLinux OS 6 to CloudLinux OS 7?</h2> <p>There is no direct upgrade path from CloudLinux OS 6 to CloudLinux OS 7, therefore the only way is to move accounts to a new server with CloudLinux OS 7 installed.</p> <p>This is due to the fact that a large number of 3rd party components (such as control panels) are installed on a typical CloudLinux OS 7 server, which makes it impossible to gracefully upgrade the OS without breaking control panels.</p> <p>We will work to improving the situation in the future, yet it depends on the collaboration of control panel providers.</p> <h2 id="how-do-i-choose-which-kernel-to-boot-on-cloudlinux-os-7"><a href="#how-do-i-choose-which-kernel-to-boot-on-cloudlinux-os-7" class="header-anchor">#</a> How do I choose which kernel to boot on CloudLinux OS 7?</h2> <p>CloudLinux OS 7 brings GRUB2 with the totally new scheme of booting the kernels, the old edit file is not applicable anymore. The correct way to boot needed kernel (use an older kernel, CentOS kernel one or debug kernel) is with <code>grub2-set-default</code> command.</p> <ol><li>Take a needed kernel with :</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ awk -F\' '$1==&quot;menuentry &quot; {print i++ &quot; =  &quot;$2}' /etc/grub2.cfg
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>0 =  CloudLinux (3.10.0-427.18.2.lve1.4.27.el7.x86_64) 7.3 (Yury Malyshev)
1 =  CloudLinux (3.10.0-427.36.1.lve1.4.26.el7.x86_64) 7.3 (Yury Malyshev)
2 =  CloudLinux (3.10.0-427.18.2.lve1.4.24.el7.x86_64) 7.2 (Valeri Kubasov)
3 =  CloudLinux (0-rescue-1d7e5b9aa3bd48e99e108700e5458d82) 7.2 (Valeri Kubasov)
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>The position of a menu entry in the list is denoted by a number starting with zero, so we are numbering it especially in a correct way.</p></div><ol start="2"><li>Set to boot needed kernel with command line:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ grub2-set-default 1
</code></pre></div></div> <p>Use the following command to check currently selected kernel to be booted:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ grub2-editenv list
</code></pre></div><p><code>saved_entry=1</code></p></div> <p>More information about customizing GRUB2 could be found in the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sec-Customizing_the_GRUB_2_Configuration_File.html" target="_blank" rel="noopener noreferrer">official RedHat guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="sharing-more-directories-with-single-user-account-over-cagefs"><a href="#sharing-more-directories-with-single-user-account-over-cagefs" class="header-anchor">#</a> Sharing more directories with single user account over CageFS</h2> <p>Due to a design CageFS mounts user homes as <em>/home/username</em>, no matter in which <em>/home2/ .. /homeN/</em> user reside on a real system.</p> <p>This could cause some PHP scripts to work incorrectly, however, CageFS has a mechanism to make any additional location with users content available from inside. This is also a quite useful way to share needed backup directories for users if you are giving FTP/SSH access to them. Also, you can use this feature to provide access to <em>/homeabc/username</em> when <em>/home/username</em> is a symlink to it.</p> <p>To enable this feature the following line should be added to <em>/etc/cagefs/cagefs.mp</em> file:</p> <p><code>%/homeabc</code></p> <p>Then remount all with:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --remount-all
</code></pre></div></div> <p>After that, a user can see both his <em>/home/username</em> and <em>/homeabc/username</em> from CageFS inside. Other directories in <em>/homeabc</em> as well as in <em>/home</em> will be still hidden for him.</p> <h2 id="how-cpu-usage-is-calculated"><a href="#how-cpu-usage-is-calculated" class="header-anchor">#</a> How CPU usage is calculated?</h2> <p>How to prove CPU usage is correct and it shows real data with <code>lveinfo</code>? Let us explain how <code>lvetop</code> works before answering this question.</p> <p>The <code>lvetop</code> utility, as well as <code>lveps -d</code>, show dynamic CPU (and other) usage, collected during 3 seconds period. Before iteration, the process gets running PIDs/threads (let's call them list1), and after iteration, it gets them again (list2). If the thread is in both list1 and list2 it will show some CPU%. If the thread is only in list1 but is not in list2, then it is shown as NA. All newly created threads that exist in list2 but are absent in list1 will not be shown.</p> <p>Without '-d' key it shows static processes/threads that are running 'now'. The values in CPU column (yellow square in this example) are the number of seconds LVE/process/thread has been running. This is an increasing counter and is reset with a reboot or with <code>lvectl destroy UID/all</code>. Overall, it is not a trivial task to show all the processes that generate CPU usage for any LVE, and process accounting is not cheap for the system. To summarize - there is no way to prove CPU usage shown in <code>lveinfo</code>/<code>lvetop</code>, like for example <a href="/kb/HowDoI/#checking-personal-users-disk-cache-if-lveinfo-show-memory-usage-but-no-processes-there/">memory usage</a>:</p> <h2 id="high-iowait-and-or-load-average-when-apc-enabled-in-php-selector"><a href="#high-iowait-and-or-load-average-when-apc-enabled-in-php-selector" class="header-anchor">#</a> High iowait and/or load average when APC enabled in PHP Selector</h2> <p>If you are experiencing high iowait or high IO usage by single LVE or load average jumps after enabling APC, the most probable reason is due to the following directive in <em>/opt/alt/php5*/etc/php.d.all/apc.ini</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>apc.mmap_file_mask = /tmp/apc.shm.XXXXXX
</code></pre></div></div> <p>There are internet articles related to the same subject, like <a href="http://serverfault.com/questions/361032/high-disk-i-o-when-cache-is-used" target="_blank" rel="noopener noreferrer">this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. We decided to change it to <em>/dev/zero</em> by default, the same will be applied to all new installations. For existing installs you have to edit each <em>/opt/alt/php5*/etc/php.d.all/apc.ini</em> and then execute:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --rebuild-alt-php-ini
</code></pre></div></div> <h2 id="why-alt-php-ini-files-become-overwritten-after-alt-php-updates"><a href="#why-alt-php-ini-files-become-overwritten-after-alt-php-updates" class="header-anchor">#</a> Why alt-php.ini files become overwritten after Alt-PHP updates?</h2> <p>During Alt-PHP packages update, we don't rewrite <em>*ini</em> files at all. Only two PHP variables are reset to the values from the native <em>php.ini</em> file, they are <code>error_log</code> and <code>date.timezone</code>.</p> <p>To prevent this situation, you should define <code>error_log</code> and <code>date.timezone</code> values in <em>/etc/cl.selector/global_php.ini</em> file and run the following command to apply changes:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cagefsctl --setup-cl-selector
</code></pre></div></div> <p>As a result, all settings from the files above will be taken for <em>*ini</em> files for all versions inside PHP-Selector.</p> <p>The current incarnation of PHP Selector is that it will not overwrite Alt-PHP ini files if values in them are different from defaults as that could break websites functionality. You have to run a command with a key to overwrite them. Please find more information <a href="/cloudlinux_os_components/#configuring-global-php-ini-options-for-all-alt-php-versions">here</a></p> <h2 id="how-to-patch-php-fpm-binary-file"><a href="#how-to-patch-php-fpm-binary-file" class="header-anchor">#</a> How to patch PHP-FPM binary file?</h2> <p>This article describes how to apply our patches for PHP-FPM. First of all, you should download &quot;PHP&quot; archive (Note that this link will be different for each PHP version). In this case we will use PHP 5.4.45 version:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>wget http://nl3.php.net/get/php-5.4.45.tar.gz/from/this/mirror
</code></pre></div></div> <p>When download completed, rename, unpack and change its directory:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mv mirror.1 php-5.4.45.tar.gz
tar -zxvf php-5.4.45.tar.gz
cd php-5.4.45/
</code></pre></div></div> <p>Then download the following package which contains all the necessary files to apply patches:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>wget http://repo.cloudlinux.com/cloudlinux/sources/da/cl-apache-patches.tar.gz
tar -zxvf cl-apache-patches.tar.gz
</code></pre></div></div> <p>Before applying CloudLinux patches, please make sure that <code>liblve-devel</code> has already been installed into the system:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>rpm -qa | grep liblve-devel
</code></pre></div></div> <p><code>liblve-devel-1.3-1.10.el6.cloudlinux.x86_64</code></p> <p>If not, please run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install liblve-devel -y
</code></pre></div></div> <p>On CloudLinux OS 7 server - install <code>systemd-devel</code>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>yum install systemd-devel
</code></pre></div></div> <p>Apply patch:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>patch -p1 &lt; fpm-lve-php5.4.patch
</code></pre></div></div> <p>If everything looks fine, please run the following commands to build it (CloudLinux OS 6):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>autoconf 
./configure --enable-fpm
make
</code></pre></div></div> <p>CloudLinux OS 7 requires <code>systemd</code> support:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>autoconf
./configure --enable-fpm --with-fpm-systemd
make
</code></pre></div></div> <p>When rebuild completed, find a new PHP-FPM binary file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>find . | grep php-fpm
</code></pre></div></div> <p><code>./sapi/fpm/php-fpm</code></p> <p>To make sure that it contains all our patches run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>strings ./sapi/fpm/php-fpm | egrep &quot;jail|lve&quot;
</code></pre></div></div> <p><code>liblve.so.0 lve_exit init_lve lve_jail_uid destroy_lve lve_enter_flags fpm_lve_enter fpm_lve_leave</code></p> <p>If everything looks fine, please rename the current PHP-FPM file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>which php-fpm
</code></pre></div></div> <p><code>/usr/local/sbin/php-fpm</code></p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>mv /usr/local/sbin/php-fpm /usr/local/sbin/php-fpm.old
</code></pre></div></div> <p>And copy the new one:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>cp /root/php-5.4.45/sapi/fpm/php-fpm /usr/local/sbin/
</code></pre></div></div> <p>Then you need to restart PHP-FPM service to apply changes and check PHP info page.</p> <h2 id="different-php-versions-per-directories-using-suphp"><a href="#different-php-versions-per-directories-using-suphp" class="header-anchor">#</a> Different PHP versions per directories using suPHP</h2> <p>We had few requests to support different PHP versions per directory. While this is not available using PHP Selector UI, it is fairly simple to do manually. The important requirement is that PHP must be set to run in suPHP mode. Tested with cPanel, however it will work on any other server.</p> <p>Here is quick how-to:</p> <ol><li>Configure handlers for different versions and point them to already provided <code>php-cgi</code> binaries, they all are visible from inside CageFS.</li></ol> <p>Add the following section to <code>handlers</code> section in <em>/opt/suphp/etc/suphp.conf</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>application/x-httpd-php52=&quot;php:/opt/alt/php52/usr/bin/php-cgi&quot;
application/x-httpd-php53=&quot;php:/opt/alt/php53/usr/bin/php-cgi&quot;
application/x-httpd-php54=&quot;php:/opt/alt/php54/usr/bin/php-cgi&quot;
application/x-httpd-php55=&quot;php:/opt/alt/php55/usr/bin/php-cgi&quot;
application/x-httpd-php56=&quot;php:/opt/alt/php56/usr/bin/php-cgi&quot;
application/x-httpd-php70=&quot;php:/opt/alt/php70/usr/bin/php-cgi&quot;
application/x-httpd-php71=&quot;php:/opt/alt/php71/usr/bin/php-cgi&quot;
</code></pre></div></div> <p>for EasyApache 4 you need to add handlers into <em>/etc/suphp.conf</em> file.</p> <ol start="2"><li>Add suPHP handlers for each version, this should be done before other configs. On cPanel server, edit <em>/usr/local/apache/conf/includes/pre_virtualhost_global.conf</em> and add the following section:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>&lt;IfModule mod_suphp.c&gt;
&lt;Directory /&gt;
suPHP_AddHandler application/x-httpd-php52
suPHP_AddHandler application/x-httpd-php53
suPHP_AddHandler application/x-httpd-php54
suPHP_AddHandler application/x-httpd-php55
suPHP_AddHandler application/x-httpd-php56
suPHP_AddHandler application/x-httpd-php70
suPHP_AddHandler application/x-httpd-php71
&lt;/Directory&gt;
&lt;/IfModule&gt;
</code></pre></div></div> <ol start="3"><li>Restart Apache:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># service httpd restart
</code></pre></div></div> <p>That’s it, now Apache understands what binary should be used for different mime types. To use the desired version in a particular directory, just add a line to .htaccess in that directory (or create .htaccess file with that line, if it is not there). For example, for php5.4, add the following line:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>AddHandler application/x-httpd-php54 .php .php5
</code></pre></div></div> <p>Subdirectories will use the same PHP version as the parent unless you override it with another .htaccess entry in that subdirectory. To match PHP extensions selection with extensions selected by an end user for that PHP version in PHP Selector you have to follow <a href="/cloudlinux_os_components/#php-extensions">this article</a>. This is not an officially supported way to run multiple PHP per account, but it is a safe hack that will work for anyone using suPHP.</p> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>There is one little trick that can be confusing. It applies only if you have PHP Selector enabled and you have non-native version selected there for a user. In that case, if the version that you assign through .htaccess is the same as ea-php version selected as system default version in WHM -&gt; MultiPHP Manager -&gt; System Default version, that version will not be applies, the version that you'll actually get will be the same as selected in PHP Selector.</p></div><h2 id="integrating-ldap-users-with-cagefs"><a href="#integrating-ldap-users-with-cagefs" class="header-anchor">#</a> Integrating LDAP users with CageFS</h2> <p>When using LDAP to store user data it requires additional configuration to work properly with CageFS. By default CageFS does not see LDAP user, like this:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># id adam
uid=16859(adam) gid=100(users) groups=100(users)
# cagefsctl --enable adam
Error: user adam does not exist
</code></pre></div></div> <p>The problem is that in LDAP <code>pwd.getpwall()</code> function doesn't work by default:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code># python -c 'import pwd; print pwd.getpwall()' | grep adam
#
# python -c 'import pwd; print pwd.getpwnam(&quot;adam&quot;)'
pwd.struct_passwd(pw_name='adam', pw_passwd='*', pw_uid=16859, pw_gid=100, pw_gecos='adam', pw_dir='/home/adam', pw_shell='/bin/bash')
</code></pre></div></div> <p>To fix it you should set <code>enumerate=true</code> in <em>sssd.conf</em> file:</p> <p><code>enumerate (bool) Determines if the domain can be enumerated. This parameter can have one of the following values: TRUE = Users and groups are enumerated FALSE = No enumerations for this domain Default: FALSE</code></p> <h2 id="how-to-activate-inode-usage-displaying-in-cpanel"><a href="#how-to-activate-inode-usage-displaying-in-cpanel" class="header-anchor">#</a> How to activate inode usage displaying in cPanel?</h2> <div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>cPanel only</p></div><p>LVE Manager inodes Limits extension allows you to set inodes limits for your customers. An inode is a data structure on a file system used to keep information about a file or a folder. The number of inodes indicates the number of files and folders an account has. inodes limits work on the level of system disk quota.</p> <p>To display inode usage in user's panel the following should correspond:</p> <ol><li><p>System quotas enabled and working.</p></li> <li><p>cPanel inode count is turned off in <em>WHM &gt; Tweak settings</em>.</p></li> <li><p><code>Show end-user inodes usage</code> option is enabled in <em>WHM &gt; CloudLinux LVE Manager &gt; Options</em>.</p></li></ol> <h2 id="how-to-fix-cpanel-mailing-list-archiving-functionality-when-link-traversal-protection-is-enabled"><a href="#how-to-fix-cpanel-mailing-list-archiving-functionality-when-link-traversal-protection-is-enabled" class="header-anchor">#</a> How to fix cPanel mailing list archiving functionality when link traversal protection is enabled?</h2> <p>If <a href="/cloudlinux_os_kernel/#link-traversal-protection">link traversal protection</a> is enabled on cPanel server, the mailman archiving feature stops working as it creates some internal symlinks in <em>/usr/local/cpanel/3rdparty/mailman/archives/private/listname_domain.com/</em>. You may notice the following error in <em>/usr/local/cpanel/3rdparty/mailman/logs/error</em> file:</p> <p><code>Oct 19 23:49:21 2015 (532564) Uncaught runner exception: [Errno 2] No such file or directory Oct 19 23:49:21 2015 (532564) Traceback (most recent call last): File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Queue/Runner.py&quot;, line 119, in _oneloop self._onefile(msg, msgdata) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Queue/Runner.py&quot;, line 190, in _onefile keepqueued = self._dispose(mlist, msg, msgdata) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Queue/ArchRunner.py&quot;, line 73, in _dispose mlist.ArchiveMail(msg) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Archiver/Archiver.py&quot;, line 216, in ArchiveMail h.processUnixMailbox(f) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Archiver/pipermail.py&quot;, line 586, in processUnixMailbox self.add_article(a) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Archiver/pipermail.py&quot;, line 623, in add_article self.new_archive(arch, archivedir) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Archiver/pipermail.py&quot;, line 608, in new_archive self.open_new_archive(archive, archivedir) File &quot;/usr/local/cpanel/3rdparty/mailman/Mailman/Archiver/HyperArch.py&quot;, line 1047, in open_new_archive os.symlink(self.DEFAULTINDEX+'.html',index_html) OSError: [Errno 2] No such file or directory</code></p> <p>To fix the issue you should add <code>mailman</code> user to <code>linksafe</code> group, so it could manage symlinks as needed:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>usermod -a -G linksafe mailman
</code></pre></div></div> <h2 id="how-to-mount-a-directory-inside-cagefs-for-particular-users-only"><a href="#how-to-mount-a-directory-inside-cagefs-for-particular-users-only" class="header-anchor">#</a> How to mount a directory inside CageFS for particular users only?</h2> <p>The easiest way is to use <a href="/cloudlinux_os_components/#split-by-username">split</a> approach. But it will work only if you add a username inside the directory you want to share:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ mkdir /sharedir
$ ln -s /share_dir /sharedir/username
$ ln -s /sharedir/username /usr/share/cagefs-skeleton/share_dir
$ echo &quot;%/sharedir&quot; &gt;&gt; /etc/cagefs/cagefs.mp
$ cagefsctl --remount-all
</code></pre></div></div> <p>Please note that first you create empty <code>sharedir</code> directory, and the actual content is located in <code>share_dir</code></p> <h2 id="how-to-add-own-comments-to-php-versions-in-php-selector"><a href="#how-to-add-own-comments-to-php-versions-in-php-selector" class="header-anchor">#</a> How to add own comments to PHP versions in PHP Selector?</h2> <p>CloudLInux OS provides an opportunity to add custom comments to PHP versions, chosen with PHP Selector by users. Usually, they are used to notify users about outdated or recommended versions.</p> <p>Upon forming a list of available versions <code>selectorctl</code> tool is looking for <em>/opt/alt/phpXX/name_modifier</em> file to append it as a comment to a version.</p> <p>To add your own comments - create a file for desired PHP version and write a text inside:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /opt/alt/php54/name_modifier
</code></pre></div></div> <p>Do the same for other PHP versions. The changes are applied instantly. Make sure to add just a few words not to break dropdown list. The text will be shown in brackets in the LVEmanager UI:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ selectorctl -i php --summary
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>4.4 e - Totally unsupported version  
5.1 - - Totally unsupported version  
5.2 - - Totally unsupported version  
5.3 e - Outdated version  
5.4 e - Outdated version  
5.5 e - Safe to use  
5.6 e d Supported version  
7.0 e - Recommended version  
native e -
</code></pre></div></div> <h2 id="running-cloudlinux-os-7-with-ovh-server"><a href="#running-cloudlinux-os-7-with-ovh-server" class="header-anchor">#</a> Running CloudLinux OS 7 with OVH server</h2> <p>Servers from OVH can require additional configurations after converting to CloudLinux OS 7. Also, use this KB article if you are getting the following warning with cldeploy:</p> <p><code>Invalid /etc/mdadm.conf file detected</code></p> <p>Complete checklist to successfully run CloudLinux OS 7 kernel.</p> <ol><li>Check for proper UUIDs and correct <em>mdadm.conf</em> file formatting</li></ol> <p>Obtain UUIDs for RAID devices with <code>mdadm</code> utility:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ mdadm --detail --scan
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>ARRAY /dev/md2 metadata=0.90 UUID=70160d35:1398d208:a4d2adc2:26fd5302
ARRAY /dev/md3 metadata=0.90 UUID=5ccb84a1:516cc4d3:a4d2adc2:26fd5302
ARRAY /dev/md5 metadata=0.90 UUID=ae269fab:c345c72d:a4d2adc2:26fd5302
</code></pre></div></div> <p>Modify <em>/etc/mdadm.conf</em> file to make it look like in the example below. Note that AUTO command is required.</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/mdadm.conf
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>MAILADDR root
AUTO +imsm +1.x -all
ARRAY /dev/md2 level=raid1 num-devices=2 UUID=70160d35:1398d208:a4d2adc2:26fd5302
ARRAY /dev/md3 level=raid1 num-devices=2 UUID=5ccb84a1:516cc4d3:a4d2adc2:26fd5302
ARRAY /dev/md5 level=raid1 num-devices=2 UUID=ae269fab:c345c72d:a4d2adc2:26fd5302
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>It is only an example, you need to use ARRAY entries from output of mdadm --detail --scan command.</p></div><ol start="2"><li>Check for the proper command line in <em>grub.cfg</em> file</li></ol> <p>Check if <code>net.ifnames=0 rd.auto=1</code> are present in <em>grub.cfg</em> file:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ grep &quot;net.ifnames=0 rd.auto=1&quot; /boot/grub2/grub.cfg
</code></pre></div></div> <p>If no output returned, you have to edit default grub:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/default/grub
</code></pre></div></div> <p>And add those options to <code>cmdline</code>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>GRUB_CMDLINE_LINUX=&quot;net.ifnames=0 rd.auto=1&quot;
</code></pre></div></div> <p>Rebuild <em>grub.cfg</em>:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre></div></div> <ol start="3"><li>Check if RAID drivers added</li></ol> <p>Make sure <em>raid.conf</em> contains all the required options. In most cases <code>$add_drivers</code> is missing:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/dracut.conf.d/raid.conf
</code></pre></div></div> <p>It should look as follows:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>add_drivers=&quot;$add_drivers raid1 raid0&quot;
</code></pre></div></div> <p>Rebuild <em>initramfs</em> file, change kernel version in the example above to the latest one installed on your server:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ dracut -f /boot/initramfs-3.10.0-427.18.2.lve1.4.24.el7.x86_64.img 3.10.0-427.18.2.lve1.4.24.el7.x86_64
</code></pre></div></div> <ol start="3"><li>Check if RAID drivers added</li></ol> <p>Make sure <em>raid.conf</em> contains all the required options. In most cases <code>$add_drivers</code> is missing:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/dracut.conf.d/raid.conf
</code></pre></div></div> <p>It should look as follows:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>add_drivers=&quot;$add_drivers raid1 raid0&quot;
</code></pre></div></div> <p>Rebuild <em>initramfs</em> file, change kernel version in the example above to the latest one installed on your server:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ dracut -f /boot/initramfs-3.10.0-427.18.2.lve1.4.24.el7.x86_64.img 3.10.0-427.18.2.lve1.4.24.el7.x86_64
</code></pre></div></div> <ol start="4"><li>Optional, switch to UUIDs in <em>/etc/fstab</em>
Obtain block IDs for <code>md</code> devices:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ blkid | grep md
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>/dev/md2: LABEL=&quot;/boot&quot; UUID=&quot;d154fcbd-7802-47a6-8d49-4be2688eee73&quot; TYPE=&quot;ext4&quot;
/dev/md3: LABEL=&quot;/tmp&quot; UUID=&quot;ea5e8258-7be3-42ea-984f-3e1fc83f35d1&quot; TYPE=&quot;ext4&quot;
/dev/md5: LABEL=&quot;/&quot; UUID=&quot;7936780f-36cc-4c13-a59e-3e599ba847d2&quot; TYPE=&quot;ext4&quot;
</code></pre></div></div> <p>Open <em>/etc/fstab</em> and replace <code>md*</code> with UUIDs:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ vi /etc/fstab
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code># &lt;file system&gt; &lt;mount point&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;
UUID=7936780f-36cc-4c13-a59e-3e599ba847d2 / ext4 errors=remount-ro,usrquota 0 1
UUID=d154fcbd-7802-47a6-8d49-4be2688eee73 /boot ext4 errors=remount-ro 0 1
UUID=ea5e8258-7be3-42ea-984f-3e1fc83f35d1 /tmp ext4 defaults 1 2

proc /proc proc defaults 0 0
sysfs /sys sysfs defaults 0 0
tmpfs /dev/shm tmpfs defaults 0 0
devpts /dev/pts devpts defaults 0 0
</code></pre></div></div> <ol start="5"><li>Check if CloudLinux OS kernel is going to be booted with grub</li></ol> <p>If needed - choose CloudLinux OS kernel. Please follow <a href="#how-do-I-choose-which-kernel-to-boot-on-CloudLinux-os-7">this article </a>. If you experience any issues during server boot with CloudLinux OS 7 kernel - reboot the server into rescue console and create a ticket at <a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" rel="noopener noreferrer">https://cloudlinux.zendesk.com/hc/en-us/requests/new<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="managing-mysql-packages-on-cpanel-server-for-mysql-governor-installed"><a href="#managing-mysql-packages-on-cpanel-server-for-mysql-governor-installed" class="header-anchor">#</a> Managing MySQL packages on cPanel server for MySQL Governor installed</h2> <p>If you have MySQL Governor installed, all MySQL upgrades and version changes should be changed using MySQL Governor tools, e.g. <a href="/cloudlinux_os_components/#change-mysql-version">https://docs.cloudlinux.com/cloudlinux_os_components/#change-mysql-version</a></p> <p>On cPanel servers, when <code>mysqlgovernor.py --install</code> is executed, we create <em>/var/cpanel/rpm.versions.d/cloudlinux.versions</em></p> <p>The file is required to disable management of MySQL related packages provided by cPanel and allow MySQL Governor to manage them.</p> <p><strong>Note</strong>. When you have an own definition for MySQL* in <em>local.versions</em> or <em>cloudlinux.version</em> file does not exist you have to run the following commands to ensure cPanel is no longer managing MySQL:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/usr/local/cpanel/scripts/update_local_rpm_versions --edit target_settings.MySQL50 unmanaged
/usr/local/cpanel/scripts/update_local_rpm_versions --edit target_settings.MySQL51 unmanaged
/usr/local/cpanel/scripts/update_local_rpm_versions --edit target_settings.MySQL55 unmanaged
/usr/local/cpanel/scripts/update_local_rpm_versions --edit target_settings.MySQL56 unmanaged
/usr/local/cpanel/scripts/update_local_rpm_versions --edit target_settings.MariaDB100 unmanaged
</code></pre></div></div> <p>If you want to restore the original cPanel-provided MySQL packages after removing MySQL Governor, please run the following commands:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/usr/local/cpanel/scripts/update_local_rpm_versions --del target_settings.MySQL50
/usr/local/cpanel/scripts/update_local_rpm_versions --del target_settings.MySQL51
/usr/local/cpanel/scripts/update_local_rpm_versions --del target_settings.MySQL55
/usr/local/cpanel/scripts/update_local_rpm_versions --del target_settings.MySQL56
/usr/local/cpanel/scripts/update_local_rpm_versions --del target_settings.MariaDB100
</code></pre></div></div> <p>and then run:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>/scripts/upcp --force
</code></pre></div></div> <h2 id="how-to-run-redmine-with-ruby-selector"><a href="#how-to-run-redmine-with-ruby-selector" class="header-anchor">#</a> How to run Redmine with Ruby Selector?</h2> <p><strong>Preface</strong></p> <p>Redmine is a flexible project management web application written using Ruby on Rails framework. It is easy to install it using CloudLinux [Ruby Selector](https://www.cloudlinux.com/ruby-selector]. Follow <a href="/cloudlinux_os_components/#installation-and-update-6">this guide</a> to install Ruby Selector. It works with CageFS, so make sure to enable it for the account. Redmine version described in installation instructions is different from Redmine version used. The example given describes the process for version 3.3.1. For other versions please refer to <em>doc/INSTALL</em> file provided with downloaded Redmine archive or to the official <a href="http://www.redmine.org/projects/redmine/wiki/RedmineInstall" target="_blank" rel="noopener noreferrer">Installation Guide<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p><strong>Setting up a working environment</strong></p> <ol><li>In cPanel (as a user) create MySQL database, create MySQL user and Add user to Database granting all privileges.</li></ol> <p><img src="/images/mceclip0.png" alt="create DB"></p> <p><img src="/images/mceclip1.png" alt="add user"></p> <p><img src="/images/mceclip2.png" alt="add privileges"></p> <ol start="2"><li>Create a new application with 'Setup Ruby Application' menu, use Ruby version 2.3. Domain root or any subdirectory can be used.</li></ol> <p><img src="/images/mceclip3.png" alt="setup Ruby app"></p> <ol start="3"><li>(<strong>if you'd like to use GUI</strong>) After the application created, add the following modules with the proper version for each.</li></ol> <p><code>bundle, bundler#1.9.0, rails#4.2.7.1, bigdecimal#1.4.4, rake#12.3.2, mysql2#0.3.21</code></p> <p><img src="/images/mceclip4.png" alt="add GUI modules"></p> <p>Click <em>Update</em>. It will take about 2 minutes to have them and dependent modules installed.</p> <p>(<strong>if you'd like to use CLI</strong>) Log in as a cPanel user (<code>redmine</code> in this example):</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>su -l -s /bin/bash redmine
selectorctl --interpreter=ruby --version 2.3 --user redmine --create-webapp redmine /
</code></pre></div></div> <p>This will create a web app in <em>document_root/redmine</em> (example : <em>/home/redmine/redmine</em>) under the primary domain URI (Example: http://redmine.com/). Next, you'll need to install extensions:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --interpreter=ruby --enable-user-extensions=bundle,bundler#1.9.0,rails#4.2.7.1,bigdecimal#1.4.4,rake#12.3.2,mysql2#0.3.21 redmine
TITLE:bigdecimal#1.4.4
STATUS:OK
TITLE:bundle
STATUS:OK
TITLE:bundler#1.9.0
STATUS:OK
TITLE:rails#4.2.7.1
STATUS:OK
TITLE:rake#12.3.2
STATUS:OK
</code></pre></div></div> <p>This will enable all necessary modules required by redmine (here <em>redmine</em> is your app folder)</p> <div class="warning custom-block"><p class="custom-block-title">IMPORTANT</p><p>Rails gem will update bundler to 2.0.1 version, which is not compatible with the current installation, so it is important to remove this version and leave 1.9.0 in place.</p></div><div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>selectorctl --interpreter=ruby --disable-user-extensions=bundler#2.0.1 redmine
</code></pre></div></div> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>In case mysql2 installation results in error, install it as root:</p></div><div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>[root@192-168-245-55 redmine]# source /home/redmine/rubyvenv/redmine/2.3/bin/activate
(redmine:2.4)[root@192-168-245-55 redmine]# gem install mysql2 -v 0.3.21
Building native extensions.  This could take a while...
Successfully installed mysql2-0.3.21
Parsing documentation for mysql2-0.3.21
Installing ri documentation for mysql2-0.3.21
Done installing documentation for mysql2 after 0 seconds
1 gem installed
</code></pre></div></div> <ol start="4"><li>Install <code>ImageMagick-devel</code> for <code>rmagick</code> gem:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ yum install ImageMagick-devel
</code></pre></div></div> <p><strong>Deploying Redmine</strong></p> <ol><li>Log in to the server as a user (ssh or su -):</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ su -l -s /bin/bash redmine
</code></pre></div></div> <ol start="2"><li>Download the latest Redmine:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ wget http://www.redmine.org/releases/redmine-3.3.1.tar.gz
</code></pre></div></div> <ol start="3"><li>Unpack it and move to the chosen application directory (<em>redmine</em> in this example):</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ tar xfz redmine-3.3.1.tar.gz
$ cp -rp redmine-3.3.1/* redmine/
</code></pre></div></div> <ol start="4"><li>Fill out database credentials that we have created with cPanel:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ cd redmine
$ cp config/database.yml.example config/database.yml
$ vi config/database.yml
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>production:
 adapter: mysql2
 database: redtest_db
 host: localhost
 username: redtest_user
 password: &quot;my1passwd&quot;
 encoding: utf8
</code></pre></div></div> <ol start="5"><li>Activate the Ruby environment:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ source ~/rubyvenv/redmine/2.3/bin/activate
</code></pre></div></div> <ol start="6"><li>Make sure that you are in the app directory. Add the <code>bigdecimal</code> gem into <em>Gemfile</em>:</li></ol> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ cd redmine
$ pwd
/home/redmine/redmine
nano Gemfile
</code></pre></div></div> <p>Install the modules required by Redmine:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ bundle install --without development test
</code></pre></div></div> <p>Redmine stores session data in cookies by default, which requires a secret token to be generated. Do it and create database structure:</p> <div class="notranslate"><div class="language- extra-class"><pre class="language-text"><code>$ bundle exec rake generate_secret_token
$ bundle exec rake db:migrate RAILS_ENV=&quot;production&quot;
</code></pre></div></div> <p><strong>First login</strong></p> <ol><li>Open Redmine location URL in the browser. Use the default administrator account to log in: login: <strong>admin</strong> password: <strong>admin</strong></li> <li>Change your password to a new one with the proposed form.</li> <li>Go to <em>Administration</em> on the top, choose a preferred language and load the default configuration.</li></ol> <div class="tip custom-block"><p class="custom-block-title">Note</p><p>After adding some other modules to an Application with cPanel interface you may need to restart the application, which can be done on the same Ruby Selector page.</p></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cloudlinux/cloudlinux-doc/edit/dev/docs/kb/HowDoI/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="back-to-top" data-v-5366e0dd><a href="/kb/HowDoI/#app" class="nav-arrow top back-to-top__link" data-v-5366e0dd></a></div> </div> <div class="footer" data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.com" data-v-58ab2eba><img src="/assets/img/we-are-cloudlinux.783ed390.svg" alt="We are Cloudlinux" data-v-58ab2eba></a></div> <div class="footer-company-title" data-v-58ab2eba>2021. CloudLinux Inc</div> <div data-v-58ab2eba><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/sections/115001344329-How-do-I" target="_blank" data-v-58ab2eba>How to</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/getting-started-with-cloudlinux-os" target="_blank" data-v-58ab2eba>Getting started</a></div><div data-v-58ab2eba><a href="https://cloudlinux.zendesk.com/hc/en-us/requests/new" target="_blank" data-v-58ab2eba>Contact support</a></div><div data-v-58ab2eba><a href="https://www.cloudlinux.com/blog" target="_blank" data-v-58ab2eba>Blog</a></div></div> <div class="social" data-v-58ab2eba><span class="footer-social-text" data-v-58ab2eba>Stay in touch</span> <a href="https://www.facebook.com/cloudlinux/" target="_blank" data-v-58ab2eba><img src="/fb.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://twitter.com/cloudlinuxos/" target="_blank" data-v-58ab2eba><img src="/tw.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://linkedin.com/company/cloudlinux" target="_blank" data-v-58ab2eba><img src="/in.png" class="footer-social-logo" data-v-58ab2eba></a><a href="https://www.youtube.com/channel/UCZ3YMHWnMP7TaxlXVay5-aw" target="_blank" data-v-58ab2eba><img src="/ytube.png" class="footer-social-logo" data-v-58ab2eba></a></div></div> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.da36fadb.js" defer></script><script src="/assets/js/20.416e8ee9.js" defer></script>
  </body>
</html>
