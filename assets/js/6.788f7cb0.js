(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{438:function(s,e,a){"use strict";a.r(e);var t=a(0),n=Object(t.a)({},function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"cagefs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cagefs"}},[s._v("#")]),s._v(" CageFS")]),s._v(" "),a("p",[s._v("CageFS is a virtualized file system and a set of tools to contain each user in its own 'cage'. Each customer will have its own fully functional CageFS, with all the system files, tools, etc.")]),s._v(" "),a("p",[s._v("The benefits of CageFS are:")]),s._v(" "),a("ul",[a("li",[s._v("Only safe binaries are available to user")]),s._v(" "),a("li",[s._v("User will not see any other users, and would have no way to detect presence of other users & their user names on the server")]),s._v(" "),a("li",[s._v("User will not be able to see server configuration files, such as Apache config files.")]),s._v(" "),a("li",[s._v("User's will have limited view of "),a("em",[s._v("/proc")]),s._v(" file system, and will not be able to see other users' processes")])]),s._v(" "),a("p",[s._v("At the same time, user's environment will be fully functional, and user should not feel in any way restricted. No adjustments to user's scripts are needed. CageFS will cage any scripts execution done via:")]),s._v(" "),a("ul",[a("li",[a("span",{staticClass:"notranslate"},[s._v(" Apache (suexec, suPHP, mod_fcgid, mod_fastcgi) ")])]),s._v(" "),a("li",[a("span",{staticClass:"notranslate"},[s._v(" LiteSpeed Web Server ")])]),s._v(" "),a("li",[a("span",{staticClass:"notranslate"},[s._v(" Cron Jobs  ")])]),s._v(" "),a("li",[s._v("SSH")]),s._v(" "),a("li",[s._v("Any other "),a("span",{staticClass:"notranslate"},[s._v(" PAM ")]),s._v(" enabled service")])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("mod_php is not supported, MPM ITK requires a custom patch")])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("CageFS is not supported for H-Sphere.")])]),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[s._v("#")]),s._v(" Installation")]),s._v(" "),a("p",[s._v("Minimum Requirements:")]),s._v(" "),a("ul",[a("li",[s._v("kernel: CL5 with lve0.8.54 or later, CL6 with lve1.2.17.1 or later, CL7.")]),s._v(" "),a("li",[s._v("7GB of disk space.")])]),s._v(" "),a("p",[s._v("Depending on your setup, and number of users, you might also need:")]),s._v(" "),a("ul",[a("li",[s._v("Up to 8MB per customer in "),a("em",[s._v("/var")]),s._v(" directory (to store custom "),a("em",[s._v("/etc")]),s._v(" directory)")]),s._v(" "),a("li",[s._v("5GB to 20GB in "),a("em",[s._v("/usr/share")]),s._v(" directory (to store safe skeleton of a filesystem)")])]),s._v(" "),a("p",[s._v("::: danger Warning\nIf at any time you decide to uninstall CageFS, please make sure you follow "),a("router-link",{attrs:{to:"/cagefs/#uninstalling-cagefs"}},[s._v("uninstall instructions")]),s._v("\n:::")],1),s._v(" "),a("p",[s._v("To install CageFS:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ yum install cagefs\n$ /usr/sbin/cagefsctl --init\n")])])])]),s._v(" "),a("p",[s._v("That last command will create skeleton directory that might be around 7GB in size. If you don't have enough disk space in "),a("em",[s._v("/usr/share")]),s._v(", use following commands to have "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefs-skeleton")])]),s._v(" being placed in a different location:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mkdir /home/cagefs-skeleton\n$ ln -s /home/cagefs-skeleton /usr/share/cagefs-skeleton\n")])])])]),s._v(" "),a("p",[s._v("::: danger\nIf you are placing skeleton in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home")])]),s._v(" directory on cPanel servers, you must configure the following option in cPanel WHM: "),a("span",{staticClass:"notranslate"},[a("strong",[s._v("WHM -> Server Configuration -> Basic cPanel/WHM Setup -> Basic Config -> Additional home directories")])]),a("br"),s._v("\nChange the value to blank (not default "),a("span",{staticClass:"notranslate"},[s._v(" Home ")]),s._v(" ). Without changing this option, cPanel will create new accounts in incorrect places.\n:::")]),s._v(" "),a("p",[s._v("CageFS will automatically detect and configure all necessary files for:")]),s._v(" "),a("ul",[a("li",[s._v("cPanel")]),s._v(" "),a("li",[s._v("Plesk")]),s._v(" "),a("li",[s._v("DirectAdmin")]),s._v(" "),a("li",[s._v("ISPmanager")]),s._v(" "),a("li",[s._v("Interworx")]),s._v(" "),a("li",[s._v("MySQL")]),s._v(" "),a("li",[s._v("PostgreSQL")]),s._v(" "),a("li",[s._v("LiteSpeed")])]),s._v(" "),a("p",[s._v("Web interface to manage CageFS is available for cPanel, Plesk 10+, DirectAdmin, ISPmanager & Interworx. Command line tool would need to be used for other control panels.")]),s._v(" "),a("p",[s._v("Once you initialized the template you can start enabling users. By default CageFS is disabled for all users.")]),s._v(" "),a("p",[s._v("Starting from "),a("strong",[s._v("cagefs-6.1-27")]),s._v(" "),a("span",{staticClass:"notranslate"},[a("em",[s._v("fs.proc_can_see_other_uid")])]),s._v(" will be migrated (one time) from "),a("em",[s._v("/etc/sysctl.conf")]),s._v(" into "),a("em",[s._v("/etc/sysctl.d/90-cloudlinux.conf")]),s._v(" . If this variable is not set in either file, it will default to 0.")]),s._v(" "),a("p",[s._v("It is strongly advised against setting this variable in "),a("em",[s._v("90-cloudlinux.conf")]),s._v(" . Define it in "),a("em",[s._v("/etc/sysctl.conf")]),s._v(" or in some other config file with an index number greater than "),a("em",[s._v("90-cloudlinux.conf")]),s._v(" , e.g. "),a("em",[s._v("/etc/sysctl.d/95-custom.conf")]),s._v(" .")]),s._v(" "),a("p",[s._v("You can find more information on "),a("span",{staticClass:"notranslate"},[a("em",[s._v("fs.proc_can_see_other_uid")])]),s._v(" automatic migration in "),a("router-link",{attrs:{to:"/kernel_settings/#kernel-config-variables"}},[s._v("Kernel Config Variables")]),s._v(" .")],1),s._v(" "),a("h2",{attrs:{id:"unistalling-cagefs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unistalling-cagefs"}},[s._v("#")]),s._v(" Unistalling CageFS")]),s._v(" "),a("p",[s._v("To uninstall CageFS, start by disabling and removing all directories:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --remove-all\n")])])])]),s._v(" "),a("p",[s._v("That command will: disable CageFS for all customers, unmount CageFS for all users, removes "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs-skeleton")]),s._v(" & "),a("em",[s._v("/var/cagefs")])]),s._v(" directories. It will not remove "),a("em",[s._v("/etc/cagefs")]),s._v(" directory.")]),s._v(" "),a("p",[s._v("Remove CageFS RPM:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ yum remove cagefs\n")])])])]),s._v(" "),a("h2",{attrs:{id:"managing-users"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#managing-users"}},[s._v("#")]),s._v(" Managing Users")]),s._v(" "),a("p",[s._v("CageFS provides for two modes of operations:")]),s._v(" "),a("ol",[a("li",[s._v("Enabled for all, except those that are disabled.")]),s._v(" "),a("li",[s._v("Disabled for all, except those that are enabled.")])]),s._v(" "),a("p",[s._v("Mode #1 is convenient for production operation, where you want all new users to automatically be added to CageFS.\nMode #2 is convenient while you test CageFS, as it allows you to enable it on one by one for your customers.")]),s._v(" "),a("p",[s._v("To start using CageFS you have to select one of the mode of operations:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --enable-all\n")])])])]),s._v("\nor\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --disable-all\n")])])])]),s._v("\nor\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --toggle-mode\n")])])])]),s._v("\nThat will switch the operation mode, preserving current disabled/enabled users.\n"),a("p",[s._v("To enable individual user do:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --enable [username]\n")])])])]),s._v("\nTo disable individual user:\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --disable [username]\n")])])])]),s._v("\nTo  list all enabled users:\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --list-enabled\n")])])])]),s._v("\nTo list all disabled users:\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --list-disabled\n")])])])]),s._v("\nTo see current mode of operation:\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --display-user-mode\n")])])])]),s._v(" "),a("h2",{attrs:{id:"command-line-tools"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-line-tools"}},[s._v("#")]),s._v(" Command-line Tools")]),s._v(" "),a("p",[a("code",[s._v("cagefsctl")]),s._v(" is used to manage CageFS. It allows initializing and updating CageFS, as well as enabling/disabling CageFS for individual users.")]),s._v(" "),a("p",[s._v("Use the following syntax to manage CageFS:\n"),a("span",{staticClass:"notranslate"},[a("code",[s._v("/usr/sbin/cagefsctl [OPTIONS]")])])]),s._v(" "),a("p",[s._v("Options:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th"),s._v(" "),a("th")])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("-i")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --init ")])]),s._v(" "),a("td",[s._v("initialize CageFS (create CageFS if it does not exist)")])]),s._v(" "),a("tr",[a("td",[s._v("-r")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --reinit ")])]),s._v(" "),a("td",[s._v("reinitialize CageFS (make backup and recreate CageFS)")])]),s._v(" "),a("tr",[a("td",[s._v("-u")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --update ")])]),s._v(" "),a("td",[s._v("update files in CageFS (add new and modified files to CageFS, remove unneeded files)")])]),s._v(" "),a("tr",[a("td",[s._v("-f")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --force ")])]),s._v(" "),a("td",[s._v("recreate CageFS (do not make backup, overwrite existing files)")])]),s._v(" "),a("tr",[a("td",[s._v("-d")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --dont-clean ")])]),s._v(" "),a("td",[s._v("do not delete any files from skeleton (use with "),a("span",{staticClass:"notranslate"},[s._v(" --update ")]),s._v(" option)")])]),s._v(" "),a("tr",[a("td",[s._v("-k")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --hardlink ")])]),s._v(" "),a("td",[s._v("use hardlinks if possible")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --create-mp ")])]),s._v(" "),a("td",[s._v("Creates "),a("em",[s._v("/etc/cagefs/cagefs.mp")]),s._v(" file")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --mount-skel ")])]),s._v(" "),a("td",[s._v("mount CageFS skeleton directory")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --unmount-skel ")])]),s._v(" "),a("td",[s._v("unmount CageFS skeleton directory")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --remove-all ")])]),s._v(" "),a("td",[s._v("disable CageFS, remove templates and "),a("em",[s._v("/var/cagefs")]),s._v(" directory")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --sanity-check ")])]),s._v(" "),a("td",[s._v("perform basic self-diagnistics of common cagefs-related issues (mostly useful for support)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --addrpm ")])]),s._v(" "),a("td",[s._v("add rpm-packages in CageFS (run "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefsctl --update")])]),s._v(" in order to apply changes)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --delrpm ")])]),s._v(" "),a("td",[s._v("remove rpm-packages from CageFS (run "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefsctl --update")])]),s._v(" in order to apply changes)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --list-rpm ")])]),s._v(" "),a("td",[s._v("list rpm-packages that are installed in CageFS")])]),s._v(" "),a("tr",[a("td",[s._v("-e")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --enter ")])]),s._v(" "),a("td",[s._v("enter into user's CageFS as root")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --update-list ")])]),s._v(" "),a("td",[s._v("update specified files only (paths are read from stdin)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --update-etc ")])]),s._v(" "),a("td",[s._v("update "),a("em",[s._v("/etc")]),s._v(" directory of all or specified users")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --set-update-period ")])]),s._v(" "),a("td",[s._v("set min period of update of CageFS in days (default = 1 day)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --force-update ")])]),s._v(" "),a("td",[s._v("force update of CageFS (ignore period of update)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --force-update-etc ")])]),s._v(" "),a("td",[s._v("force update of "),a("em",[s._v("/etc")]),s._v(" directories for users in CageFS")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --reconfigure-cagefs ")])]),s._v(" "),a("td",[s._v("configure CageFS integration with other software (control panels, database servers, etc)")])])])]),s._v(" "),a("p",[s._v("Use the following syntax to manage users:"),a("br"),s._v(" "),a("span",{staticClass:"notranslate"},[a("code",[s._v("/usr/sbin/cagefsctl [OPTIONS] username [more usernames]")])])]),s._v(" "),a("p",[s._v("Options:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th"),s._v(" "),a("th")])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("-m")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --remount ")])]),s._v(" "),a("td",[s._v("remount specified user(s)")])]),s._v(" "),a("tr",[a("td",[s._v("-M")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --remount-all ")])]),s._v(" "),a("td",[s._v("remount CageFS skeleton directory and all users (use this each time you have changed "),a("em",[s._v("cagefs.mp")]),s._v(" file")])]),s._v(" "),a("tr",[a("td",[s._v("-w")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --unmount ")])]),s._v(" "),a("td",[s._v("unmount specified user(s)")])]),s._v(" "),a("tr",[a("td",[s._v("____")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --unmount-dir ")])]),s._v(" "),a("td",[s._v("unmount specified dir for all users")])]),s._v(" "),a("tr",[a("td",[s._v("-W")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --unmount-all ")])]),s._v(" "),a("td",[s._v("unmount CageFS skeleton directory and all users")])]),s._v(" "),a("tr",[a("td",[s._v("-l")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --list ")])]),s._v(" "),a("td",[s._v("list users that entered in CageFS")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --list-logged-in ")])]),s._v(" "),a("td",[s._v("list users that entered in CageFS via SSH")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --enable ")])]),s._v(" "),a("td",[s._v("enable CageFS for the user")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --disable ")])]),s._v(" "),a("td",[s._v("disable CageFS for the user")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --enable-all ")])]),s._v(" "),a("td",[s._v("enable all users, except specified in "),a("em",[s._v("/etc/cagefs/users.disabled")])])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --disable-all ")])]),s._v(" "),a("td",[s._v("disable all users, except specified in "),a("em",[s._v("/etc/cagefs/users.enabled")])])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --display-user-mode ")])]),s._v(" "),a("td",[s._v("display the current mode ( "),a("span",{staticClass:"notranslate"},[s._v(' "Enable All" ')]),s._v(" or "),a("span",{staticClass:"notranslate"},[s._v(' "Disable All" ')]),s._v(" )")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --toggle-mode ")])]),s._v(" "),a("td",[s._v("toggle mode saving current lists of users (lists of enabled and disabled users remain unchanged)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --list-enabled ")])]),s._v(" "),a("td",[s._v("list enabled users")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --list-disabled ")])]),s._v(" "),a("td",[s._v("list disabled users")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --user-status ")])]),s._v(" "),a("td",[s._v("print status of specified user (enabled or disabled)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --getprefix ")])]),s._v(" "),a("td",[s._v("display prefix for user")])])])]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[s._v(" PHP Selector ")]),s._v(" related options:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th")])]),s._v(" "),a("tbody",[a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --setup-cl-selector ")])]),s._v(" "),a("td",[s._v("setup "),a("span",{staticClass:"notranslate"},[s._v(" PHP Selector ")]),s._v(" or register new alt-php versions")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --remove-cls-selector ")])]),s._v(" "),a("td",[s._v("unregister alt-php versions, switch users to default php version when needed")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --rebuild-alt-php-ini ")])]),s._v(" "),a("td",[s._v("rebuild "),a("em",[s._v("alt_php.ini")]),s._v(" file for specified users (or all users if none specified)")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --validate-alt-php-ini ")])]),s._v(" "),a("td",[s._v("same as "),a("span",{staticClass:"notranslate"},[a("code",[s._v("--rebuild-alt-php-ini")])]),s._v(" but also validates "),a("em",[s._v("alt_php.ini")]),s._v(" options")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --cl-selector-reset-versions ")])]),s._v(" "),a("td",[s._v("reset php version for specifed users to default (or all users if none specified)")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --cl-selector-reset-modules ")])]),s._v(" "),a("td",[s._v("reset php modules (extensions) for specific users to defaults (or all users if none specified)")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --create-virt-mp ")])]),s._v(" "),a("td",[s._v("create virtual mount points for the user")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --create-virt-mp-all ")])]),s._v(" "),a("td",[s._v("create virtual mount points for all users")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --remount-virtmp ")])]),s._v(" "),a("td",[s._v("create virtual mount points and remount user")])]),s._v(" "),a("tr",[a("td",[a("span",{staticClass:"notranslate"},[s._v(" --apply-global-php-ini ")])]),s._v(" "),a("td",[s._v("use with 0, 1 or 2 arguments from the list: "),a("span",{staticClass:"notranslate"},[a("code",[s._v("error_log")]),s._v(", "),a("code",[s._v("date.timezone")])]),s._v(" without arguments applies all global php options including the two above")])])])]),s._v(" "),a("p",[s._v("Common options:")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th"),s._v(" "),a("th"),s._v(" "),a("th")])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("___")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --disable-cagefs ")])]),s._v(" "),a("td",[s._v("disable CageFS")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --cagefs-status ")])]),s._v(" "),a("td",[s._v("print CageFS status: ( "),a("span",{staticClass:"notranslate"},[s._v(" enabled ")]),s._v(" or "),a("span",{staticClass:"notranslate"},[s._v(" disabled ")]),s._v(" )")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --set-min-uid ")])]),s._v(" "),a("td",[s._v("Set min "),a("span",{staticClass:"notranslate"},[s._v(" UID ")])])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --get-min-uid ")])]),s._v(" "),a("td",[s._v("Display current MIN_UID setting")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --print-suids ")])]),s._v(" "),a("td",[s._v("Print list of "),a("span",{staticClass:"notranslate"},[s._v(" SUID ")]),s._v(" and SGID programs in skeleton")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --do-not-ask ")])]),s._v(" "),a("td",[s._v("assume "),a("span",{staticClass:"notranslate"},[s._v(' "yes" ')]),s._v(" in all queries (should be the first option in command)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --clean-var-cagefs ")])]),s._v(" "),a("td",[s._v("clean "),a("em",[s._v("/var/cagefs")]),s._v(" directory (remove data of non-existent users)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --set-tmpwatch ")])]),s._v(" "),a("td",[s._v("set "),a("code",[s._v("tmpwatch")]),s._v(" command and parameters (save to "),a("em",[s._v("/etc/cagefs/cagefs.ini")]),s._v(" file)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --tmpwatch ")])]),s._v(" "),a("td",[s._v("execute tmpwatch (remove outdated files in tmp directories in CageFS for all users)")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --toggle-plugin ")])]),s._v(" "),a("td",[s._v("disable/enable CageFS plugin")])]),s._v(" "),a("tr",[a("td",[s._v("-v")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --verbose ")])]),s._v(" "),a("td",[s._v("verbose output")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --wait-lock ")])]),s._v(" "),a("td",[s._v("wait for end of execution of other "),a("code",[s._v("cagefsctl")]),s._v(" processes (when needed) before execution of the command")])]),s._v(" "),a("tr",[a("td",[s._v("-h")]),s._v(" "),a("td",[a("span",{staticClass:"notranslate"},[s._v(" --help ")])]),s._v(" "),a("td",[s._v("this message")])])])]),s._v(" "),a("h2",{attrs:{id:"running-command-inside-cagefs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-command-inside-cagefs"}},[s._v("#")]),s._v(" Running Command Inside CageFS")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("[lve-wrappers 0.6-1+]")])])]),s._v(" "),a("p",[s._v("Sometimes you will need to execute a command as user inside CageFS.")]),s._v(" "),a("p",[s._v("If a user has shell enabled - you can simply use:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ /bin/su - $USERNAME  -c "_command_"\n')])])])]),s._v("\nYet, if a user have they shell disabled, it wouldn't work. To solve this issue, we have added command:\n"),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ /sbin/cagefs_enter_user $USERNAME "_command_"\n')])])])]),s._v(" "),a("p",[s._v("If you disable CageFS for a user, then "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefs_enter")])]),s._v(" will be executed without "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" .")]),s._v(" "),a("p",[s._v("You can forcibly disable "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefs_enter")])]),s._v(" start via "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" for all users (regardless if CageFS is enabled or disabled) by specifying the parameter "),a("span",{staticClass:"notranslate"},[a("em",[s._v("cagefs_enter_proxied=0")]),s._v(" in "),a("em",[s._v("/etc/sysconfig/cloudlinux")])]),s._v(" .")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("/bin/cagefs_enter.proxied")])]),s._v(" can be executed instead of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/bin/cagefs_enter")])]),s._v(" to enter CageFS without "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" . Note that starting "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefs_enter")])]),s._v(" via "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" is necessary to enable sending local notification messages to users with enabled CageFS. "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefs_enter")])]),s._v(" is executed via "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" by default.")]),s._v(" "),a("h2",{attrs:{id:"sanity-check"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sanity-check"}},[s._v("#")]),s._v(" Sanity Check")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("[ CageFS 6.0-34+]")])])]),s._v(" "),a("p",[s._v("CageFS "),a("span",{staticClass:"notranslate"},[a("code",[s._v("--sanity-check")])]),s._v(" utility allows to check CageFS configuration consistency, so that an administrator can save the time investigating issues with CageFS and ensure that custom configuration is correct.")]),s._v(" "),a("p",[s._v("To start, run the command:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cagefsctl --sanity-check\n")])])])]),s._v("\nAt the moment 7 types of check are implemented:\n"),a("ol",[a("li",[a("p",[a("em",[s._v("Check cagefs mount points exists")]),s._v(" - reads "),a("em",[s._v("cagefs.mp")]),s._v(" file and verifies if the directories specified in it really exist on the disk. To learn more, visit "),a("router-link",{attrs:{to:"/cagefs/#mount-points"}},[s._v("Mount points")]),s._v(" and "),a("router-link",{attrs:{to:"/cagefs/#split-by-username"}},[s._v("Split by username")])],1)]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check cagefs "),a("span",{staticClass:"notranslate"},[a("code",[s._v("users.enabled")])]),s._v(" is a directory")]),s._v(" - ensures that if  "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/users.enabled")])]),s._v(" exists, then it is a directory, not a file (if it is recognized as a file, then it would cause a breakdown).")])]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check cagefs "),a("span",{staticClass:"notranslate"},[a("code",[s._v("users.disabled")])]),s._v(" is a directory")]),s._v(" - ensures that if  "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/users.disabled")])]),s._v(" exists, then it is a directory, not a file (if it is recognized as a file, then it would cause a breakdown).")])]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check cagefs "),a("span",{staticClass:"notranslate"},[a("code",[s._v("disable.etcfs")])]),s._v(" exists")]),s._v(" - checks if "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/etc.safe/disable.etcfs")])]),s._v(" exists.")])]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check cagefs users can enter cagefs")]),s._v(" - chooses two users in the system with enabled CageFS (the first and the second ones in the unsorted list) and tries to log in to CageFS under their credentials and see what happens. It runs "),a("span",{staticClass:"notranslate"},[a("code",[s._v('su -l "$USER" -s /bin/bash -c "whoami"')])]),s._v(" and compares the output with the "),a("span",{staticClass:"notranslate"},[s._v(" $USER ")]),s._v(" and "),a("span",{staticClass:"notranslate"},[s._v(" su ")]),s._v(" command retcode estimation.")])])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("If a login fails, it can be due to various reasons, that can only be determined in manual mode. The checker only gives the output of the command.")])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[a("em",[s._v("Check cagefs proxy commands configs are parsable")]),s._v(" - tries to load "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/*.proxy.commands")])]),s._v(" files and parse them to check the syntax. In case of any parsing error the test will fail. To learn more, visit "),a("router-link",{attrs:{to:"/cagefs/#executing-by-proxy"}},[s._v("Executing by proxy")]),s._v(" .")],1)]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check cagefs virt.mp files syntax")]),s._v(" - reads all "),a("em",[s._v("/var/cagefs///virt.mp")]),s._v(" files (if any) and checks their syntax validity. At the moment there are only two checks of the syntax: the file is not empty if it exists, and the file is not starting with the sub directory definitions (with @). To learn more, visit "),a("router-link",{attrs:{to:"/cagefs/#per-user-virtual-mount-points"}},[s._v("Per-user virtual mount points")])],1)]),s._v(" "),a("li",[a("p",[a("em",[s._v("Check MultiPHP system default PHP version")]),s._v(" – checks that MultiPHP system default PHP version is "),a("strong",[s._v("NOT")]),s._v(" Alt-PHP. That means "),a("span",{staticClass:"notranslate"},[s._v(" PHP Selector ")]),s._v(" should work properly. If MultiPHP system default PHP version is Alt-PHP, "),a("span",{staticClass:"notranslate"},[s._v(" PHP Selector ")]),s._v(" does not work and should be disabled. To learn more on how to disable "),a("span",{staticClass:"notranslate"},[s._v(" PHP Selector, ")]),s._v(" visit "),a("router-link",{attrs:{to:"/lve_manager/#cpanel-lve-manager"}},[s._v("cPanel LVE Manager")])],1)])]),s._v(" "),a("p",[s._v("Possible results of the checks:")]),s._v(" "),a("ul",[a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" OK ")]),s._v(" - the check succeeded.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" FAILED ")]),s._v(" - the check revealed a problem.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" SKIPPED ")]),s._v(" - the check was skipped as it made no sense in such environment (e.g. wrong control panel) or can not be performed for some reason (e.g no users with enabled CageFS found). The actual result does not mean that a problem exists and can be considered as positive.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" INTERNAL_TEST_ERROR ")]),s._v(" - the check failed because of a problem inside the checker itself. Must be reported to the developers.")])])]),s._v(" "),a("p",[s._v("In case if at least one of the checks resulted neither "),a("span",{staticClass:"notranslate"},[s._v(" OK ")]),s._v(" nor "),a("span",{staticClass:"notranslate"},[s._v(" SKIPPED ")]),s._v(" then the checker will end with ret code >0.")]),s._v(" "),a("h2",{attrs:{id:"cagefs-quirks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cagefs-quirks"}},[s._v("#")]),s._v(" CageFS Quirks")]),s._v(" "),a("p",[s._v("Due to the nature of CageFS, some options will not work as before or will require some changes:")]),s._v(" "),a("ul",[a("li",[s._v("lastlog will not work ( "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/log/lastlog")])]),s._v(" ).")]),s._v(" "),a("li",[s._v("PHP will load php.ini from "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/selector/php.ini.")])]),s._v(" That file is actually a link to the real "),a("em",[s._v("php.ini")]),s._v(" file from your system. So the same "),a("em",[s._v("php.ini")]),s._v(" will be loaded in the end.")]),s._v(" "),a("li",[s._v("You have to run "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefsctl --update")])]),s._v(" any time you have modified "),a("em",[s._v("php.ini")]),s._v(", or you want to get new/updated software inside CageFS.")]),s._v(" "),a("li",[s._v("CageFS installation changes "),a("span",{staticClass:"notranslate"},[a("code",[s._v("jailshell")])]),s._v(" to regular bash on cPanel - "),a("a",{attrs:{href:"http://kb.cloudlinux.com/2015/11/why-cagefs-installation-change-jailshell-to-regular-bash-on-cpanel/",target:"_blank",rel:"noopener noreferrer"}},[s._v("read why"),a("OutboundLink")],1),s._v(" .")])]),s._v(" "),a("h2",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[s._v("#")]),s._v(" Configuration")]),s._v(" "),a("ul",[a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#file-system-templates"}},[s._v("File System Templates")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#excluding-files"}},[s._v("Excluding Files")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#excluding-users"}},[s._v("Excluding Users")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#mount-points"}},[s._v("Mount Points")])],1),s._v(" "),a("ul",[a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#per-user-virtual-mount-points"}},[s._v("Per user virtual mount points")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#split-by-username"}},[s._v("Split by Username")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#mounting-users-home-directory-inside-cagefs"}},[s._v("Mounting user’s home directory inside CageFS")])],1)])])]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#base-home-directory"}},[s._v("Base Home Directory")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#postgresql-support"}},[s._v("PostgreSQL support")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#pam-configuration"}},[s._v("PAM Configuration")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#executing-by-proxy"}},[s._v("Executing By Proxy")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#custom-etc-files-per-customer"}},[s._v("Custom /etc files per customer")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#moving-cagefs-skeleton-directory"}},[s._v("Moving "),a("span",{staticClass:"notranslate"},[s._v(" cagefs-skeleton ")]),s._v(" directory")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#moving-var-cagefs-directory"}},[s._v("Moving /var/cagefs directory")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#tmp-directories"}},[s._v("TMP directories")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#syslog"}},[s._v("Syslog")])],1)]),s._v(" "),a("li",[a("p",[a("router-link",{attrs:{to:"/cagefs/#excluding-mount-points"}},[s._v("Excluding mount points")])],1)])]),s._v(" "),a("h3",{attrs:{id:"file-system-templates"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#file-system-templates"}},[s._v("#")]),s._v(" File System Templates")]),s._v(" "),a("p",[s._v("CageFS creates a filesystem template in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs-skeleton")])]),s._v(" directory. CageFS template will be mounted for each customer.  The template is created by running:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# /usr/sbin/cagefsctl --init\n")])])])]),s._v(" "),a("p",[s._v("To update the template, you should run:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --update\n")])])])]),s._v(" "),a("p",[s._v("The behavior of the commands (and the files copied into "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs-skeleton")])]),s._v(" directory) depends on the configuration files in "),a("em",[s._v("/etc/cagefs/conf.d")]),a("br"),s._v("\nYou can add additional files, users, groups and devices into CageFS template by adding .cfg file, and running:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --update\n")])])])]),s._v(" "),a("p",[s._v("To delete files from CageFS template, remove corresponding .cfg file, and run:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ /usr/sbin/cagefsctl --update\n")])])])]),s._v(" "),a("p",[s._v("Here is an example "),a("span",{staticClass:"notranslate"},[a("em",[s._v("openssh-clients.cfg")])]),s._v(" file:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[openssh-clients]\n\ncomment=OpenSSH Clients\n\npaths=/etc/ssh/ssh_config, /bin/hostname, /usr/bin/scp, /usr/bin/sftp, /usr/bin/slogin, /usr/bin/ssh, /usr/bin/ssh-add, /usr/bin/ssh-agent, /usr/bin/ssh-copy-id, /usr/bin/.ssh.hmac, /usr/bin/ssh-keyscan, /usr/libexec/openssh/sftp-server, /etc/environment, /etc/security/pam_env.conf\n\ndevices=/dev/ptmx\n")])])])]),s._v(" "),a("p",[s._v("Example "),a("span",{staticClass:"notranslate"},[a("em",[s._v("mail.cfg")])]),s._v(" file:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[mail]\n\ncomment=Mail tools\n\npaths=/bin/mail, /etc/aliases.db, /etc/mail, /etc/mailcap, /etc/mail.rc, /etc/mime.types, /etc/pam.d/smtp.sendmail, /etc/rc.d/init.d/sendmail, /etc/smrsh, /etc/sysconfig/sendmail, /usr/bin/hoststat, /usr/bin/Mail, /usr/bin/mailq.sendmail, /usr/bin/makemap, /usr/bin/newaliases.sendmail, /usr/bin/purgestat, /usr/bin/rmail.sendmail, /usr/lib64/sasl2/Sendmail.conf, /usr/lib/mail.help, /usr/lib/mail.tildehelp, /usr/lib/sendmail.sendmail, /usr/sbin/mailstats, /usr/sbin/makemap, /usr/sbin/praliases, /usr/sbin/sendmail.sendmail, /usr/sbin/smrsh, /var/log/mail, /var/spool/clientmqueue, /var/spool/mqueue\n\nusers=smmsp\n\ngroups=smmsp\n")])])])]),s._v(" "),a("p",[s._v("There is an easy way to add/delete files from particular "),a("span",{staticClass:"notranslate"},[s._v(" RPMs ")]),s._v(" into CageFS. That can be done by using "),a("span",{staticClass:"notranslate"},[a("code",[s._v("--addrpm")]),s._v(" and "),a("code",[s._v("--delrpm")])]),s._v(" options in "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefsctl")])]),s._v(" . Like:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --addrpm ffmpeg\n$ cagefsctl --update\n")])])])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("ffmpeg RPM should be installed on the system already.")])]),a("h3",{attrs:{id:"excluding-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#excluding-files"}},[s._v("#")]),s._v(" Excluding Files")]),s._v(" "),a("p",[s._v("To exclude files and directories from CageFS, edit file:"),a("br"),s._v(" "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/custom.black.list")])]),a("br"),s._v("\nAnd add files or directories in there, one per line.")]),s._v(" "),a("p",[s._v("Please do not edit "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/black.list")])]),s._v(" file because it is replaced during the update of CageFS package.")]),s._v(" "),a("h3",{attrs:{id:"excluding-users"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#excluding-users"}},[s._v("#")]),s._v(" Excluding Users")]),s._v(" "),a("p",[s._v("To exclude users from CageFS, create a file (any name would work) inside "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/exclude")])]),s._v(" folder, and list users that you would like to exclude from CageFS in that file.")]),s._v(" "),a("h3",{attrs:{id:"mount-points"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mount-points"}},[s._v("#")]),s._v(" Mount Points")]),s._v(" "),a("p",[s._v("CageFS creates individual namespace for each user, making it impossible for users to see each other's files and creating high level of isolation. The way namespace is organized:")]),s._v(" "),a("ol",[a("li",[a("span",{staticClass:"notranslate"},[s._v(" /usr/share/cagefs-skeleton ")]),s._v(" with safe files is created")]),s._v(" "),a("li",[s._v("Any directory from the server that needs to be shared across all users is mounted into "),a("span",{staticClass:"notranslate"},[s._v(" /usr/share/cagefs-skeleton ")]),s._v("\n(a list of such directories is defined in /etc/cagefs/cagefs.mp)")]),s._v(" "),a("li",[a("span",{staticClass:"notranslate"},[s._v(" /var/cagefs/[prefix]/username ")]),s._v(" directory for each user. Prefix is defined as last two digits of user id. User id is taken from "),a("span",{staticClass:"notranslate"},[s._v(" /etc/passwd ")]),s._v(" file.")]),s._v(" "),a("li",[s._v("Separate /etc directory is created and populated for each user inside "),a("span",{staticClass:"notranslate"},[s._v(" /var/cagefs/[prefix]/username ")])]),s._v(" "),a("li",[s._v("/tmp directory is mounted for each user separately into "),a("span",{staticClass:"notranslate"},[s._v(" ~username/.cagefs-tmp directory ")])]),s._v(" "),a("li",[s._v("Additional custom directories can be mounted for each user by defining them in /etc/cagefs/cagefs.mp")]),s._v(" "),a("li",[s._v("You can define custom directories per user using "),a("router-link",{attrs:{to:"/cagefs/#per-user-virtual-mount-points"}},[s._v("virt.mp")]),s._v(" files "),a("em",[s._v("[CageFS 5.1 and higher]")])],1)]),s._v(" "),a("p",[s._v("To define individual custom directories in /etc/cagefs/cagefs.mp following format is used:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("code",[s._v("@/full/path/to/directory,permission notation")])])]),s._v(" "),a("p",[s._v("This is useful when you need to give each user its own copy of a particular system directory, like:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("code",[s._v("@/var/run/screen,777")])])]),s._v(" "),a("p",[s._v("Such entry would create separate "),a("span",{staticClass:"notranslate"},[s._v(" /var/run/screen ")]),s._v(" for each user, with permissions set to 777")]),s._v(" "),a("p",[s._v("To modify mount points, edit /etc/cagefs/cagefs.mp. Here is an example of cagefs.mp:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/var/lib/mysql\n/var/lib/dav\n/var/www/cgi-bin\n/var/spool\n/dev/pts\n/usr/local/apache/domlogs\n/proc\n/opt\n@/var/spool/cron,700\n@/var/run/screen,777\n")])])])]),s._v(" "),a("p",[s._v("If you want to change mount points, make sure you re-initialize mount points for all customers:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --remount-all\n")])])])]),s._v("\nThis command will kill all current processes and reset mount points.\n"),a("h4",{attrs:{id:"per-user-virtual-mount-points"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#per-user-virtual-mount-points"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Per user virtual mount points")])]),s._v(" "),a("p",[a("em",[s._v("[CageFS 5.1 and higher]")])]),s._v(" "),a("ul",[a("li",[a("em",[s._v("Please, see "),a("router-link",{attrs:{to:"/cagefs/#split-by-username"}},[s._v("Split by username")]),s._v(" feature, as it might be simpler to implement in some cases.")],1)])]),s._v(" "),a("p",[s._v("Starting with CageFS 5.1 you can specify additional directories to be mounted inside user's CageFS. This can be specified for each user.\nTo specify virtual mount points for a user, create a file:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("code",[s._v("/var/cagefs/[prefix]/[user]/virt.mp")])])]),s._v(" "),a("p",[s._v("Inside that file, you can specify mount points in the following format:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("virtdir1,mask\n@subdir1,mask\n@subdir2,mask\nvirdir2,mask\n@subdir3,mask\n@subdir4,mask\n>virtdir3,mask\n@subdir5,mask\n@subdir6,mask\n# comments\n")])])])]),s._v(" "),a("ul",[a("li",[a("span",{staticClass:"notranslate"},[a("em",[s._v("mask")])]),s._v(" is always optional, if missing 0755 is used")]),s._v(" "),a("li",[s._v("Create virtual directory "),a("span",{staticClass:"notranslate"},[a("em",[s._v("subdir/virtdir")])]),s._v(" , mount it to:\n"),a("ul",[a("li",[a("span",{staticClass:"notranslate"},[s._v(" skeleton "),a("em",[s._v("jaildir/virtdir")])])]),s._v(" "),a("li",[s._v("inside virtual directory, create directories "),a("span",{staticClass:"notranslate"},[a("em",[s._v("subdir1, subdir2")])])]),s._v(" "),a("li",[s._v("mount "),a("span",{staticClass:"notranslate"},[a("em",[s._v("virtdir1/subdir1")])]),s._v(" to "),a("span",{staticClass:"notranslate"},[a("em",[s._v("subdir/virtdir/subdir1")])])]),s._v(" "),a("li",[s._v("if "),a("span",{staticClass:"notranslate"},[a("em",[s._v("virtdir")])]),s._v(" is started with >, create directory "),a("span",{staticClass:"notranslate"},[a("em",[s._v("subdir/virtdir")])]),s._v(" , but don't mount it into "),a("span",{staticClass:"notranslate"},[a("em",[s._v("jaildir")])]),s._v(" . This is needed for cases when "),a("span",{staticClass:"notranslate"},[a("em",[s._v("virtdir")])]),s._v(" is inside home base dir.")])])]),s._v(" "),a("li",[s._v("if file "),a("em",[s._v("/var/cagefs/[prefix]/[user]/virt.mp")]),s._v(" is missing -- no virt directories are loaded for that user.")])]),s._v(" "),a("p",[s._v("Note that CageFS will automatically create those files for Plesk 10 & higher.")]),s._v(" "),a("p",[s._v("For example if we have Plesk 11.5 with two users "),a("span",{staticClass:"notranslate"},[a("em",[s._v("cltest1")])]),s._v(" , and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("cltest2")])]),s._v(" :\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cltest1 uid 10000 has domains: cltest1.com, cltest1-addon.com and sub1.cltest1.com\ncltest2 uid 10001 has domains: cltest2.com, cltest2-addon.com\n")])])])]),s._v(" "),a("p",[s._v("In such case we would have file "),a("em",[s._v("/var/cagefs/00/cltest1/virt.mp")]),s._v(" :\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">/var/www/vhosts/system,0755\n@cltest1-addon.com,0755\n@cltest1.com,0755\n@sub1.cltest1.com,0755\n")])])])]),s._v(" "),a("p",[s._v("and file: "),a("em",[s._v("/var/cagefs/01/cltest2/virt.mp:")])]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">/var/www/vhosts/system\n@cltest2-addon.com\n@cltest2.com\n")])])])]),s._v(" "),a("h4",{attrs:{id:"split-by-username"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#split-by-username"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Split by Username")])]),s._v(" "),a("p",[a("em",[s._v("[CageFS 5.3.1+]")])]),s._v(" "),a("p",[s._v("Sometimes you might need to make sure that directory containing all users would show up as containing just that user inside CageFS. For example, if you have directory structure like:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/home/httpd/fcgi-bin/user1\n/home/httpd/fcgi-bin/user2\n")])])])]),s._v(" "),a("p",[s._v("Then we can add the following line to /etc/cagefs/cagefs.mp file:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("%/home/httpd/fcgi-bin\n")])])])]),s._v(" "),a("p",[s._v("and execute:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cagefsctl --remount-all\n")])])])]),s._v(" "),a("p",[s._v("After that each subdirectory of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/httpd/fcgi-bin")])]),s._v(" will be mounted for appropriate user in CageFS: "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/httpd/fcgi-bin/user1")])]),s._v(" will be mounted for "),a("span",{staticClass:"notranslate"},[s._v(" user1 ")]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/httpd/fcgi-bin/user2")])]),s._v(" will be mounted for "),a("span",{staticClass:"notranslate"},[s._v(" user2 ")]),s._v(" .")]),s._v(" "),a("h4",{attrs:{id:"mounting-user’s-home-directory-inside-cagefs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mounting-user’s-home-directory-inside-cagefs"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Mounting user’s home directory inside CageFS")])]),s._v(" "),a("p",[s._v("CageFS 6.1-1 (and later) has improved mounting user’s home directory that is applied for users with home directories like "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/user")]),s._v(" or "),a("em",[s._v("/homeN/user")])]),s._v(" (where "),a("span",{staticClass:"notranslate"},[s._v(" N ")]),s._v(" = 0,1,..9).")]),s._v(" "),a("p",[s._v("In such case, earlier versions of CageFS always mount user’s home directory to "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/user")])]),s._v(" and create symlink "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/homeN -> /home")])]),s._v(" when needed, so user’s home directory can be accessed both via "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/user")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/homeN/user")])]),s._v(" . This quirk leads to some rare incompatibilities between CageFS and other software (for example OpenCart), because real path of user’s home directory in CageFS and in real file system can differ.")]),s._v(" "),a("p",[s._v("New CageFS mounts user’s home directory in a way that its real path in CageFS is always the same as in real file system. Additionally, CageFS searches for symlinks like\n"),a("span",{staticClass:"notranslate"},[a("em",[s._v("/homeX -> /homeY")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/homeX/user -> /homeY/user")])]),s._v(" in real system and creates such symlinks in user’s CageFS when found.")]),s._v(" "),a("p",[s._v("This new mounting mode is enabled by default. You can switch to old mounting mode by executing the following commands:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# touch /etc/cagefs/disable.home.dirs.search\n# cagefsctl --force-update\n# cagefsctl --remount-all\n")])])])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v('New mounting mode will be disabled automatically when "mounting base home directory" mode is enabled '),a("span",{staticClass:"notranslate"},[s._v(" ("),a("code",[s._v("mount_basedir=1")]),s._v(" setting in "),a("em",[s._v("/etc/cagefs/cagefs.base.home.dirs")])]),s._v(" file).")])]),a("h3",{attrs:{id:"base-home-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#base-home-directory"}},[s._v("#")]),s._v(" Base Home Directory")]),s._v(" "),a("p",[s._v("If you have a custom setup where home directories are in a special format, like: "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME/data")])]),s._v(" , you can specify it using regular expressions. This is needed by CageFS to create safe home space for end user, where no other users are visible.")]),s._v(" "),a("p",[s._v("We will create empty: "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cagefs/[prefix]/$USERNAME/home")])]),s._v(" , and then mount "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME")])]),s._v(" in that directory")]),s._v(" "),a("p",[s._v("To do that, create a file: "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/cagefs.base.home.dirs")])])]),s._v(" "),a("p",[s._v("With content like:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("^/home/\n^/var/www/users/\n")])])])]),s._v(" "),a("p",[s._v("If there is no such file, the home directory without last component will be considered as a base dir, like with\n"),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME")])]),s._v(" we would create "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cagefs/[prefix]/$USERNAME/home")])]),s._v(" , and then mount\n"),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME")])]),s._v(" in there")]),s._v(" "),a("p",[s._v("With "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME/data")])]),s._v(" as a home dir, we would assume that "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME")])]),s._v(" is the base directory, and we would create "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cagefs/[prefix]/$USERNAME/home/$USERNAME/data")])]),s._v(" and then we would mount "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home/$USERNAME/data")])]),s._v(" -- which would cause each user to see empty base directories for other users, exposing user names.")]),s._v(" "),a("p",[a("strong",[s._v("Sharing home directory structure among users")])]),s._v(" "),a("p",[s._v("When you want to share directory structure among multiple users, you can add following line at the top of the "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/cagefs.base.home.dirs")])]),s._v(" file. This is useful on the systems that support sites with multiple users, with different home directories inside the main 'site' directory.\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount_basedir=1\n")])])])]),s._v(" "),a("p",[s._v("For example:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[s._v(" user1 ")]),s._v(" has home directory "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/www/vhosts/sitename.com/web_users/user1")])]),s._v(" "),a("span",{staticClass:"notranslate"},[s._v(" user2 ")]),s._v(" has home directory "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/www/vhosts/sitename.com/web_users/user2")])]),s._v("\nsite admin has home directory "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/www/vhosts/sitename.com")])])]),s._v(" "),a("p",[s._v("So, content of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/cagefs.base.home.dirs")])]),s._v(" should be the following:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mount_basedir=1\n^/var/www/vhosts/[^/]+\n")])])])]),s._v(" "),a("p",[s._v("Directory structure in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/www/vhosts/sitename.com")])]),s._v(" will be mounted in CageFS for appropriate users."),a("br"),s._v("\nEach user will have access to whole directory structure in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/www/vhosts/sitename.com")])]),s._v(" (according to their permissions).")]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("You should execute "),a("span",{staticClass:"notranslate"},[a("code",[s._v("cagefsctl --remount-all")])]),s._v(" in order to apply changes to CageFS (i.e. remount home directories).")])]),a("h3",{attrs:{id:"postgresql-support"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postgresql-support"}},[s._v("#")]),s._v(" PostgreSQL support")]),s._v(" "),a("p",[s._v("CloudLinux 7:")]),s._v(" "),a("p",[s._v("CageFS works with any PostgreSQL version installed from CloudLinux or CentOS repositories. PostgreSQL packages for CloudLinux 7 come from the upstream (CentOS) unmodified. PostgreSQL’s socket is located in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/run/postgresql")])]),s._v(" directory. This directory is mounted to CageFS by default (in cagefs-5.5-6.34 or later).")]),s._v(" "),a("p",[s._v("When PostgreSQL has been installed after CageFS install, please add line:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/var/run/postgresql\n")])])])]),s._v(" "),a("p",[s._v("tо "),a("em",[s._v("/etc/cagefs/cagefs.mp")]),s._v(" file and then execute:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cagefsctl --remount-all \n")])])])]),s._v(" "),a("p",[s._v("The steps above are enough to configure CageFS to work with PostgreSQL.")]),s._v(" "),a("p",[s._v("CloudLinux 6:")]),s._v(" "),a("p",[s._v("CageFS provides separate "),a("em",[s._v("/tmp")]),s._v(" directory for each end user. Yet, PostgreSQL keeps its Unix domain socket inside server's main "),a("em",[s._v("/tmp")]),s._v(" directory. In addition to that, the location is hard coded inside PostgreSQL libraries.")]),s._v(" "),a("p",[s._v("To resolve the issue, CloudLinux provides a version of PostgreSQL with modified start up script that can store PostgreSQL's socket in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/run/postgres.")])]),s._v(" The script automatically creates link from "),a("em",[s._v("/tmp")]),s._v(" to that socket to prevent PostgreSQL dependent applications from breaking.")]),s._v(" "),a("p",[s._v("In addition to that, CageFS knows how to correctly link this socket inside end user's "),a("em",[s._v("/tmp")]),s._v(" directory.")]),s._v(" "),a("p",[s._v("To enable PostgreSQL support in CageFS:")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Make sure you have updated to latest version of PostgreSQL.")])]),s._v(" "),a("li",[a("p",[s._v("Edit file "),a("em",[s._v("/etc/sysconfig/postgres")]),s._v(", and uncomment "),a("span",{staticClass:"notranslate"},[a("em",[s._v("SOCK_DIR")])]),s._v(" line.")])]),s._v(" "),a("li",[a("p",[s._v("Update CageFS configuration by running:")])])]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cagefsctl  --reconfigure-cagefs\n")])])])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Restart PostgreSQL by running:")])]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ service postgresql restart \n")])])])]),s._v(" "),a("p",[s._v("If you are using cPanel, you would also need to modify file: "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cron.daily/tmpwatch")])])]),s._v(" "),a("p",[s._v("And update line:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("flags=-umc \n")])])])]),s._v(" "),a("p",[s._v("to:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("flags=-umcl\n")])])])]),s._v(" "),a("p",[s._v("to prevent symlink from being removed.")]),s._v(" "),a("h3",{attrs:{id:"pam-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pam-configuration"}},[s._v("#")]),s._v(" PAM Configuration")]),s._v(" "),a("p",[s._v("CageFS depends on "),a("span",{staticClass:"notranslate"},[a("strong",[s._v("pam_lve")])]),s._v(" module tor PAM enabled services. When installed, the module is automatically installed for following services:")]),s._v(" "),a("ul",[a("li",[s._v("sshd")]),s._v(" "),a("li",[s._v("crond")]),s._v(" "),a("li",[s._v("su")])]),s._v(" "),a("p",[s._v("The following line is added to corresponding file in "),a("em",[s._v("/etc/pam.d/")]),s._v(":\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("session    required     pam_lve.so      100     1\n")])])])]),s._v(" "),a("p",[s._v("Where 100 stands for minimum "),a("span",{staticClass:"notranslate"},[s._v(" UID ")]),s._v(" to put into "),a("span",{staticClass:"notranslate"},[s._v(" CageFS & LVE ")]),s._v(" , and 1 stands for CageFS enabled.")]),s._v(" "),a("h3",{attrs:{id:"executing-by-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#executing-by-proxy"}},[s._v("#")]),s._v(" Executing By Proxy")]),s._v(" "),a("p",[s._v("Some software has to run outside CageFS to be able to complete its job. This includes such programs as "),a("span",{staticClass:"notranslate"},[a("strong",[s._v("passwd, sendmail")]),s._v(" ,  ")]),s._v(" etc.")]),s._v(" "),a("p",[s._v("CloudLinux uses "),a("span",{staticClass:"notranslate"},[s._v(" proxyexec ")]),s._v(" technology to accomplish this goal. You can define any program to run outside CageFS, by specifying it in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/custom.proxy.commands")])]),s._v(" file. Do not edit existing "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/proxy.commands")])]),s._v(" as it will be overwritten with next CageFS update.")]),s._v(" "),a("p",[s._v("Once program is defined, run this command to populate the skeleton:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --update\n")])])])]),s._v(" "),a("p",[s._v("All the cPanel scripts located in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/local/cpanel/cgi-sys/")])]),s._v(" that user might need to execute should be added to "),a("span",{staticClass:"notranslate"},[a("em",[s._v("proxy.commands")])]),s._v(" .")]),s._v(" "),a("p",[a("strong",[s._v("Users with duplicate UIDs")])]),s._v(" "),a("p",[s._v("The syntax of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/*.proxy.commands")])]),s._v(" files is as follows:"),a("br"),s._v(" "),a("span",{staticClass:"notranslate"},[a("em",[s._v("ALIAS:wrapper_name=username:path_to_executable")])])]),s._v(" "),a("p",[s._v("Mandatory parameters are "),a("span",{staticClass:"notranslate"},[a("em",[s._v("ALIAS")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("path_to_executable")])]),s._v(" .")]),s._v(" "),a("ul",[a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" ALIAS ")]),s._v(" - any name which is unique within all "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/*.proxy.commands")])]),s._v(" files;")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" wrapper_name ")]),s._v(" - the name of wrapper file, which is used as a replacement for executable file "),a("span",{staticClass:"notranslate"},[a("em",[s._v("path_to_executable")]),s._v(" inside CageFS ")]),s._v(" . Wrapper files are located in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs/safeprograms")])]),s._v(" . If wrapper name is not specified, then default wrapper "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs/safeprograms/cagefs.proxy.program")])]),s._v(" is used. Also, a reserved word "),a("span",{staticClass:"notranslate"},[a("code",[s._v("noproceed")])]),s._v(" can be used, it will intend that wrapper is not in use (installed before) - applied for the commands with several "),a("span",{staticClass:"notranslate"},[s._v(" ALIAS ")]),s._v(" , as in the example below.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" username ")]),s._v(" - the name of a user on whose behalf "),a("span",{staticClass:"notranslate"},[a("em",[s._v("path_to_executable")])]),s._v(" will run in the real system. If "),a("span",{staticClass:"notranslate"},[s._v(" username ")]),s._v(" is not specified, then "),a("span",{staticClass:"notranslate"},[a("em",[s._v("path_to_executable")])]),s._v(" will run on behalf the same user that is inside CageFS.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[s._v(" path_to_executable ")]),s._v(" - the path to executable file which will run via "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" .")])])]),s._v(" "),a("p",[s._v("Example of a simple command executed via "),a("span",{staticClass:"notranslate"},[s._v(" proxyexec ")]),s._v(" :\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("SENDMAIL=/usr/sbin/sendmail\n")])])])]),s._v(" "),a("p",[s._v("Example of "),a("span",{staticClass:"notranslate"},[s._v(" crontab ")]),s._v(" command execution with custom wrapper under "),a("span",{staticClass:"notranslate"},[s._v(" root ")]),s._v(" (privilege escalation). The command uses two "),a("span",{staticClass:"notranslate"},[s._v(" ALIAS ")]),s._v(" , that is why in the second line "),a("span",{staticClass:"notranslate"},[a("code",[s._v("noproceed")])]),s._v(" is specified instead of wrapper name.\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CRONTAB_LIST:cagefs.proxy.crontab=root:/usr/bin/crontab\nCRONTAB_SAVE:noproceed=root:/usr/bin/crontab\n")])])])]),s._v(" "),a("p",[s._v("Sometimes hosters may have users with non unique "),a("span",{staticClass:"notranslate"},[s._v(" UIDs ")]),s._v(" . Thus, "),a("span",{staticClass:"notranslate"},[a("code",[s._v("proxyexec")])]),s._v(" may traverse users directory to find a specific one. That behavior turns into inappropriate if users directory is not cached locally (for example LDAP is in use).")]),s._v(" "),a("p",[s._v("To turn this feature off:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("touch /etc/cagefs/proxy.disable.duid\n")])])])]),s._v(" "),a("p",[s._v("Or to activate it back:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("rm /etc/cagefs/proxy.disable.duid\n")])])])]),s._v(" "),a("h3",{attrs:{id:"custom-etc-files-per-customer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#custom-etc-files-per-customer"}},[s._v("#")]),s._v(" Custom /etc files per customer")]),s._v(" "),a("p",[a("em",[s._v("[4.0-5 and later]")])]),s._v(" "),a("p",[s._v("To create a custom file in /etc directory for end user, create a directory:"),a("br"),s._v(" "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/custom.etc/[username]")])])]),s._v(" "),a("p",[s._v("Put all custom files, and sub-directories into that direcotry.")]),s._v(" "),a("p",[s._v("For example, if you want to create custom "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/hosts")]),s._v(" file for USER1 ")]),s._v(" , create a directory:"),a("br"),s._v(" "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/custom.etc/USER1")])])]),s._v(" "),a("p",[s._v("Inside that directory, create a "),a("span",{staticClass:"notranslate"},[a("em",[s._v("hosts")])]),s._v(" file, with the content for that user.")]),s._v(" "),a("p",[s._v("After that execute:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --update-etc USER1\n")])])])]),s._v(" "),a("p",[s._v("If you are making changes for multiple users, you can run:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --update-etc\n")])])])]),s._v(" "),a("p",[s._v("To remove a custom file, remove it from "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/custom.etc/[USER]")])]),s._v(" directory, and re-run:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --update-etc\n")])])])]),s._v(" "),a("h3",{attrs:{id:"moving-cagefs-skeleton-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moving-cagefs-skeleton-directory"}},[s._v("#")]),s._v(" Moving cagefs-skeleton directory")]),s._v(" "),a("p",[s._v("Sometimes you might need to move "),a("span",{staticClass:"notranslate"},[s._v(" cagefs-skeleton ")]),s._v(" from "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share")])]),s._v(" to another partition.")]),s._v(" "),a("p",[s._v("There are two ways:")]),s._v(" "),a("ol",[a("li",[s._v("If "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs-skeleton")])]),s._v(" is not created yet ( "),a("span",{staticClass:"notranslate"},[s._v(" cagefsctl --init ")]),s._v(" wasn't executed), then execute:")])]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ mkdir /home/cagefs-skeleton \n$ ln -s /home/cagefs-skeleton /usr/share/cagefs-skeleton \n$ cagefsctl --init\n")])])])]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("If "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs-skeleton")])]),s._v(" already exists:")])]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('$ cagefsctl --disable-cagefs \n$ cagefsctl --unmount-all\n# To ensure that the following command prints empty output: \n$ cat /proc/mounts | grep cagefs \n# if you see any cagefs entries, execute "cagefsctl --unmount-all" again.\n$ mv /usr/share/cagefs-skeleton /home/cagefs-skeleton \n$ ln -s /home/cagefs-skeleton /usr/share/cagefs-skeletoncagefsctl --enable-cagefs\n')])])])]),s._v(" "),a("p",[s._v("On cPanel servers, if you place skeleton into "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/home")])]),s._v(" directory, then you should configure the following option:")]),s._v(" "),a("p",[s._v("In "),a("em",[s._v("cPanel WHM")]),s._v(" choose "),a("span",{staticClass:"notranslate"},[a("em",[s._v("Server Configuration")])]),s._v(" and go to "),a("span",{staticClass:"notranslate"},[a("em",[s._v("Basic cPanel/WHM Setup")])]),s._v(" , then in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("Basic Config")])]),s._v(" change "),a("span",{staticClass:"notranslate"},[a("em",[s._v("Additional home directories")])]),s._v(" default value to blank (not "),a("span",{staticClass:"notranslate"},[s._v(' "home" ')]),s._v(" ).")]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("If this option is not set, then cPanel will create new accounts in incorrect places.")])]),a("h3",{attrs:{id:"moving-var-cagefs-directory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moving-var-cagefs-directory"}},[s._v("#")]),s._v(" Moving /var/cagefs directory")]),s._v(" "),a("p",[s._v("To move "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cagefs")])]),s._v(" to another location:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --disable-cagefs\n$ cagefsctl --unmount-all\n")])])])]),s._v(" "),a("p",[s._v("Verify that "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cagefs.bak")])]),s._v(' directory does not exist (if it exists - change name "cagefs.bak" to something else)')]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cp -rp /var/cagefs /new/path/cagefs\n$ mv /var/cagefs /var/cagefs.bak\n$ ln -s /new/path/cagefs /var/cagefs\n$ cagefsctl --enable-cagefs\n$ cagefsctl --remount-all\n")])])])]),s._v(" "),a("p",[s._v("Verify that the following command gives empty output:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cat /proc/mounts | grep cagefs.bak\n")])])])]),s._v(" "),a("p",[s._v("Then you can safely remove /var/cagefs.bak:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ rm -rf /var/cagefs.bak\n")])])])]),s._v(" "),a("h3",{attrs:{id:"tmp-directories"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tmp-directories"}},[s._v("#")]),s._v(" TMP Directories")]),s._v(" "),a("p",[s._v("CageFS makes sure that each user has his own "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/tmp")])]),s._v(" directory, and that directory is the part of end-user's quota.")]),s._v(" "),a("p",[s._v("The actual location of the directory is "),a("span",{staticClass:"notranslate"},[a("em",[s._v("$USER_HOME/.cagefs/tmp")])])]),s._v(" "),a("p",[s._v("Once a day, using cron job, "),a("span",{staticClass:"notranslate"},[s._v(" CageFS ")]),s._v(" will clean up user's "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/tmp")])]),s._v(" directory from all the files that haven't been accessed during 30 days.")]),s._v(" "),a("p",[s._v("This can be changed by running:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --set-tmpwatch='/usr/sbin/tmpwatch -umclq 720'\n")])])])]),s._v(" "),a("p",[s._v("Where 720 is the number of hours that the file had to be inaccessible to be removed.")]),s._v(" "),a("p",[s._v("By default this is done at 03:37 AM, but you can also force the clean up outdated files that match 'chosen period' of all user's "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/tmp")])]),s._v(" directories without waiting for a job to be launched by "),a("span",{staticClass:"notranslate"},[s._v(" cronjob ")]),s._v(" . Just run:")]),s._v(" "),a("div",{staticClass:"notranslate"},[a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ cagefsctl --tmpwatch\n")])])])]),s._v(" "),a("p",[s._v("The following path will be cleaned as well:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cache/php-eaccelerator")])]),s._v(" (actual location "),a("span",{staticClass:"notranslate"},[a("em",[s._v("$USER_HOME/.cagefs/var/cache/php-eaccelerator")])]),s._v(" )")]),s._v(" "),a("p",[s._v("You can configure "),a("span",{staticClass:"notranslate"},[s._v(" tmpwatch ")]),s._v(" to clean custom directories inside "),a("span",{staticClass:"notranslate"},[s._v(" CageFS ")]),s._v(" .")]),s._v(" "),a("p",[s._v("Create "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cagefs/cagefs.ini")])]),s._v(" configuration file and specify "),a("span",{staticClass:"notranslate"},[a("em",[s._v("tmpwatch_dirs")])]),s._v(" directive as follows:")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("tmpwatch_dirs=/dir1,/dir2")])])]),s._v(" "),a("p",[s._v("After that directories "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dir1")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dir2")])]),s._v(" inside CageFS  will be cleaned automatically.")]),s._v(" "),a("p",[s._v("Note that actual location of those directories in real file system is "),a("span",{staticClass:"notranslate"},[a("em",[s._v("$USER_HOME/.cagefs/dir1")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("$USER_HOME/.cagefs/dir2")])]),s._v(" .")]),s._v(" "),a("p",[a("strong",[s._v("Cleanup PHP sessions")])]),s._v(" "),a("p",[s._v("For cPanel servers, CageFS version 6.0-42 or higher performs cleaning of PHP sessions based on "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" directives specified in proper "),a("span",{staticClass:"notranslate"},[a("em",[s._v("php.ini")])]),s._v(" files.")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")])]),s._v(" directive default value is 1440 seconds. Those session files will be deleted, that were created or had metadata (ctime) changes more time ago than it is specified in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")]),s._v(" .  ")])]),s._v(" "),a("p",[s._v("For "),a("span",{staticClass:"notranslate"},[s._v(" Alt-PHP ")]),s._v(" versions "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" value is normally "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/tmp")])]),s._v(" .")]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("For new installations of Alt-PHP packages, "),a("span",{staticClass:"notranslate"},[s._v(" session.save_path will be changed from /tmp to /opt/alt/phpNN/var/lib/php/session, ")]),s._v(" where NN corresponds to Alt-PHP version.")])]),a("p",[s._v("This applies to the following "),a("span",{staticClass:"notranslate"},[s._v(" Alt-PHP ")]),s._v(" versions (or later):")]),s._v(" "),a("ul",[a("li",[s._v("alt-php44-4.4.9-71;")]),s._v(" "),a("li",[s._v("alt-php51-5.1.6-81;")]),s._v(" "),a("li",[s._v("alt-php52-5.2.17-107;")]),s._v(" "),a("li",[s._v("alt-php53-5.3.29-59;")]),s._v(" "),a("li",[s._v("alt-php54-5.4.45-42;")]),s._v(" "),a("li",[s._v("alt-php55-5.5.38-24;")]),s._v(" "),a("li",[s._v("alt-php56-5.6.31-7;")]),s._v(" "),a("li",[s._v("alt-php70-7.0.23-5;")]),s._v(" "),a("li",[s._v("alt-php71-7.1.9-5;")]),s._v(" "),a("li",[s._v("alt-php72-7.2.0-0.rc.2.2.")])]),s._v(" "),a("p",[s._v("When using EasyApache 3, "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" value is normally "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cpanel/php/sessions/ea3")])]),s._v(" or "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/tmp")])]),s._v(" . Seettings for EasyApache 3 are usualy taken from the file "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/local/lib/php.ini")]),s._v(" . ")])]),s._v(" "),a("p",[s._v("When using EasyApache 4, "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" value is normally "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/cpanel/php/sessions/ea-phpXX")]),s._v(" ,  ")]),s._v(" where "),a("span",{staticClass:"notranslate"},[a("em",[s._v("XX")])]),s._v(" corresponds to PHP version.")]),s._v(" "),a("p",[s._v("Cleaning is started by cron "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/cron.d/cpanel_php_sessions_cron")])]),s._v(" , which starts the script "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/share/cagefs/clean_user_php_sessions")])]),s._v(" twice within one hour.")]),s._v(" "),a("p",[s._v("The settings for ea-php are located in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/opt/cpanel/ea-phpXX/root/etc/php.d/local.ini")])]),s._v(" or in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/opt/cpanel/ea-phpXX/root/etc/php.ini")])]),s._v(" , where "),a("span",{staticClass:"notranslate"},[a("em",[s._v("XX")])]),s._v(" corresponds to the PHP version.")]),s._v(" "),a("p",[s._v("The settings for alt-php are located in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/opt/alt/phpXX/etc/php.ini")])]),s._v(" files, where "),a("span",{staticClass:"notranslate"},[a("em",[s._v("XX")])]),s._v(" corresponds to PHP version.")]),s._v(" "),a("p",[s._v("The cleaning script cleans php sessions for all PHP versions ( "),a("span",{staticClass:"notranslate"},[a("em",[s._v("ea-php")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("alt-php")])]),s._v(" ) regardless of whether a version is used or selected via "),a("span",{staticClass:"notranslate"},[s._v(" MultiPHP Manager ")]),s._v(" or "),a("span",{staticClass:"notranslate"},[s._v(" PHP Selector ")]),s._v(" . When different "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")])]),s._v(" values are specified for the same "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" (for different php versions), the cleaning script will use the least value for cleaning "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" . So, it is recommended to specify different "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" for each PHP version.")]),s._v(" "),a("p",[s._v("Users can define custom value of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")]),s._v(" via PHP Selector ")]),s._v(" in order to configure PHP's garbage collector, but that will not affect the script for cleaning PHP sessions. The script cleans PHP sessions based on global values of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.gc_maxlifetime")])]),s._v(" and "),a("span",{staticClass:"notranslate"},[a("em",[s._v("session.save_path")])]),s._v(" directives taken from files mentioned above. Settings in custom users’ "),a("span",{staticClass:"notranslate"},[s._v(" php.ini ")]),s._v(" files are ignored.")]),s._v(" "),a("p",[a("strong",[s._v("Cleanup PHP session files in Plesk")])]),s._v(" "),a("p",[s._v("For Plesk servers, "),a("span",{staticClass:"notranslate"},[s._v(" CageFS ")]),s._v(" version 6.0-52 or higher is provided with a special cron job for removing obsolete PHP session files. Cleanup script runs once an hour (similar to how it is done in Plesk).")]),s._v(" "),a("p",[s._v("Each time the script runs, it performs the cleanup of the paths:")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("set by "),a("span",{staticClass:"notranslate"},[a("code",[s._v("session.save_path")])]),s._v(" directive in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/opt/alt/phpXX/etc/php.ini")])]),s._v(" files. If "),a("span",{staticClass:"notranslate"},[s._v(" session.save_path ")]),s._v(" is missing, then "),a("span",{staticClass:"notranslate"},[s._v(" /tmp ")]),s._v(" is used. Session files lifetime is set by "),a("span",{staticClass:"notranslate"},[s._v(" session.gc_maxlifetime ")]),s._v(" directive. If it is not found, then 1440 seconds value is used (24 minutes, as in Plesk). Lifetime set in the file is only taken into consideration if it is longer than 1440 seconds, otherwise 1440 seconds is used. All the installed "),a("span",{staticClass:"notranslate"},[s._v(" Alt-PHP ")]),s._v(" versions are processed.")])]),s._v(" "),a("li",[a("p",[a("span",{staticClass:"notranslate"},[a("em",[s._v("/var/lib/php/session")])]),s._v(" . Files lifetime is only defined by Plesk script "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/usr/lib64/plesk-9.0/maxlifetime")])]),s._v(" . If the script is missing or returns errors, then this directory is not processed.")])])]),s._v(" "),a("p",[s._v("The following features are applied during the cleanup:")]),s._v(" "),a("ul",[a("li",[s._v("all the users with "),a("span",{staticClass:"notranslate"},[s._v(" UID ")]),s._v(" higher than specified in "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/login.defs")])]),s._v(" are processed. Each user is processed independently from one another.")]),s._v(" "),a("li",[s._v("only directories inside "),a("span",{staticClass:"notranslate"},[s._v(" CageFS ")]),s._v(" are being cleaned. The paths of the same name in the physical  file system are not processed.")]),s._v(" "),a("li",[s._v("in all the detected directories, all the files with the names that correspond to "),a("span",{staticClass:"notranslate"},[a("code",[s._v("sess_")]),s._v(" search ")]),s._v(" mask are removed, the rest of the files are ignored.")]),s._v(" "),a("li",[s._v("the files older than specified lifetime are removed.")]),s._v(" "),a("li",[s._v("all non-fatal errors (lack of rights, missing directory) are ignored and do not affect the further work of the script.")])]),s._v(" "),a("p",[a("strong",[s._v("Disable PHP sessions cleanup on cPanel and Plesk")])]),s._v(" "),a("p",[s._v("Here is a possible workaround for PHP session expiration problem (session lives longer than it is possible in a control panel). To use your own custom PHP sessions cleanup scripts - you can turn off built-in sessions cleanup implementation in the following way:\nadd "),a("span",{staticClass:"notranslate"},[a("code",[s._v("clean_user_php_sessions=false")]),s._v(" line to "),a("em",[s._v("/etc/sysconfig/cloudlinux")])]),s._v(" .")]),s._v(" "),a("h3",{attrs:{id:"syslog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syslog"}},[s._v("#")]),s._v(" Syslog")]),s._v(" "),a("p",[s._v("By default, "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dev/log")])]),s._v(" should be available inside end user's "),a("span",{staticClass:"notranslate"},[s._v(" CageFS ")]),s._v(" . This is needed so that user's cronjobs and other things that user "),a("span",{staticClass:"notranslate"},[a("em",[s._v("dev/log")])]),s._v(" would get recorded in the system log files.")]),s._v(" "),a("p",[s._v("This is controlled using file "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/rsyslog.d/schroot.conf")])]),s._v(" with the following content:\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$AddUnixListenSocket /usr/share/cagefs-skeleton/dev/log\n")])])])]),s._v(" "),a("p",[s._v("To remove presence of "),a("span",{staticClass:"notranslate"},[a("em",[s._v("dev/log")])]),s._v(" inside CageFS, remove that file, and restart rsyslog service.")]),s._v(" "),a("h3",{attrs:{id:"excluding-mount-points"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#excluding-mount-points"}},[s._v("#")]),s._v(" Excluding mount points")]),s._v(" "),a("p",[a("strong",[s._v("How to exclude mounts from namespaces for all LVEs")])]),s._v(" "),a("p",[s._v("By default, all mounts from the real file system is inherited by namespaces of all "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" . So, destroying all "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" may be required in order to unmount some mount in real file system completely. Otherwise, mount point remains busy after unmounting it in the real file system because this mount exists in namespaces of "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" .")]),s._v(" "),a("p",[a("span",{staticClass:"notranslate"},[a("code",[s._v("lvectl start")])]),s._v(" command saves all mounts from real file system as “default namespace” for later use in all "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" . "),a("span",{staticClass:"notranslate"},[a("strong",[s._v("lve_namespaces")])]),s._v(" service executes "),a("span",{staticClass:"notranslate"},[a("code",[s._v("lvectl start")])]),s._v(" command during startup.")]),s._v(" "),a("p",[s._v("In "),a("span",{staticClass:"notranslate"},[a("strong",[s._v("lve-utils-2.0-26")])]),s._v(" (and later) there is an ability to exclude specific mounts from namespaces for all "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" .\nIn order to do so, please create a file "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/container/exclude_mounts.conf")])]),s._v(" with list of mounts to exclude (one mount per line) as regular expressions, and then execute "),a("span",{staticClass:"notranslate"},[a("code",[s._v("lvectl start")])]),s._v(" :\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cat /etc/container/exclude_mounts.conf    \n^/dir1/\n^/dir2$\n# lvectl start\n")])])])]),s._v(" "),a("p",[s._v("After that, all new created "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" will be without "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dir2")])]),s._v(" mount and without mounts that start with "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dir1/")])]),s._v(" (like "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/dir1/x")]),s._v(" ,  "),a("em",[s._v("/dir1/x/y")])]),s._v(" , etc). To apply changes to existing "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" you should recreate "),a("span",{staticClass:"notranslate"},[s._v(" LVEs ")]),s._v(" :\n")]),a("div",{staticClass:"notranslate"},[a("p"),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# lvectl destroy all   \n# lvectl apply all\n")])])])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Note")]),a("p",[s._v("You should recreate all LVEs only once after creating "),a("span",{staticClass:"notranslate"},[a("em",[s._v("/etc/container/exclude_mounts.conf")])]),s._v(" file. After that the configuration changes will be applied to all new LVEs automatically.")])]),a("h2",{attrs:{id:"control-panel-integration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#control-panel-integration"}},[s._v("#")]),s._v(" Control Panel Integration")]),s._v(" "),a("p",[s._v("CageFS comes with a plugin for various control panels.")]),s._v(" "),a("p",[s._v("The plugin allows to:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Initialize CageFS;")])]),s._v(" "),a("li",[a("p",[s._v("Select "),a("router-link",{attrs:{to:"/cagefs/#managing-users"}},[s._v("mode of operation")]),s._v(" ;")],1)]),s._v(" "),a("li",[a("p",[s._v("See and modify the list of enabled/disabled users;")])]),s._v(" "),a("li",[a("p",[s._v("Update CageFS skeleton.")])])]),s._v(" "),a("h3",{attrs:{id:"cpanel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpanel"}},[s._v("#")]),s._v(" cPanel")]),s._v(" "),a("p",[s._v("CageFS plugin for cPanel is located in "),a("span",{staticClass:"notranslate"},[s._v(" Plugins ")]),s._v(" section of WHM.")]),s._v(" "),a("p",[s._v("It allows to initialize CageFS, select users CageFS will be enabled for, as well as update CageFS skeleton.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/_img1_zoom73.png",alt:""}})]),s._v(" "),a("p",[s._v("To enable CageFS for a proper user (users), in "),a("span",{staticClass:"notranslate"},[s._v(" CageFS User Manager ")]),s._v(" choose a user from the list on the right ( "),a("span",{staticClass:"notranslate"},[s._v(" Disabled ")]),s._v(" users) and click "),a("span",{staticClass:"notranslate"},[s._v(" Toggle ")]),s._v(" . The user will move to the list on the left ( "),a("span",{staticClass:"notranslate"},[s._v(" Enabled ")]),s._v(" users).")]),s._v(" "),a("p",[s._v("To disable a user (users), choose a user from the list on the left ( "),a("span",{staticClass:"notranslate"},[s._v(" Enabled ")]),s._v(" users) and click "),a("span",{staticClass:"notranslate"},[s._v(" Disable CageFS ")]),s._v(" . The user will move to the list on the right ( "),a("span",{staticClass:"notranslate"},[s._v(" Disabled ")]),s._v(" users).")]),s._v(" "),a("p",[s._v("To update CageFS skeleton, click "),a("span",{staticClass:"notranslate"},[s._v(" Update CageFS Skeleton ")]),s._v(" .")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/_img2_zoom71.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"plesk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#plesk"}},[s._v("#")]),s._v(" Plesk")]),s._v(" "),a("p",[s._v("CageFS comes with a plugin for Plesk 10.x. It allows initializing and updating CageFS template, as well as managing users and mode of operation for CageFS.")]),s._v(" "),a("p",[s._v("In modules section choose CageFS:")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/plesk_cagefs_icon.png",alt:""}})]),s._v(" "),a("p",[s._v("To enable CageFS for a proper user (users), in "),a("span",{staticClass:"notranslate"},[s._v(" CageFS User Manager ")]),s._v(" choose a user from the list on the right ( "),a("span",{staticClass:"notranslate"},[s._v(" Disabled ")]),s._v(" users) and click "),a("span",{staticClass:"notranslate"},[s._v(" Toggle ")]),s._v(" . The user will move to the list on the left ( "),a("span",{staticClass:"notranslate"},[s._v(" Enabled ")]),s._v(" users).")]),s._v(" "),a("p",[s._v("To disable a user (users), choose a user from the list on the left ( "),a("span",{staticClass:"notranslate"},[s._v(" Enabled ")]),s._v(" users) and click "),a("span",{staticClass:"notranslate"},[s._v(" Disable CageFS ")]),s._v(" . The user will move to the list on the right ( "),a("span",{staticClass:"notranslate"},[s._v(" Disabled ")]),s._v(" users).")]),s._v(" "),a("p",[s._v("To update CageFS skeleton, click "),a("span",{staticClass:"notranslate"},[s._v(" Update CageFS Skeleton ")]),s._v(" .")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/plesk_cagefs_manager_disable_all.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"ispmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ispmanager"}},[s._v("#")]),s._v(" ISPManager")]),s._v(" "),a("p",[s._v("CageFS comes with plugin for "),a("span",{staticClass:"notranslate"},[s._v(" ISP Manager ")]),s._v(" to enable/disable CageFS on per user base. In edit user section chose "),a("span",{staticClass:"notranslate"},[s._v(" Permission ")]),s._v(" tab. Mark "),a("span",{staticClass:"notranslate"},[s._v(" CageFS User Mode ")]),s._v(" checkbox and click "),a("span",{staticClass:"notranslate"},[s._v(" OK ")]),s._v(" to apply.")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/ispmanager_cagefs_user_zoom98.png",alt:""}})]),s._v(" "),a("p",[s._v("Or you can manage global CageFS settings via CageFS menu\n"),a("img",{attrs:{src:"/images/_img3.jpg",alt:""}})])])},[],!1,null,null,null);e.default=n.exports}}]);